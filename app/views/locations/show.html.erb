<h1><%= @location.primary_site_name %></h1>
<br/>
<div id="location_wrapper">
  <div id="location_first_column">
    <div id="location_first_column_first_row">
    <div id="location_metadata">
      <% if @location.wikipedia_link %>
        <p><%= link_to 'Wikipedia', @location.wikipedia_link, target: :_blank %></p>
      <% end %>
      <% if @location.fortalezas_link %>
        <p><%= link_to 'Fortalezas.org', @location.fortalezas_link, target: :_blank %></p>
      <% end %>
      <% if @location.castillosnet_link %>
        <p><%= link_to 'Castillos.net', @location.castillosnet_link, target: :_blank %></p>
      <% end %>
      <% if @location.at_collaborator_id %>
      <p>Collaborator:
        <%= Collaborator.find_by(at_collaborator_id: @location.at_collaborator_id).name %>
      </p>
      <% end %>
    </div><!--location metadata -->
    <div id="location_plan">
      <% if @location.images.detect{|i| i.image_category == "plan"} %>
      <img src="<%= @location.images.detect{|i| i.image_category == "plan"}.url %>"></img>
      <% else %>
      <img src="<%= image_path 'plan_unavailable.png' %>"></img>
      <% end %>
    </div>
    </div>
    <div id="location_image_gallery">
      <% @location.images.select{|i| i.image_category != "plan"}.sort_by{|i| i.image_category}.each do |image| %>
      <div class="location_image_card">
        <div class="location_image_card_thumbnail">
          <img src="<%= image.large_thumbnail_url %>" width="200px" height="auto"></img>
        </div>
        <div class="location_image_card_metadata">
          <% if image.view_direction %>
          <% if image.source == "1642_watercolor" %>
          <br/>
          <p>
            1642 Watercolor
          </p>
          <% end %>
          <p>
            View:
            <%= image.view_direction %>
          </p>
          <% end %>
          <% if image.image_category == "satellite image" %>
          <br/>
          <p>
            Satellite Image
          </p>
          <% end %>
        </div>


      </div>
      <% end %>
    </div> <!-- image gallery -->
  </div> <!--location first column -->
  <div id="location_second_column">
    <div id="openseadragon" class="openseadragon">
    </div>
  </div><!--location second column -->
</div> <!--location_wrapper -->

<script type="text/javascript">
  var viewer = OpenSeadragon({
    id: "openseadragon",
    tileSources: {
      type: 'image',
      url: '<%= @location.images.sort_by{|image| image.image_category}[0].url %>'
    }
  });
</script>
