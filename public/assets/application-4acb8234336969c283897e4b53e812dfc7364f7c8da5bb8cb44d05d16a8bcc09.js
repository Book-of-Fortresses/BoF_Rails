function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}(function(){var e=this;(function(){(function(){this.Rails={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:{selector:"button[data-remote]:not([form]), button[data-confirm]:not([form])",exclude:"form button"},inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",formDisableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",formEnableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]"}}).call(this)}).call(e);var y=e.Rails;(function(){(function(){var n,i;i=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector,y.matches=function(e,t){return null!=t.exclude?i.call(e,t.selector)&&!i.call(e,t.exclude):i.call(e,t)},n="_ujsData",y.getData=function(e,t){var i;return null!=(i=e[n])?i[t]:void 0},y.setData=function(e,t,i){return null==e[n]&&(e[n]={}),e[n][t]=i},y.$=function(e){return Array.prototype.slice.call(document.querySelectorAll(e))}}).call(this),function(){var i,n,o;i=y.$,o=y.csrfToken=function(){var e;return(e=document.querySelector("meta[name=csrf-token]"))&&e.content},n=y.csrfParam=function(){var e;return(e=document.querySelector("meta[name=csrf-param]"))&&e.content},y.CSRFProtection=function(e){var t;if(null!=(t=o()))return e.setRequestHeader("X-CSRF-Token",t)},y.refreshCSRFTokens=function(){var e,t;if(t=o(),e=n(),null!=t&&null!=e)return i('form input[name="'+e+'"]').forEach(function(e){return e.value=t})}}.call(this),function(){var o,t,r;r=y.matches,"function"!=typeof(o=window.CustomEvent)&&((o=function(e,t){var i;return(i=document.createEvent("CustomEvent")).initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}).prototype=window.Event.prototype),t=y.fire=function(e,t,i){var n;return n=new o(t,{bubbles:!0,cancelable:!0,detail:i}),e.dispatchEvent(n),!n.defaultPrevented},y.stopEverything=function(e){return t(e.target,"ujs:everythingStopped"),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},y.delegate=function(e,i,t,n){return e.addEventListener(t,function(e){var t;for(t=e.target;t instanceof Element&&!r(t,i);)t=t.parentNode;if(t instanceof Element&&!1===n.call(t,e))return e.preventDefault(),e.stopPropagation()})}}.call(this),function(){var t,n,e,o,r;n=y.CSRFProtection,y.fire,t={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},y.ajax=function(t){var i;return t=o(t),i=e(t,function(){var e;return e=r(i.response,i.getResponseHeader("Content-Type")),2===Math.floor(i.status/100)?"function"==typeof t.success&&t.success(e,i.statusText,i):"function"==typeof t.error&&t.error(e,i.statusText,i),"function"==typeof t.complete?t.complete(i,i.statusText):void 0}),!("function"!=typeof t.beforeSend||!t.beforeSend(i,t))&&(i.readyState===XMLHttpRequest.OPENED?i.send(t.data):void 0)},o=function(e){return e.url=e.url||location.href,e.type=e.type.toUpperCase(),"GET"===e.type&&e.data&&(e.url.indexOf("?")<0?e.url+="?"+e.data:e.url+="&"+e.data),null==t[e.dataType]&&(e.dataType="*"),e.accept=t[e.dataType],"*"!==e.dataType&&(e.accept+=", */*; q=0.01"),e},e=function(e,t){var i;return(i=new XMLHttpRequest).open(e.type,e.url,!0),i.setRequestHeader("Accept",e.accept),"string"==typeof e.data&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),n(i),i.withCredentials=!!e.withCredentials,i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)return t(i)},i},r=function(e,t){var i,n;if("string"==typeof e&&"string"==typeof t)if(t.match(/\bjson\b/))try{e=JSON.parse(e)}catch(o){}else if(t.match(/\b(?:java|ecma)script\b/))(n=document.createElement("script")).text=e,document.head.appendChild(n).parentNode.removeChild(n);else if(t.match(/\b(xml|html|svg)\b/)){i=new DOMParser,t=t.replace(/;.+/,"");try{e=i.parseFromString(e,t)}catch(o){}}return e},y.href=function(e){return e.href},y.isCrossDomain=function(e){var t,i;(t=document.createElement("a")).href=location.href,i=document.createElement("a");try{return i.href=e,!((!i.protocol||":"===i.protocol)&&!i.host||t.protocol+"//"+t.host==i.protocol+"//"+i.host)}catch(n){return n,!0}}}.call(this),function(){var o,r;o=y.matches,r=function(e){return Array.prototype.slice.call(e)},y.serializeElement=function(e,t){var i,n;return i=[e],o(e,"form")&&(i=r(e.elements)),n=[],i.forEach(function(t){if(t.name&&!t.disabled)return o(t,"select")?r(t.options).forEach(function(e){if(e.selected)return n.push({name:t.name,value:e.value})}):t.checked||-1===["radio","checkbox","submit"].indexOf(t.type)?n.push({name:t.name,value:t.value}):void 0}),t&&n.push(t),n.map(function(e){return null!=e.name?encodeURIComponent(e.name)+"="+encodeURIComponent(e.value):e}).join("&")},y.formElements=function(e,t){return o(e,"form")?r(e.elements).filter(function(e){return o(e,t)}):r(e.querySelectorAll(t))}}.call(this),function(){var t,r,i;r=y.fire,i=y.stopEverything,y.handleConfirm=function(e){if(!t(this))return i(e)},t=function(e){var t,i,n;if(!(n=e.getAttribute("data-confirm")))return!0;if(t=!1,r(e,"confirm")){try{t=confirm(n)}catch(o){}i=r(e,"confirm:complete",[t])}return t&&i}}.call(this),function(){var i,n,o,r,s,a,t,l,c,h,u;c=y.matches,l=y.getData,h=y.setData,u=y.stopEverything,t=y.formElements,y.handleDisabledElement=function(e){if(this.disabled)return u(e)},y.enableElement=function(e){var t;return t=e instanceof Event?e.target:e,c(t,y.linkDisableSelector)?a(t):c(t,y.buttonDisableSelector)||c(t,y.formEnableSelector)?r(t):c(t,y.formSubmitSelector)?s(t):void 0},y.disableElement=function(e){var t;return t=e instanceof Event?e.target:e,c(t,y.linkDisableSelector)?o(t):c(t,y.buttonDisableSelector)||c(t,y.formDisableSelector)?i(t):c(t,y.formSubmitSelector)?n(t):void 0},o=function(e){var t;return null!=(t=e.getAttribute("data-disable-with"))&&(h(e,"ujs:enable-with",e.innerHTML),e.innerHTML=t),e.addEventListener("click",u),h(e,"ujs:disabled",!0)},a=function(e){var t;return null!=(t=l(e,"ujs:enable-with"))&&(e.innerHTML=t,h(e,"ujs:enable-with",null)),e.removeEventListener("click",u),h(e,"ujs:disabled",null)},n=function(e){return t(e,y.formDisableSelector).forEach(i)},i=function(e){var t;return null!=(t=e.getAttribute("data-disable-with"))&&(c(e,"button")?(h(e,"ujs:enable-with",e.innerHTML),e.innerHTML=t):(h(e,"ujs:enable-with",e.value),e.value=t)),e.disabled=!0,h(e,"ujs:disabled",!0)},s=function(e){return t(e,y.formEnableSelector).forEach(r)},r=function(e){var t;return null!=(t=l(e,"ujs:enable-with"))&&(c(e,"button")?e.innerHTML=t:e.value=t,h(e,"ujs:enable-with",null)),e.disabled=!1,h(e,"ujs:disabled",null)}}.call(this),function(){var l;l=y.stopEverything,y.handleMethod=function(e){var t,i,n,o,r,s,a;if(a=(s=this).getAttribute("data-method"))return r=y.href(s),i=y.csrfToken(),t=y.csrfParam(),n=document.createElement("form"),o="<input name='_method' value='"+a+"' type='hidden' />",null==t||null==i||y.isCrossDomain(r)||(o+="<input name='"+t+"' value='"+i+"' type='hidden' />"),o+='<input type="submit" />',n.method="post",n.action=r,n.target=s.target,n.innerHTML=o,n.style.display="none",document.body.appendChild(n),n.querySelector('[type="submit"]').click(),l(e)}}.call(this),function(){var l,c,h,u,d,p,g,m,f,v=[].slice;p=y.matches,h=y.getData,m=y.setData,c=y.fire,f=y.stopEverything,l=y.ajax,u=y.isCrossDomain,g=y.serializeElement,d=function(e){var t;return null!=(t=e.getAttribute("data-remote"))&&"false"!==t},y.handleRemote=function(e){var t,i,n,o,r,s,a;return!d(o=this)||(c(o,"ajax:before")?(a=o.getAttribute("data-with-credentials"),n=o.getAttribute("data-type")||"script",p(o,y.formSubmitSelector)?(t=h(o,"ujs:submit-button"),r=h(o,"ujs:submit-button-formmethod")||o.method,s=h(o,"ujs:submit-button-formaction")||o.getAttribute("action")||location.href,"GET"===r.toUpperCase()&&(s=s.replace(/\?.*$/,"")),"multipart/form-data"===o.enctype?(i=new FormData(o),null!=t&&i.append(t.name,t.value)):i=g(o,t),m(o,"ujs:submit-button",null),m(o,"ujs:submit-button-formmethod",null),m(o,"ujs:submit-button-formaction",null)):p(o,y.buttonClickSelector)||p(o,y.inputChangeSelector)?(r=o.getAttribute("data-method"),s=o.getAttribute("data-url"),i=g(o,o.getAttribute("data-params"))):(r=o.getAttribute("data-method"),s=y.href(o),i=o.getAttribute("data-params")),l({type:r||"GET",url:s,data:i,dataType:n,beforeSend:function(e,t){return c(o,"ajax:beforeSend",[e,t])?c(o,"ajax:send",[e]):(c(o,"ajax:stopped"),!1)},success:function(){var e;return e=1<=arguments.length?v.call(arguments,0):[],c(o,"ajax:success",e)},error:function(){var e;return e=1<=arguments.length?v.call(arguments,0):[],c(o,"ajax:error",e)},complete:function(){var e;return e=1<=arguments.length?v.call(arguments,0):[],c(o,"ajax:complete",e)},crossDomain:u(s),withCredentials:null!=a&&"false"!==a}),f(e)):(c(o,"ajax:stopped"),!1))},y.formSubmitButtonClick=function(){var e,t;if(t=(e=this).form)return e.name&&m(t,"ujs:submit-button",{name:e.name,value:e.value}),m(t,"ujs:formnovalidate-button",e.formNoValidate),m(t,"ujs:submit-button-formaction",e.getAttribute("formaction")),m(t,"ujs:submit-button-formmethod",e.getAttribute("formmethod"))},y.handleMetaClick=function(e){var t,i,n;if(n=((i=this).getAttribute("data-method")||"GET").toUpperCase(),t=i.getAttribute("data-params"),(e.metaKey||e.ctrlKey)&&"GET"===n&&!t)return e.stopImmediatePropagation()}}.call(this),function(){var e,n,t,i,o,r,s,a,l,c,h,u,d,p;r=y.fire,t=y.delegate,a=y.getData,e=y.$,p=y.refreshCSRFTokens,n=y.CSRFProtection,o=y.enableElement,i=y.disableElement,c=y.handleDisabledElement,l=y.handleConfirm,d=y.handleRemote,s=y.formSubmitButtonClick,h=y.handleMetaClick,u=y.handleMethod,"undefined"==typeof jQuery||null===jQuery||null==jQuery.ajax||jQuery.rails||(jQuery.rails=y,jQuery.ajaxPrefilter(function(e,t,i){if(!e.crossDomain)return n(i)})),y.start=function(){if(window._rails_loaded)throw new Error("rails-ujs has already been loaded!");return window.addEventListener("pageshow",function(){return e(y.formEnableSelector).forEach(function(e){if(a(e,"ujs:disabled"))return o(e)}),e(y.linkDisableSelector).forEach(function(e){if(a(e,"ujs:disabled"))return o(e)})}),t(document,y.linkDisableSelector,"ajax:complete",o),t(document,y.linkDisableSelector,"ajax:stopped",o),t(document,y.buttonDisableSelector,"ajax:complete",o),t(document,y.buttonDisableSelector,"ajax:stopped",o),t(document,y.linkClickSelector,"click",c),t(document,y.linkClickSelector,"click",l),t(document,y.linkClickSelector,"click",h),t(document,y.linkClickSelector,"click",i),t(document,y.linkClickSelector,"click",d),t(document,y.linkClickSelector,"click",u),t(document,y.buttonClickSelector,"click",c),t(document,y.buttonClickSelector,"click",l),t(document,y.buttonClickSelector,"click",i),t(document,y.buttonClickSelector,"click",d),t(document,y.inputChangeSelector,"change",c),t(document,y.inputChangeSelector,"change",l),t(document,y.inputChangeSelector,"change",d),t(document,y.formSubmitSelector,"submit",c),t(document,y.formSubmitSelector,"submit",l),t(document,y.formSubmitSelector,"submit",d),t(document,y.formSubmitSelector,"submit",function(e){return setTimeout(function(){return i(e)},13)}),t(document,y.formSubmitSelector,"ajax:send",i),t(document,y.formSubmitSelector,"ajax:complete",o),t(document,y.formInputClickSelector,"click",c),t(document,y.formInputClickSelector,"click",l),t(document,y.formInputClickSelector,"click",s),document.addEventListener("DOMContentLoaded",p),window._rails_loaded=!0},window.Rails===y&&r(document,"rails:attachBindings")&&y.start()}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=y:"function"==typeof define&&define.amd&&define(y)}).call(this),function(){this.Turbolinks={supported:null!=window.history.pushState&&null!=window.requestAnimationFrame&&null!=window.addEventListener,visit:function(e,t){return Turbolinks.controller.visit(e,t)},clearCache:function(){return Turbolinks.controller.clearCache()},setProgressBarDelay:function(e){return Turbolinks.controller.setProgressBarDelay(e)}}}.call(this),function(){var i,n,l,e,t,o,r,s,a,c=[].slice;Turbolinks.copyObject=function(e){var t,i,n;for(t in i={},e)n=e[t],i[t]=n;return i},Turbolinks.closest=function(e,t){return i.call(e,t)},i=null!=(a=document.documentElement.closest)?a:function(e){var t;for(t=this;t;){if(t.nodeType===Node.ELEMENT_NODE&&n.call(t,e))return t;t=t.parentNode}},Turbolinks.defer=function(e){return setTimeout(e,1)},Turbolinks.throttle=function(i){var n;return n=null,function(){var e,t;return e=1<=arguments.length?c.call(arguments,0):[],null!=n?n:n=requestAnimationFrame((t=this,function(){return n=null,i.apply(t,e)}))}},Turbolinks.dispatch=function(e,t){var i,n,o,r,s,a;return a=(s=null!=t?t:{}).target,i=s.cancelable,n=s.data,(o=document.createEvent("Events")).initEvent(e,!0,!0===i),o.data=null!=n?n:{},o.cancelable&&!l&&(r=o.preventDefault,o.preventDefault=function(){return this.defaultPrevented||Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}}),r.call(this)}),(null!=a?a:document).dispatchEvent(o),o},(s=document.createEvent("Events")).initEvent("test",!0,!0),s.preventDefault(),l=s.defaultPrevented,Turbolinks.match=function(e,t){return n.call(e,t)},n=null!=(t=null!=(o=null!=(r=(e=document.documentElement).matchesSelector)?r:e.webkitMatchesSelector)?o:e.msMatchesSelector)?t:e.mozMatchesSelector,Turbolinks.uuid=function(){var e,t,i;for(i="",e=t=1;t<=36;e=++t)i+=9===e||14===e||19===e||24===e?"-":15===e?"4":20===e?(Math.floor(4*Math.random())+8).toString(16):Math.floor(15*Math.random()).toString(16);return i}}.call(this),function(){Turbolinks.Location=function(){function e(e){var t,i;null==e&&(e=""),(i=document.createElement("a")).href=e.toString(),this.absoluteURL=i.href,(t=i.hash.length)<2?this.requestURL=this.absoluteURL:(this.requestURL=this.absoluteURL.slice(0,-t),this.anchor=i.hash.slice(1))}var t,i,n,o;return e.wrap=function(e){return e instanceof this?e:new this(e)},e.prototype.getOrigin=function(){return this.absoluteURL.split("/",3).join("/")},e.prototype.getPath=function(){var e,t;return null!=(e=null!=(t=this.requestURL.match(/\/\/[^\/]*(\/[^?;]*)/))?t[1]:void 0)?e:"/"},e.prototype.getPathComponents=function(){return this.getPath().split("/").slice(1)},e.prototype.getLastPathComponent=function(){return this.getPathComponents().slice(-1)[0]},e.prototype.getExtension=function(){var e,t;return null!=(e=null!=(t=this.getLastPathComponent().match(/\.[^.]*$/))?t[0]:void 0)?e:""},e.prototype.isHTML=function(){return this.getExtension().match(/^(?:|\.(?:htm|html|xhtml))$/)},e.prototype.isPrefixedBy=function(e){var t;return t=i(e),this.isEqualTo(e)||o(this.absoluteURL,t)},e.prototype.isEqualTo=function(e){return this.absoluteURL===(null!=e?e.absoluteURL:void 0)},e.prototype.toCacheKey=function(){return this.requestURL},e.prototype.toJSON=function(){return this.absoluteURL},e.prototype.toString=function(){return this.absoluteURL},e.prototype.valueOf=function(){return this.absoluteURL},i=function(e){return t(e.getOrigin()+e.getPath())},t=function(e){return n(e,"/")?e:e+"/"},o=function(e,t){return e.slice(0,t.length)===t},n=function(e,t){return e.slice(-t.length)===t},e}()}.call(this),function(){var n=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.HttpRequest=function(){function e(e,t,i){this.delegate=e,this.requestCanceled=n(this.requestCanceled,this),this.requestTimedOut=n(this.requestTimedOut,this),this.requestFailed=n(this.requestFailed,this),this.requestLoaded=n(this.requestLoaded,this),this.requestProgressed=n(this.requestProgressed,this),this.url=Turbolinks.Location.wrap(t).requestURL,this.referrer=Turbolinks.Location.wrap(i).absoluteURL,this.createXHR()}return e.NETWORK_FAILURE=0,e.TIMEOUT_FAILURE=-1,e.timeout=60,e.prototype.send=function(){var e;return this.xhr&&!this.sent?(this.notifyApplicationBeforeRequestStart(),this.setProgress(0),this.xhr.send(),this.sent=!0,"function"==typeof(e=this.delegate).requestStarted?e.requestStarted():void 0):void 0},e.prototype.cancel=function(){return this.xhr&&this.sent?this.xhr.abort():void 0},e.prototype.requestProgressed=function(e){return e.lengthComputable?this.setProgress(e.loaded/e.total):void 0},e.prototype.requestLoaded=function(){return this.endRequest((t=this,function(){var e;return 200<=(e=t.xhr.status)&&e<300?t.delegate.requestCompletedWithResponse(t.xhr.responseText,t.xhr.getResponseHeader("Turbolinks-Location")):(t.failed=!0,t.delegate.requestFailedWithStatusCode(t.xhr.status,t.xhr.responseText))}));var t},e.prototype.requestFailed=function(){return this.endRequest((e=this,function(){return e.failed=!0,e.delegate.requestFailedWithStatusCode(e.constructor.NETWORK_FAILURE)}));var e},e.prototype.requestTimedOut=function(){return this.endRequest((e=this,function(){return e.failed=!0,e.delegate.requestFailedWithStatusCode(e.constructor.TIMEOUT_FAILURE)}));var e},e.prototype.requestCanceled=function(){return this.endRequest()},e.prototype.notifyApplicationBeforeRequestStart=function(){return Turbolinks.dispatch("turbolinks:request-start",{data:{url:this.url,xhr:this.xhr}})},e.prototype.notifyApplicationAfterRequestEnd=function(){return Turbolinks.dispatch("turbolinks:request-end",{data:{url:this.url,xhr:this.xhr}})},e.prototype.createXHR=function(){return this.xhr=new XMLHttpRequest,this.xhr.open("GET",this.url,!0),this.xhr.timeout=1e3*this.constructor.timeout,this.xhr.setRequestHeader("Accept","text/html, application/xhtml+xml"),this.xhr.setRequestHeader("Turbolinks-Referrer",this.referrer),this.xhr.onprogress=this.requestProgressed,this.xhr.onload=this.requestLoaded,this.xhr.onerror=this.requestFailed,this.xhr.ontimeout=this.requestTimedOut,this.xhr.onabort=this.requestCanceled},e.prototype.endRequest=function(e){return this.xhr?(this.notifyApplicationAfterRequestEnd(),null!=e&&e.call(this),this.destroy()):void 0},e.prototype.setProgress=function(e){var t;return this.progress=e,"function"==typeof(t=this.delegate).requestProgressed?t.requestProgressed(this.progress):void 0},e.prototype.destroy=function(){var e;return this.setProgress(1),"function"==typeof(e=this.delegate).requestFinished&&e.requestFinished(),this.delegate=null,this.xhr=null},e}()}.call(this),function(){var i=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.ProgressBar=function(){function e(){this.trickle=i(this.trickle,this),this.stylesheetElement=this.createStylesheetElement(),this.progressElement=this.createProgressElement()}var t;return t=300,e.defaultCSS=".turbolinks-progress-bar {\n  position: fixed;\n  display: block;\n  top: 0;\n  left: 0;\n  height: 3px;\n  background: #0076ff;\n  z-index: 9999;\n  transition: width "+t+"ms ease-out, opacity "+t/2+"ms "+t/2+"ms ease-in;\n  transform: translate3d(0, 0, 0);\n}",e.prototype.show=function(){return this.visible?void 0:(this.visible=!0,this.installStylesheetElement(),this.installProgressElement(),this.startTrickling())},e.prototype.hide=function(){return this.visible&&!this.hiding?(this.hiding=!0,this.fadeProgressElement((e=this,function(){return e.uninstallProgressElement(),e.stopTrickling(),e.visible=!1,e.hiding=!1}))):void 0;var e},e.prototype.setValue=function(e){return this.value=e,this.refresh()},e.prototype.installStylesheetElement=function(){return document.head.insertBefore(this.stylesheetElement,document.head.firstChild)},e.prototype.installProgressElement=function(){return this.progressElement.style.width=0,this.progressElement.style.opacity=1,document.documentElement.insertBefore(this.progressElement,document.body),this.refresh()},e.prototype.fadeProgressElement=function(e){return this.progressElement.style.opacity=0,setTimeout(e,1.5*t)},e.prototype.uninstallProgressElement=function(){return this.progressElement.parentNode?document.documentElement.removeChild(this.progressElement):void 0},e.prototype.startTrickling=function(){return null!=this.trickleInterval?this.trickleInterval:this.trickleInterval=setInterval(this.trickle,t)},e.prototype.stopTrickling=function(){return clearInterval(this.trickleInterval),this.trickleInterval=null},e.prototype.trickle=function(){return this.setValue(this.value+Math.random()/100)},e.prototype.refresh=function(){return requestAnimationFrame((e=this,function(){return e.progressElement.style.width=10+90*e.value+"%"}));var e},e.prototype.createStylesheetElement=function(){var e;return(e=document.createElement("style")).type="text/css",e.textContent=this.constructor.defaultCSS,e},e.prototype.createProgressElement=function(){var e;return(e=document.createElement("div")).className="turbolinks-progress-bar",e},e}()}.call(this),function(){var o=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.BrowserAdapter=function(){function e(e){this.controller=e,this.showProgressBar=o(this.showProgressBar,this),this.progressBar=new Turbolinks.ProgressBar}var i,n,t;return t=Turbolinks.HttpRequest,i=t.NETWORK_FAILURE,n=t.TIMEOUT_FAILURE,e.prototype.visitProposedToLocationWithAction=function(e,t){return this.controller.startVisitToLocationWithAction(e,t)},e.prototype.visitStarted=function(e){return e.issueRequest(),e.changeHistory(),e.loadCachedSnapshot()},e.prototype.visitRequestStarted=function(e){return this.progressBar.setValue(0),e.hasCachedSnapshot()||"restore"!==e.action?this.showProgressBarAfterDelay():this.showProgressBar()},e.prototype.visitRequestProgressed=function(e){return this.progressBar.setValue(e.progress)},e.prototype.visitRequestCompleted=function(e){return e.loadResponse()},e.prototype.visitRequestFailedWithStatusCode=function(e,t){switch(t){case i:case n:return this.reload();default:return e.loadResponse()}},e.prototype.visitRequestFinished=function(){return this.hideProgressBar()},e.prototype.visitCompleted=function(e){return e.followRedirect()},e.prototype.pageInvalidated=function(){return this.reload()},e.prototype.showProgressBarAfterDelay=function(){return this.progressBarTimeout=setTimeout(this.showProgressBar,this.controller.progressBarDelay)},e.prototype.showProgressBar=function(){return this.progressBar.show()},e.prototype.hideProgressBar=function(){return this.progressBar.hide(),clearTimeout(this.progressBarTimeout)},e.prototype.reload=function(){return window.location.reload()},e}()}.call(this),function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.History=function(){function e(e){this.delegate=e,this.onPageLoad=t(this.onPageLoad,this),this.onPopState=t(this.onPopState,this)}return e.prototype.start=function(){return this.started?void 0:(addEventListener("popstate",this.onPopState,!1),addEventListener("load",this.onPageLoad,!1),this.started=!0)},e.prototype.stop=function(){return this.started?(removeEventListener("popstate",this.onPopState,!1),removeEventListener("load",this.onPageLoad,!1),this.started=!1):void 0},e.prototype.push=function(e,t){return e=Turbolinks.Location.wrap(e),this.update("push",e,t)},e.prototype.replace=function(e,t){return e=Turbolinks.Location.wrap(e),this.update("replace",e,t)},e.prototype.onPopState=function(e){var t,i,n,o;return this.shouldHandlePopState()&&(o=null!=(i=e.state)?i.turbolinks:void 0)?(t=Turbolinks.Location.wrap(window.location),n=o.restorationIdentifier,this.delegate.historyPoppedToLocationWithRestorationIdentifier(t,n)):void 0},e.prototype.onPageLoad=function(){return Turbolinks.defer((e=this,function(){return e.pageLoaded=!0}));var e},e.prototype.shouldHandlePopState=function(){return this.pageIsLoaded()},e.prototype.pageIsLoaded=function(){return this.pageLoaded||"complete"===document.readyState},e.prototype.update=function(e,t,i){var n;return n={turbolinks:{restorationIdentifier:i}},history[e+"State"](n,null,t)},e}()}.call(this),function(){Turbolinks.Snapshot=function(){function e(e){var t,i;i=e.head,t=e.body,this.head=null!=i?i:document.createElement("head"),this.body=null!=t?t:document.createElement("body")}return e.wrap=function(e){return e instanceof this?e:this.fromHTML(e)},e.fromHTML=function(e){var t;return(t=document.createElement("html")).innerHTML=e,this.fromElement(t)},e.fromElement=function(e){return new this({head:e.querySelector("head"),body:e.querySelector("body")})},e.prototype.clone=function(){return new e({head:this.head.cloneNode(!0),body:this.body.cloneNode(!0)})},e.prototype.getRootLocation=function(){var e,t;return t=null!=(e=this.getSetting("root"))?e:"/",new Turbolinks.Location(t)},e.prototype.getCacheControlValue=function(){return this.getSetting("cache-control")},e.prototype.getElementForAnchor=function(e){try{return this.body.querySelector("[id='"+e+"'], a[name='"+e+"']")}catch(t){}},e.prototype.hasAnchor=function(e){return null!=this.getElementForAnchor(e)},e.prototype.isPreviewable=function(){return"no-preview"!==this.getCacheControlValue()},e.prototype.isCacheable=function(){return"no-cache"!==this.getCacheControlValue()},e.prototype.isVisitable=function(){return"reload"!==this.getSetting("visit-control")},e.prototype.getSetting=function(e){var t,i;return null!=(t=(i=this.head.querySelectorAll("meta[name='turbolinks-"+e+"']"))[i.length-1])?t.getAttribute("content"):void 0},e}()}.call(this),function(){var r=[].slice;Turbolinks.Renderer=function(){function e(){}var i;return e.render=function(e,t){var i,n,o;return n=e,i=t,(o=function(e,t,i){i.prototype=e.prototype;var n=new i,o=e.apply(n,t);return Object(o)===o?o:n}(this,3<=arguments.length?r.call(arguments,2):[],function(){})).delegate=n,o.render(i),o},e.prototype.renderView=function(e){return this.delegate.viewWillRender(this.newBody),e(),this.delegate.viewRendered(this.newBody)},e.prototype.invalidateView=function(){return this.delegate.viewInvalidated()},e.prototype.createScriptElement=function(e){var t;return"false"===e.getAttribute("data-turbolinks-eval")?e:((t=document.createElement("script")).textContent=e.textContent,t.async=!1,i(t,e),t)},i=function(e,t){var i,n,o,r,s,a,l;for(a=[],i=0,n=(r=t.attributes).length;i<n;i++)o=(s=r[i]).name,l=s.value,a.push(e.setAttribute(o,l));return a},e}()}.call(this),function(){Turbolinks.HeadDetails=function(){function e(e){var t,i,n,o,r,s;for(this.element=e,this.elements={},n=0,r=(s=this.element.childNodes).length;n<r;n++)(i=s[n]).nodeType===Node.ELEMENT_NODE&&(o=i.outerHTML,(null!=(t=this.elements)[o]?t[o]:t[o]={type:l(i),tracked:a(i),elements:[]}).elements.push(i))}var t,i,a,l;return e.prototype.hasElementWithKey=function(e){return e in this.elements},e.prototype.getTrackedElementSignature=function(){var i;return function(){var e,t;for(i in t=[],e=this.elements)e[i].tracked&&t.push(i);return t}.call(this).join("")},e.prototype.getScriptElementsNotInDetails=function(e){return this.getElementsMatchingTypeNotInDetails("script",e)},e.prototype.getStylesheetElementsNotInDetails=function(e){return this.getElementsMatchingTypeNotInDetails("stylesheet",e)},e.prototype.getElementsMatchingTypeNotInDetails=function(e,t){var i,n,o,r,s,a;for(n in s=[],o=this.elements)a=(r=o[n]).type,i=r.elements,a!==e||t.hasElementWithKey(n)||s.push(i[0]);return s},e.prototype.getProvisionalElements=function(){var e,t,i,n,o,r,s;for(t in i=[],n=this.elements)s=(o=n[t]).type,r=o.tracked,e=o.elements,null!=s||r?1<e.length&&i.push.apply(i,e.slice(1)):i.push.apply(i,e);return i},l=function(e){return t(e)?"script":i(e)?"stylesheet":void 0},a=function(e){return"reload"===e.getAttribute("data-turbolinks-track")},t=function(e){return"script"===e.tagName.toLowerCase()},i=function(e){var t;return"style"===(t=e.tagName.toLowerCase())||"link"===t&&"stylesheet"===e.getAttribute("rel")},e}()}.call(this),function(){var i=function(e,t){function i(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;Turbolinks.SnapshotRenderer=function(e){function t(e,t,i){this.currentSnapshot=e,this.newSnapshot=t,this.isPreview=i,this.currentHeadDetails=new Turbolinks.HeadDetails(this.currentSnapshot.head),this.newHeadDetails=new Turbolinks.HeadDetails(this.newSnapshot.head),this.newBody=this.newSnapshot.body}return i(t,e),t.prototype.render=function(e){return this.shouldRender()?(this.mergeHead(),this.renderView((t=this,function(){return t.replaceBody(),t.isPreview||t.focusFirstAutofocusableElement(),e()}))):this.invalidateView();var t},t.prototype.mergeHead=function(){return this.copyNewHeadStylesheetElements(),this.copyNewHeadScriptElements(),this.removeCurrentHeadProvisionalElements(),this.copyNewHeadProvisionalElements()},t.prototype.replaceBody=function(){return this.activateBodyScriptElements(),this.importBodyPermanentElements(),this.assignNewBody()},t.prototype.shouldRender=function(){return this.newSnapshot.isVisitable()&&this.trackedElementsAreIdentical()},t.prototype.trackedElementsAreIdentical=function(){return this.currentHeadDetails.getTrackedElementSignature()===this.newHeadDetails.getTrackedElementSignature()},t.prototype.copyNewHeadStylesheetElements=function(){var e,t,i,n,o;for(o=[],t=0,i=(n=this.getNewHeadStylesheetElements()).length;t<i;t++)e=n[t],o.push(document.head.appendChild(e));return o},t.prototype.copyNewHeadScriptElements=function(){var e,t,i,n,o;for(o=[],t=0,i=(n=this.getNewHeadScriptElements()).length;t<i;t++)e=n[t],o.push(document.head.appendChild(this.createScriptElement(e)));return o},t.prototype.removeCurrentHeadProvisionalElements=function(){var e,t,i,n,o;for(o=[],t=0,i=(n=this.getCurrentHeadProvisionalElements()).length;t<i;t++)e=n[t],o.push(document.head.removeChild(e));return o},t.prototype.copyNewHeadProvisionalElements=function(){var e,t,i,n,o;for(o=[],t=0,i=(n=this.getNewHeadProvisionalElements()).length;t<i;t++)e=n[t],o.push(document.head.appendChild(e));return o},t.prototype.importBodyPermanentElements=function(){var e,t,i,n,o,r;for(r=[],t=0,i=(n=this.getNewBodyPermanentElements()).length;t<i;t++)o=n[t],(e=this.findCurrentBodyPermanentElement(o))?r.push(o.parentNode.replaceChild(e,o)):r.push(void 0);return r},t.prototype.activateBodyScriptElements=function(){var e,t,i,n,o,r;for(r=[],t=0,i=(n=this.getNewBodyScriptElements()).length;t<i;t++)o=n[t],e=this.createScriptElement(o),r.push(o.parentNode.replaceChild(e,o));return r},t.prototype.assignNewBody=function(){return document.body=this.newBody},t.prototype.focusFirstAutofocusableElement=function(){var e;return null!=(e=this.findFirstAutofocusableElement())?e.focus():void 0},t.prototype.getNewHeadStylesheetElements=function(){return this.newHeadDetails.getStylesheetElementsNotInDetails(this.currentHeadDetails)},t.prototype.getNewHeadScriptElements=function(){return this.newHeadDetails.getScriptElementsNotInDetails(this.currentHeadDetails)},t.prototype.getCurrentHeadProvisionalElements=function(){return this.currentHeadDetails.getProvisionalElements()},t.prototype.getNewHeadProvisionalElements=function(){return this.newHeadDetails.getProvisionalElements()},t.prototype.getNewBodyPermanentElements=function(){return this.newBody.querySelectorAll("[id][data-turbolinks-permanent]")},t.prototype.findCurrentBodyPermanentElement=function(e){return document.body.querySelector("#"+e.id+"[data-turbolinks-permanent]")},t.prototype.getNewBodyScriptElements=function(){return this.newBody.querySelectorAll("script")},t.prototype.findFirstAutofocusableElement=function(){return document.body.querySelector("[autofocus]")},t}(Turbolinks.Renderer)}.call(this),function(){var i=function(e,t){function i(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;Turbolinks.ErrorRenderer=function(e){function t(e){this.html=e}return i(t,e),t.prototype.render=function(e){return this.renderView((t=this,function(){return t.replaceDocumentHTML(),t.activateBodyScriptElements(),e()}));var t},
t.prototype.replaceDocumentHTML=function(){return document.documentElement.innerHTML=this.html},t.prototype.activateBodyScriptElements=function(){var e,t,i,n,o,r;for(r=[],t=0,i=(n=this.getScriptElements()).length;t<i;t++)o=n[t],e=this.createScriptElement(o),r.push(o.parentNode.replaceChild(e,o));return r},t.prototype.getScriptElements=function(){return document.documentElement.querySelectorAll("script")},t}(Turbolinks.Renderer)}.call(this),function(){Turbolinks.View=function(){function e(e){this.delegate=e,this.element=document.documentElement}return e.prototype.getRootLocation=function(){return this.getSnapshot().getRootLocation()},e.prototype.getElementForAnchor=function(e){return this.getSnapshot().getElementForAnchor(e)},e.prototype.getSnapshot=function(){return Turbolinks.Snapshot.fromElement(this.element)},e.prototype.render=function(e,t){var i,n,o;return o=e.snapshot,i=e.error,n=e.isPreview,this.markAsPreview(n),null!=o?this.renderSnapshot(o,n,t):this.renderError(i,t)},e.prototype.markAsPreview=function(e){return e?this.element.setAttribute("data-turbolinks-preview",""):this.element.removeAttribute("data-turbolinks-preview")},e.prototype.renderSnapshot=function(e,t,i){return Turbolinks.SnapshotRenderer.render(this.delegate,i,this.getSnapshot(),Turbolinks.Snapshot.wrap(e),t)},e.prototype.renderError=function(e,t){return Turbolinks.ErrorRenderer.render(this.delegate,t,e)},e}()}.call(this),function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.ScrollManager=function(){function e(e){this.delegate=e,this.onScroll=t(this.onScroll,this),this.onScroll=Turbolinks.throttle(this.onScroll)}return e.prototype.start=function(){return this.started?void 0:(addEventListener("scroll",this.onScroll,!1),this.onScroll(),this.started=!0)},e.prototype.stop=function(){return this.started?(removeEventListener("scroll",this.onScroll,!1),this.started=!1):void 0},e.prototype.scrollToElement=function(e){return e.scrollIntoView()},e.prototype.scrollToPosition=function(e){var t,i;return t=e.x,i=e.y,window.scrollTo(t,i)},e.prototype.onScroll=function(){return this.updatePosition({x:window.pageXOffset,y:window.pageYOffset})},e.prototype.updatePosition=function(e){var t;return this.position=e,null!=(t=this.delegate)?t.scrollPositionChanged(this.position):void 0},e}()}.call(this),function(){Turbolinks.SnapshotCache=function(){function e(e){this.size=e,this.keys=[],this.snapshots={}}var n;return e.prototype.has=function(e){return n(e)in this.snapshots},e.prototype.get=function(e){var t;if(this.has(e))return t=this.read(e),this.touch(e),t},e.prototype.put=function(e,t){return this.write(e,t),this.touch(e),t},e.prototype.read=function(e){var t;return t=n(e),this.snapshots[t]},e.prototype.write=function(e,t){var i;return i=n(e),this.snapshots[i]=t},e.prototype.touch=function(e){var t,i;return i=n(e),-1<(t=this.keys.indexOf(i))&&this.keys.splice(t,1),this.keys.unshift(i),this.trim()},e.prototype.trim=function(){var e,t,i,n,o;for(o=[],e=0,i=(n=this.keys.splice(this.size)).length;e<i;e++)t=n[e],o.push(delete this.snapshots[t]);return o},n=function(e){return Turbolinks.Location.wrap(e).toCacheKey()},e}()}.call(this),function(){var n=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.Visit=function(){function e(e,t,i){this.controller=e,this.action=i,this.performScroll=n(this.performScroll,this),this.identifier=Turbolinks.uuid(),this.location=Turbolinks.Location.wrap(t),this.adapter=this.controller.adapter,this.state="initialized",this.timingMetrics={}}var i;return e.prototype.start=function(){return"initialized"===this.state?(this.recordTimingMetric("visitStart"),this.state="started",this.adapter.visitStarted(this)):void 0},e.prototype.cancel=function(){var e;return"started"===this.state?(null!=(e=this.request)&&e.cancel(),this.cancelRender(),this.state="canceled"):void 0},e.prototype.complete=function(){var e;return"started"===this.state?(this.recordTimingMetric("visitEnd"),this.state="completed","function"==typeof(e=this.adapter).visitCompleted&&e.visitCompleted(this),this.controller.visitCompleted(this)):void 0},e.prototype.fail=function(){var e;return"started"===this.state?(this.state="failed","function"==typeof(e=this.adapter).visitFailed?e.visitFailed(this):void 0):void 0},e.prototype.changeHistory=function(){var e,t;return this.historyChanged?void 0:(e=this.location.isEqualTo(this.referrer)?"replace":this.action,t=i(e),this.controller[t](this.location,this.restorationIdentifier),this.historyChanged=!0)},e.prototype.issueRequest=function(){return this.shouldIssueRequest()&&null==this.request?(this.progress=0,this.request=new Turbolinks.HttpRequest(this,this.location,this.referrer),this.request.send()):void 0},e.prototype.getCachedSnapshot=function(){var e;return!(e=this.controller.getCachedSnapshotForLocation(this.location))||null!=this.location.anchor&&!e.hasAnchor(this.location.anchor)||"restore"!==this.action&&!e.isPreviewable()?void 0:e},e.prototype.hasCachedSnapshot=function(){return null!=this.getCachedSnapshot()},e.prototype.loadCachedSnapshot=function(){var t,i;return(i=this.getCachedSnapshot())?(t=this.shouldIssueRequest(),this.render(function(){var e;return this.cacheSnapshot(),this.controller.render({snapshot:i,isPreview:t},this.performScroll),"function"==typeof(e=this.adapter).visitRendered&&e.visitRendered(this),t?void 0:this.complete()})):void 0},e.prototype.loadResponse=function(){return null!=this.response?this.render(function(){var e,t;return this.cacheSnapshot(),this.request.failed?(this.controller.render({error:this.response},this.performScroll),"function"==typeof(e=this.adapter).visitRendered&&e.visitRendered(this),this.fail()):(this.controller.render({snapshot:this.response},this.performScroll),"function"==typeof(t=this.adapter).visitRendered&&t.visitRendered(this),this.complete())}):void 0},e.prototype.followRedirect=function(){return this.redirectedToLocation&&!this.followedRedirect?(this.location=this.redirectedToLocation,this.controller.replaceHistoryWithLocationAndRestorationIdentifier(this.redirectedToLocation,this.restorationIdentifier),this.followedRedirect=!0):void 0},e.prototype.requestStarted=function(){var e;return this.recordTimingMetric("requestStart"),"function"==typeof(e=this.adapter).visitRequestStarted?e.visitRequestStarted(this):void 0},e.prototype.requestProgressed=function(e){var t;return this.progress=e,"function"==typeof(t=this.adapter).visitRequestProgressed?t.visitRequestProgressed(this):void 0},e.prototype.requestCompletedWithResponse=function(e,t){return this.response=e,null!=t&&(this.redirectedToLocation=Turbolinks.Location.wrap(t)),this.adapter.visitRequestCompleted(this)},e.prototype.requestFailedWithStatusCode=function(e,t){return this.response=t,this.adapter.visitRequestFailedWithStatusCode(this,e)},e.prototype.requestFinished=function(){var e;return this.recordTimingMetric("requestEnd"),"function"==typeof(e=this.adapter).visitRequestFinished?e.visitRequestFinished(this):void 0},e.prototype.performScroll=function(){return this.scrolled?void 0:("restore"===this.action?this.scrollToRestoredPosition()||this.scrollToTop():this.scrollToAnchor()||this.scrollToTop(),this.scrolled=!0)},e.prototype.scrollToRestoredPosition=function(){var e,t;return null!=(e=null!=(t=this.restorationData)?t.scrollPosition:void 0)?(this.controller.scrollToPosition(e),!0):void 0},e.prototype.scrollToAnchor=function(){return null!=this.location.anchor?(this.controller.scrollToAnchor(this.location.anchor),!0):void 0},e.prototype.scrollToTop=function(){return this.controller.scrollToPosition({x:0,y:0})},e.prototype.recordTimingMetric=function(e){var t;return null!=(t=this.timingMetrics)[e]?t[e]:t[e]=(new Date).getTime()},e.prototype.getTimingMetrics=function(){return Turbolinks.copyObject(this.timingMetrics)},i=function(e){switch(e){case"replace":return"replaceHistoryWithLocationAndRestorationIdentifier";case"advance":case"restore":return"pushHistoryWithLocationAndRestorationIdentifier"}},e.prototype.shouldIssueRequest=function(){return"restore"!==this.action||!this.hasCachedSnapshot()},e.prototype.cacheSnapshot=function(){return this.snapshotCached?void 0:(this.controller.cacheSnapshot(),this.snapshotCached=!0)},e.prototype.render=function(e){return this.cancelRender(),this.frame=requestAnimationFrame((t=this,function(){return t.frame=null,e.call(t)}));var t},e.prototype.cancelRender=function(){return this.frame?cancelAnimationFrame(this.frame):void 0},e}()}.call(this),function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};Turbolinks.Controller=function(){function e(){this.clickBubbled=t(this.clickBubbled,this),this.clickCaptured=t(this.clickCaptured,this),this.pageLoaded=t(this.pageLoaded,this),this.history=new Turbolinks.History(this),this.view=new Turbolinks.View(this),this.scrollManager=new Turbolinks.ScrollManager(this),this.restorationData={},this.clearCache(),this.setProgressBarDelay(500)}return e.prototype.start=function(){return Turbolinks.supported&&!this.started?(addEventListener("click",this.clickCaptured,!0),addEventListener("DOMContentLoaded",this.pageLoaded,!1),this.scrollManager.start(),this.startHistory(),this.started=!0,this.enabled=!0):void 0},e.prototype.disable=function(){return this.enabled=!1},e.prototype.stop=function(){return this.started?(removeEventListener("click",this.clickCaptured,!0),removeEventListener("DOMContentLoaded",this.pageLoaded,!1),this.scrollManager.stop(),this.stopHistory(),this.started=!1):void 0},e.prototype.clearCache=function(){return this.cache=new Turbolinks.SnapshotCache(10)},e.prototype.visit=function(e,t){var i,n;return null==t&&(t={}),e=Turbolinks.Location.wrap(e),this.applicationAllowsVisitingLocation(e)?this.locationIsVisitable(e)?(i=null!=(n=t.action)?n:"advance",this.adapter.visitProposedToLocationWithAction(e,i)):window.location=e:void 0},e.prototype.startVisitToLocationWithAction=function(e,t,i){var n;return Turbolinks.supported?(n=this.getRestorationDataForIdentifier(i),this.startVisit(e,t,{restorationData:n})):window.location=e},e.prototype.setProgressBarDelay=function(e){return this.progressBarDelay=e},e.prototype.startHistory=function(){return this.location=Turbolinks.Location.wrap(window.location),this.restorationIdentifier=Turbolinks.uuid(),this.history.start(),this.history.replace(this.location,this.restorationIdentifier)},e.prototype.stopHistory=function(){return this.history.stop()},e.prototype.pushHistoryWithLocationAndRestorationIdentifier=function(e,t){return this.restorationIdentifier=t,this.location=Turbolinks.Location.wrap(e),this.history.push(this.location,this.restorationIdentifier)},e.prototype.replaceHistoryWithLocationAndRestorationIdentifier=function(e,t){return this.restorationIdentifier=t,this.location=Turbolinks.Location.wrap(e),this.history.replace(this.location,this.restorationIdentifier)},e.prototype.historyPoppedToLocationWithRestorationIdentifier=function(e,t){var i;return this.restorationIdentifier=t,this.enabled?(i=this.getRestorationDataForIdentifier(this.restorationIdentifier),this.startVisit(e,"restore",{restorationIdentifier:this.restorationIdentifier,restorationData:i,historyChanged:!0}),this.location=Turbolinks.Location.wrap(e)):this.adapter.pageInvalidated()},e.prototype.getCachedSnapshotForLocation=function(e){var t;return(t=this.cache.get(e))?t.clone():void 0},e.prototype.shouldCacheSnapshot=function(){return this.view.getSnapshot().isCacheable()},e.prototype.cacheSnapshot=function(){var e;return this.shouldCacheSnapshot()?(this.notifyApplicationBeforeCachingSnapshot(),e=this.view.getSnapshot(),this.cache.put(this.lastRenderedLocation,e.clone())):void 0},e.prototype.scrollToAnchor=function(e){var t;return(t=this.view.getElementForAnchor(e))?this.scrollToElement(t):this.scrollToPosition({x:0,y:0})},e.prototype.scrollToElement=function(e){return this.scrollManager.scrollToElement(e)},e.prototype.scrollToPosition=function(e){return this.scrollManager.scrollToPosition(e)},e.prototype.scrollPositionChanged=function(e){return this.getCurrentRestorationData().scrollPosition=e},e.prototype.render=function(e,t){return this.view.render(e,t)},e.prototype.viewInvalidated=function(){return this.adapter.pageInvalidated()},e.prototype.viewWillRender=function(e){return this.notifyApplicationBeforeRender(e)},e.prototype.viewRendered=function(){return this.lastRenderedLocation=this.currentVisit.location,this.notifyApplicationAfterRender()},e.prototype.pageLoaded=function(){return this.lastRenderedLocation=this.location,this.notifyApplicationAfterPageLoad()},e.prototype.clickCaptured=function(){return removeEventListener("click",this.clickBubbled,!1),addEventListener("click",this.clickBubbled,!1)},e.prototype.clickBubbled=function(e){var t,i,n;return this.enabled&&this.clickEventIsSignificant(e)&&(i=this.getVisitableLinkForNode(e.target))&&(n=this.getVisitableLocationForLink(i))&&this.applicationAllowsFollowingLinkToLocation(i,n)?(e.preventDefault(),t=this.getActionForLink(i),this.visit(n,{action:t})):void 0},e.prototype.applicationAllowsFollowingLinkToLocation=function(e,t){return!this.notifyApplicationAfterClickingLinkToLocation(e,t).defaultPrevented},e.prototype.applicationAllowsVisitingLocation=function(e){return!this.notifyApplicationBeforeVisitingLocation(e).defaultPrevented},e.prototype.notifyApplicationAfterClickingLinkToLocation=function(e,t){return Turbolinks.dispatch("turbolinks:click",{target:e,data:{url:t.absoluteURL},cancelable:!0})},e.prototype.notifyApplicationBeforeVisitingLocation=function(e){return Turbolinks.dispatch("turbolinks:before-visit",{data:{url:e.absoluteURL},cancelable:!0})},e.prototype.notifyApplicationAfterVisitingLocation=function(e){return Turbolinks.dispatch("turbolinks:visit",{data:{url:e.absoluteURL}})},e.prototype.notifyApplicationBeforeCachingSnapshot=function(){return Turbolinks.dispatch("turbolinks:before-cache")},e.prototype.notifyApplicationBeforeRender=function(e){return Turbolinks.dispatch("turbolinks:before-render",{data:{newBody:e}})},e.prototype.notifyApplicationAfterRender=function(){return Turbolinks.dispatch("turbolinks:render")},e.prototype.notifyApplicationAfterPageLoad=function(e){return null==e&&(e={}),Turbolinks.dispatch("turbolinks:load",{data:{url:this.location.absoluteURL,timing:e}})},e.prototype.startVisit=function(e,t,i){var n;return null!=(n=this.currentVisit)&&n.cancel(),this.currentVisit=this.createVisit(e,t,i),this.currentVisit.start(),this.notifyApplicationAfterVisitingLocation(e)},e.prototype.createVisit=function(e,t,i){var n,o,r,s,a;return s=(o=null!=i?i:{}).restorationIdentifier,r=o.restorationData,n=o.historyChanged,(a=new Turbolinks.Visit(this,e,t)).restorationIdentifier=null!=s?s:Turbolinks.uuid(),a.restorationData=Turbolinks.copyObject(r),a.historyChanged=n,a.referrer=this.location,a},e.prototype.visitCompleted=function(e){return this.notifyApplicationAfterPageLoad(e.getTimingMetrics())},e.prototype.clickEventIsSignificant=function(e){return!(e.defaultPrevented||e.target.isContentEditable||1<e.which||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)},e.prototype.getVisitableLinkForNode=function(e){return this.nodeIsVisitable(e)?Turbolinks.closest(e,"a[href]:not([target]):not([download])"):void 0},e.prototype.getVisitableLocationForLink=function(e){var t;return t=new Turbolinks.Location(e.getAttribute("href")),this.locationIsVisitable(t)?t:void 0},e.prototype.getActionForLink=function(e){var t;return null!=(t=e.getAttribute("data-turbolinks-action"))?t:"advance"},e.prototype.nodeIsVisitable=function(e){var t;return!(t=Turbolinks.closest(e,"[data-turbolinks]"))||"false"!==t.getAttribute("data-turbolinks")},e.prototype.locationIsVisitable=function(e){return e.isPrefixedBy(this.view.getRootLocation())&&e.isHTML()},e.prototype.getCurrentRestorationData=function(){return this.getRestorationDataForIdentifier(this.restorationIdentifier)},e.prototype.getRestorationDataForIdentifier=function(e){var t;return null!=(t=this.restorationData)[e]?t[e]:t[e]={}},e}()}.call(this),function(){!function(){var e,t;if((e=t=document.currentScript)&&!t.hasAttribute("data-turbolinks-suppress-warning"))for(;e=e.parentNode;)if(e===document.body)return console.warn("You are loading Turbolinks from a <script> element inside the <body> element. This is probably not what you meant to do!\n\nLoad your application\u2019s JavaScript bundle inside the <head> element instead. <script> elements in <body> are evaluated with each page change.\n\nFor more information, see: https://github.com/turbolinks/turbolinks#working-with-script-elements\n\n\u2014\u2014\nSuppress this warning by adding a `data-turbolinks-suppress-warning` attribute to: %s",t.outerHTML)}()}.call(this),function(){var e,t,i;Turbolinks.start=function(){return t()?(null==Turbolinks.controller&&(Turbolinks.controller=e()),Turbolinks.controller.start()):void 0},t=function(){return null==window.Turbolinks&&(window.Turbolinks=Turbolinks),i()},e=function(){var e;return(e=new Turbolinks.Controller).adapter=new Turbolinks.BrowserAdapter(e),e},(i=function(){return window.Turbolinks===Turbolinks})()&&Turbolinks.start()}.call(this),function(n){n.version={versionStr:"2.3.1",major:parseInt("2",10),minor:parseInt("3",10),revision:parseInt("1",10)};var e,t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,o=Object.prototype.hasOwnProperty;n.isFunction=function(e){return"function"===n.type(e)},n.isArray=Array.isArray||function(e){return"array"===n.type(e)},n.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},n.type=function(e){return null===e||e===undefined?String(e):t[i.call(e)]||"object"},n.isPlainObject=function(e){if(!e||"object"!==OpenSeadragon.type(e)||e.nodeType||n.isWindow(e))return!1;if(e.constructor&&!o.call(e,"constructor")&&!o.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(var i in e)t=i;return t===undefined||o.call(e,t)},n.isEmptyObject=function(e){for(var t in e)return!1;return!0},n.freezeObject=function(e){return Object.freeze?n.freezeObject=Object.freeze:n.freezeObject=function(e){return e},n.freezeObject(e)},n.supportsCanvas=(e=document.createElement("canvas"),!(!n.isFunction(e.getContext)||!e.getContext("2d"))),n.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(i){t=!0}return t},n.pixelDensityRatio=function(){if(n.supportsCanvas){var e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(t,1)/i}return 1}()}(OpenSeadragon),function($){function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}$.extend=function(e,t){var i,n,o,r,s,a,l=e||{},c=arguments.length,h=!1,u=1;for("boolean"==typeof l&&(h=l,l=t||{},u=2),"object"==typeof l||OpenSeadragon.isFunction(l)||(l={}),c===u&&(l=this,--u);u<c;u++)if(null!==(i=arguments[u])||i!==undefined)for(n in i)o=l[n],l!==(r=i[n])&&(h&&r&&(OpenSeadragon.isPlainObject(r)||(s=OpenSeadragon.isArray(r)))?(s?(s=!1,a=o&&OpenSeadragon.isArray(o)?o:[]):a=o&&OpenSeadragon.isPlainObject(o)?o:{},l[n]=OpenSeadragon.extend(h,a,r)):r!==undefined&&(l[n]=r));return l};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,preload:!1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"",navImages:{zoomIn:{REST:"/assets/openseadragon/zoomin_rest-674258f78d924bfe2454a637ecf912fe7069105ab68980f69674ff5c25521ed9.png",GROUP:"/assets/openseadragon/zoomin_grouphover-ecd40589890cdfd81911752c4af02c691a201c21d74bbad5f3d9336463b52604.png",HOVER:"/assets/openseadragon/zoomin_hover-6a2c08cf07b12162f73e80417d6e49e7da4b219981c9929abf89fbd1a18b58a2.png",DOWN:"/assets/openseadragon/zoomin_pressed-b9eb902ca333aaabd8cf77c1184a6aa24311bcba0d836dc6ebded4c5d7146475.png"},zoomOut:{REST:"/assets/openseadragon/zoomout_rest-a4ff50ab46d8de87c720cb9cbccc9b4bef1cdda1394b9c8a2b4e6fb2f63e13aa.png",GROUP:"/assets/openseadragon/zoomout_grouphover-b582631f7ede7c640c46a29d74728814d3b7332b14748054ae460aa9be929e77.png",HOVER:"/assets/openseadragon/zoomout_hover-b752facaf76d197e235dd789929e86577339ffa280b6a51621388f2cad9900e1.png",DOWN:"/assets/openseadragon/zoomout_pressed-99ce17d25e10d07ebe3a21642eb350bfd80c603cbb6a4b0af705fbcdf8ca57dc.png"},home:{REST:"/assets/openseadragon/home_rest-6fd27483f507bf8b4a15d6c60d43e9bb3bd14b84959973d61a622bbb4777dfc9.png",GROUP:"/assets/openseadragon/home_grouphover-2f2dfd6ed6fd11c1aec5491c36f071cf51a96712ddac54b803a8fee917ce27d8.png",HOVER:"/assets/openseadragon/home_hover-170fc906037fe8707d3757775ea4ccb3ebbf883329c44473cd247d0f22c320d9.png",DOWN:"/assets/openseadragon/home_pressed-e8a08eb8d9862e63c8df96fbe508956ae031b09d85533adf83e094c5b187833c.png"},fullpage:{REST:"/assets/openseadragon/fullpage_rest-1b7ae93b3fe5d0df99e196bfe22b93c7f05d2d5e0fdf97b8b8e957e5476ff586.png",GROUP:"/assets/openseadragon/fullpage_grouphover-f96415fcf86eff56b664f2328ffd61972b98738874d995e077091344f59fc26b.png",HOVER:"/assets/openseadragon/fullpage_hover-3cc954037484edb4a74d97a374605301b4da04c034981af70ec0ec3e1bb509a8.png",DOWN:"/assets/openseadragon/fullpage_pressed-7b3d188695ec59993a09cf27dde280b1da93fd43360f721642b42229b9e5e817.png"},rotateleft:{REST:"/assets/openseadragon/rotateleft_rest-ab4731e3c7d7a4b40ea07c16269e8117ce58506177dc438cc00cdf837f513f09.png",GROUP:"/assets/openseadragon/rotateleft_grouphover-35d3cf9efe958bd88ae0c532648403824df252fa6835aa586301b19c80c264e3.png",HOVER:"/assets/openseadragon/rotateleft_hover-59fee051c2aff4c8491255be664f87671c089db4863f933989b10263818cf435.png",DOWN:"/assets/openseadragon/rotateleft_pressed-97d28095eb471109d0aee65f9f4dc5ee6dba6d7fed433e3a910dcda69ca4a977.png"},rotateright:{REST:"/assets/openseadragon/rotateright_rest-c201ce35f6651e824eee3eb5ca3e42fc40035d2070eec9ce1261c8b7bc126526.png",GROUP:"/assets/openseadragon/rotateright_grouphover-ebdaf54f82601db210a5ac2e0a54790c0decd8dea5bd115f7d6d0d2bf04c5e00.png",HOVER:"/assets/openseadragon/rotateright_hover-a9124016ebe30ec16f3691a16cc57997174652f480f3002d45beaf918b1230c1.png",DOWN:"/assets/openseadragon/rotateright_pressed-a75e74dab723a0587d365e4b076572d1440df9f31c424ef4a6be62f3a45d472b.png"},previous:{REST:"/assets/openseadragon/previous_rest-56999fcbe41a0ebb5d701fb463caea0e3850478d1f869e2e7a73b7dc363ca2e2.png",GROUP:"/assets/openseadragon/previous_grouphover-c7e82a94049ff615a7dc6f78ae3758d7d33eab41a69093d9c1101c164c07fe8b.png",HOVER:"/assets/openseadragon/previous_hover-94126f0047e7901b3d2e408abb58b20744a7251786746d7508624db5b4c81bce.png",DOWN:"/assets/openseadragon/previous_pressed-b80145c436ff5cd94c3f672eed9f1723fcd13077870337874171e99dee9f9929.png"},next:{REST:"/assets/openseadragon/next_rest-d9b1965f3bcddd3db23e63037a27152c1b7528811582c68b7b4bf25b8673fe07.png",GROUP:"/assets/openseadragon/next_grouphover-e7c76fb2c8a792a63efe2ad76da276fd079f50ec0df2b03b04bfc36cfc217103.png",HOVER:"/assets/openseadragon/next_hover-67210c1194693f480cfe9935281fd447a86c46b65e67ce182632cb518dfd2bb9.png",DOWN:"/assets/openseadragon/next_pressed-95afb05783b4c599eec66a21a2b98ea09d6b0be41cce42ed512239cede37a1ab.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(t,i){return function(){var e=arguments;return e===undefined&&(e=[]),i.apply(t,e)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,i,n=new $.Point;for(i=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);i;)n.x+=e.offsetLeft,n.y+=e.offsetTop,t&&(n=n.plus($.getPageScroll())),i=getOffsetParent(e=i,t="fixed"==$.getElementStyle(e).position);return n},getElementOffset:function(e){var t,i,n=(e=$.getElement(e))&&e.ownerDocument,o={top:0,left:0};return n?(t=n.documentElement,typeof e.getBoundingClientRect!=typeof undefined&&(o=e.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(o.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),o.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var a={};return $.getCssPropertyWithVendorPrefix=function(e){if(a[e]!==undefined)return a[e];var t=document.createElement("div").style,i=null;if(t[e]!==undefined)i=e;else for(var n=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(e),r=0;r<n.length;r++){var s=n[r]+o;if(t[s]!==undefined){i=s;break}}return a[e]=i},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),n=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+n.x&&t.y<i.y+n.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if("undefined"!=typeof window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),i=null;return(i=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){i.style.width=i.style.width||t.width+"px",i.style.height=i.style.height||t.height+"px",t.onload=null,t=null},t.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",i}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var n;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(n="alpha(opacity="+Math.round(100*t)+")",e.style.filter=n):e.style.filter=""},setElementTouchActionNone:function(e){"undefined"!=typeof(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":"undefined"!=typeof e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,o,r=i||0;if(!e)throw new TypeError;if(0===(o=e.length)||o<=r)return-1;for(r<0&&(r=o-Math.abs(r)),n=r;n<o;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){var i,n,o=[];for(i=(e=$.getElement(e)).className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==t&&o.push(i[n]);e.className=o.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,n){(e=$.getElement(e)).addEventListener(t,i,n)};if(window.attachEvent)return function(e,t,i){
(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,n){(e=$.getElement(e)).removeEventListener(t,i,n)};if(window.detachEvent)return function(e,t,i){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(i,n){var e,o=[];for(e=2;e<arguments.length;e++)o.push(arguments[e]);return function(){var e,t=o.concat([]);for(e=0;e<arguments.length;e++)t.push(arguments[e]);return n.apply(i,t)}},getUrlParameter:function(e){var t=URLPARAMS[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(i){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){var n,o,r;$.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,o=e.headers,r=e.responseType||null,e=e.url);var s=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},200<=a.status&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?t(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(i)&&i(a)))};try{if(a.open("GET",e,!0),r&&(a.responseType=r),o)for(var l in o)o.hasOwnProperty(l)&&o[l]&&a.setRequestHeader(l,o[l]);n&&(a.withCredentials=!0),a.send(null)}catch(d){var c=d.message,h=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(h&&"undefined"!=typeof d.number&&-2147024891==d.number&&(c+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",d.name,c),a.onreadystatechange=function(){},window.XDomainRequest){var u=new XDomainRequest;if(u){u.onload=function(){$.isFunction(t)&&t({responseText:u.responseText,status:200,statusText:"OK"})},u.onerror=function(){$.isFunction(i)&&i({responseText:u.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{u.open("GET",e),u.send()}catch(p){$.isFunction(i)&&i(a,d)}}}else $.isFunction(i)&&i(a,d)}return a},jsonp:function(e){var i,t=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,o=e.callbackName||"openseadragon"+$.now(),r=window[o],s="$1"+o+"$2",a=e.param||"callback",l=e.callback;t=t.replace(/(\=)\?(&|$)|\?\?/i,s),t+=(/\?/.test(t)?"&":"?")+a+"="+o,window[o]=function(e){if(r)window[o]=r;else try{delete window[o]}catch(t){}l&&$.isFunction(l)&&l(e)},i=document.createElement("script"),undefined===e.async&&!1===e.async||(i.async="async"),e.scriptCharset&&(i.charset=e.scriptCharset),i.src=t,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=undefined)},n.insertBefore(i,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=t.indexOf("Firefox")?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):0<=t.indexOf("Safari")?($.Browser.vendor=0<=t.indexOf("Chrome")?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var i,n,o,r=window.location.search.substring(1).split("&");for(o=0;o<r.length;o++)0<(n=(i=r[o]).indexOf("="))&&(URLPARAMS[i.substring(0,n)]=decodeURIComponent(i.substring(n+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,i=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&i)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return i.apply(e,arguments)};else{var n,o=[],r=[],s=0;$.requestAnimationFrame=function(e){return o.push([++s,e]),n||(n=setInterval(function(){if(o.length){var e=$.now(),t=r;for(r=o,o=t;r.length;)r.shift()[1](e)}else clearInterval(n),n=undefined},20)),s},$.cancelAnimationFrame=function(e){var t,i;for(t=0,i=o.length;t<i;t+=1)if(o[t][0]===e)return void o.splice(t,1);for(t=0,i=r.length;t<i;t+=1)if(r[t][0]===e)return void r.splice(t,1)}}}(window)}(OpenSeadragon),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t()}(this,function(){return OpenSeadragon}),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(e){return e.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(r){r.EventSource=function(){this.events={}},r.EventSource.prototype={addOnceHandler:function(t,i,e,n){var o=this;n=n||1;var r=0,s=function(e){++r===n&&o.removeHandler(t,s),i(e)};this.addHandler(t,s,e)},addHandler:function(e,t,i){var n=this.events[e];n||(this.events[e]=n=[]),t&&r.isFunction(t)&&(n[n.length]={handler:t,userData:i||null})},removeHandler:function(e,t){var i,n=this.events[e],o=[];if(n&&r.isArray(n)){for(i=0;i<n.length;i++)n[i].handler!==t&&o.push(n[i]);this.events[e]=o}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var o=this.events[e];return o&&o.length?(o=1===o.length?[o[0]]:Array.apply(null,o),function(e,t){var i,n=o.length;for(i=0;i<n;i++)o[i]&&(t.eventSource=e,t.userData=o[i].userData,o[i].handler(t))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(m){function o(e){var t,i=Se[e.hash],n=i.activePointersLists.length;for(t=0;t<n;t++)0<i.activePointersLists[t].captureCount&&(m.removeEvent(m.MouseTracker.captureElement,"mousemove",i.mousemovecaptured,!0),m.removeEvent(m.MouseTracker.captureElement,"mouseup",i.mouseupcaptured,!0),m.removeEvent(m.MouseTracker.captureElement,m.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",i.pointermovecaptured,!0),m.removeEvent(m.MouseTracker.captureElement,m.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",i.pointerupcaptured,!0),m.removeEvent(m.MouseTracker.captureElement,"touchmove",i.touchmovecaptured,!0),m.removeEvent(m.MouseTracker.captureElement,"touchend",i.touchendcaptured,!0),i.activePointersLists[t].captureCount=0);for(t=0;t<n;t++)i.activePointersLists.pop()}function t(e){var t,i,n=Se[e.hash];if(!n.tracking){for(i=0;i<m.MouseTracker.subscribeEvents.length;i++)t=m.MouseTracker.subscribeEvents[i],m.addEvent(e.element,t,n[t],!1);o(e),n.tracking=!0}}function i(e){var t,i,n=Se[e.hash];if(n.tracking){for(i=0;i<m.MouseTracker.subscribeEvents.length;i++)t=m.MouseTracker.subscribeEvents[i],m.removeEvent(e.element,t,n[t],!1);o(e),n.tracking=!1}}function r(e,t){var i=Se[e.hash];if("pointerevent"===t)return{upName:m.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:i.pointerupcaptured,moveName:m.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:i.pointermovecaptured};if("mouse"===t)return{upName:"mouseup",upHandler:i.mouseupcaptured,moveName:"mousemove",moveHandler:i.mousemovecaptured};if("touch"===t)return{upName:"touchend",upHandler:i.touchendcaptured,moveName:"touchmove",moveHandler:i.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function c(e,t,i){var n,o=e.getActivePointersListByType(t);o.captureCount+=i||1,1===o.captureCount&&(m.Browser.vendor===m.BROWSERS.IE&&m.Browser.version<9?e.element.setCapture(!0):(n=r(e,m.MouseTracker.havePointerEvents?"pointerevent":t),be&&ge(window.top)&&m.addEvent(window.top,n.upName,n.upHandler,!0),m.addEvent(m.MouseTracker.captureElement,n.upName,n.upHandler,!0),m.addEvent(m.MouseTracker.captureElement,n.moveName,n.moveHandler,!0)))}function l(e,t,i){var n,o=e.getActivePointersListByType(t);o.captureCount-=i||1,0===o.captureCount&&(m.Browser.vendor===m.BROWSERS.IE&&m.Browser.version<9?e.element.releaseCapture():(n=r(e,m.MouseTracker.havePointerEvents?"pointerevent":t),be&&ge(window.top)&&m.removeEvent(window.top,n.upName,n.upHandler,!0),m.removeEvent(m.MouseTracker.captureElement,n.moveName,n.moveHandler,!0),m.removeEvent(m.MouseTracker.captureElement,n.upName,n.upHandler,!0)))}function n(e){var t;if(m.MouseTracker.unprefixedPointerEvents)t=e.pointerType;else switch(e.pointerType){case 2:t="touch";break;case 3:t="pen";break;case 4:t="mouse";break;default:t=""}return t}function h(e){return m.getMousePosition(e)}function s(e,t){return f(h(e),t)}function f(e,t){var i=m.getElementOffset(t);return e.minus(i)}function v(e,t){return new m.Point((e.x+t.x)/2,(e.y+t.y)/2)}function a(e,t){e.clickHandler&&m.cancelEvent(t)}function u(e,t){e.dblClickHandler&&m.cancelEvent(t)}function d(e,t){e.keyDownHandler&&(t=m.getEvent(t),e.keyDownHandler({eventSource:e,keyCode:t.keyCode?t.keyCode:t.charCode,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData})||m.cancelEvent(t))}function p(e,t){e.keyUpHandler&&(t=m.getEvent(t),e.keyUpHandler({eventSource:e,keyCode:t.keyCode?t.keyCode:t.charCode,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData})||m.cancelEvent(t))}function g(e,t){e.keyHandler&&(t=m.getEvent(t),e.keyHandler({eventSource:e,keyCode:t.keyCode?t.keyCode:t.charCode,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData})||m.cancelEvent(t))}function y(e,t){e.focusHandler&&(t=m.getEvent(t),!1===e.focusHandler({eventSource:e,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t))}function w(e,t){e.blurHandler&&(t=m.getEvent(t),!1===e.blurHandler({eventSource:e,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t))}function T(e,t){b(e,t,t)}function S(e,t){var i={target:(t=m.getEvent(t)).target||t.srcElement,type:"wheel",shiftKey:t.shiftKey||!1,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX?t.pageX:t.clientX,pageY:t.pageY?t.pageY:t.clientY,deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==m.MouseTracker.wheelEventName?i.deltaY=-t.wheelDelta/m.DEFAULT_SETTINGS.pixelsPerWheelLine:i.deltaY=t.detail,b(e,i,t)}function b(e,t,i){var n=0;n=t.deltaY<0?1:-1,e.scrollHandler&&!1===e.scrollHandler({eventSource:e,pointerType:"mouse",position:s(t,e.element),scroll:n,shift:t.shiftKey,isTouchEvent:!1,originalEvent:i,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(i)}function x(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function E(e,t){R(e,t=m.getEvent(t))}function P(e,t){(t=m.getEvent(t)).currentTarget===t.relatedTarget||x(t.currentTarget,t.relatedTarget)||R(e,t)}function R(e,t){ae(e,t,[{id:m.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(t),currentTime:m.now()}])}function C(e,t){k(e,t=m.getEvent(t))}function _(e,t){(t=m.getEvent(t)).currentTarget===t.relatedTarget||x(t.currentTarget,t.relatedTarget)||k(e,t)}function k(e,t){le(e,t,[{id:m.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(t),currentTime:m.now()}])}function I(e){return m.Browser.vendor===m.BROWSERS.IE&&m.Browser.version<9?1===e?0:2===e?2:4===e?1:-1:e}function O(e,t){ce(e,t=m.getEvent(t),[{id:m.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(t),currentTime:m.now()}],I(t.button))&&(m.stopEvent(t),c(e,"mouse")),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler)&&m.cancelEvent(t)}function L(e,t){B(e,t)}function D(e,t){B(e,t),m.stopEvent(t)}function B(e,t){he(e,t=m.getEvent(t),[{id:m.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(t),currentTime:m.now()}],I(t.button))&&l(e,"mouse")}function M(e,t){A(e,t)}function H(e,t){A(e,t),m.stopEvent(t)}function A(e,t){ue(e,t=m.getEvent(t),[{id:m.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(t),currentTime:m.now()}])}function F(e,t,i){var n,o=i.getLength(),r=[];if("touch"===i.type||0<i.contacts){for(n=0;n<o;n++)r.push(i.getByIndex(n));0<r.length&&(he(e,t,r,0),i.captureCount=1,l(e,i.type),le(e,t,r))}}function z(e,t){var i,n,o,r,s=t.changedTouches.length,a=[],l=e.getActivePointersListByType("touch");for(i=m.now(),l.getLength()>t.touches.length-s&&(m.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),F(e,t,l)),n=0;n<s;n++)a.push({id:t.changedTouches[n].identifier,type:"touch",currentPos:h(t.changedTouches[n]),currentTime:i});for(ae(e,t,a),n=0;n<Te.length;n++)if(Te[n]!==e&&Te[n].isTracking()&&x(Te[n].element,e.element)){for(r=[],o=0;o<s;o++)r.push({id:t.changedTouches[o].identifier,type:"touch",currentPos:h(t.changedTouches[o]),currentTime:i});ae(Te[n],t,r)}ce(e,t,a,0)&&(m.stopEvent(t),c(e,"touch",s)),m.cancelEvent(t)}function N(e,t){j(e,t)}function W(e,t){j(e,t),m.stopEvent(t)}function j(e,t){var i,n,o,r,s=t.changedTouches.length,a=[];for(i=m.now(),n=0;n<s;n++)a.push({id:t.changedTouches[n].identifier,type:"touch",currentPos:h(t.changedTouches[n]),currentTime:i});for(he(e,t,a,0)&&l(e,"touch",s),le(e,t,a),n=0;n<Te.length;n++)if(Te[n]!==e&&Te[n].isTracking()&&x(Te[n].element,e.element)){for(r=[],o=0;o<s;o++)r.push({id:t.changedTouches[o].identifier,type:"touch",currentPos:h(t.changedTouches[o]),currentTime:i});le(Te[n],t,r)}m.cancelEvent(t)}function q(e,t){U(e,t)}function V(e,t){U(e,t),m.stopEvent(t)}function U(e,t){var i,n=t.changedTouches.length,o=[];for(i=0;i<n;i++)o.push({id:t.changedTouches[i].identifier,type:"touch",currentPos:h(t.changedTouches[i]),currentTime:m.now()});ue(e,t,o),m.cancelEvent(t)}function G(e,t){F(e,t,e.getActivePointersListByType("touch"))}function $(e,t){return t.stopPropagation(),t.preventDefault(),!1}function Z(e,t){return t.stopPropagation(),t.preventDefault(),!1}function X(e,t){t.currentTarget===t.relatedTarget||x(t.currentTarget,t.relatedTarget)||ae(e,t,[{id:t.pointerId,type:n(t),isPrimary:t.isPrimary,currentPos:h(t),currentTime:m.now()}])}function K(e,t){t.currentTarget===t.relatedTarget||x(t.currentTarget,t.relatedTarget)||le(e,t,[{id:t.pointerId,type:n(t),isPrimary:t.isPrimary,currentPos:h(t),currentTime:m.now()}])}function Y(e,t){var i;ce(e,t,[i={id:t.pointerId,type:n(t),isPrimary:t.isPrimary,currentPos:h(t),currentTime:m.now()}],t.button)&&(m.stopEvent(t),c(e,i.type)),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler||e.pinchHandler)&&m.cancelEvent(t)}function Q(e,t){ee(e,t)}function J(e,t){e.getActivePointersListByType(n(t)).getById(t.pointerId)&&ee(e,t),m.stopEvent(t)}function ee(e,t){var i;he(e,t,[i={id:t.pointerId,type:n(t),isPrimary:t.isPrimary,currentPos:h(t),currentTime:m.now()}],t.button)&&l(e,i.type)}function te(e,t){ne(e,t)}function ie(e,t){e.getActivePointersListByType(n(t)).getById(t.pointerId)&&ne(e,t),m.stopEvent(t)}function ne(e,t){ue(e,t,[{id:t.pointerId,type:n(t),isPrimary:t.isPrimary,currentPos:h(t),currentTime:m.now()}])}function oe(e,t){de(e,t,[{id:t.pointerId,type:n(t)}])}function re(e,t){return t.hasOwnProperty("isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function se(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),t.hasOwnProperty("isPrimary")||(n=e.getPrimary())||(n=e.getByIndex(0))&&(n.isPrimary=!0)):i=e.getLength(),i}function ae(e,t,i){var n,o,r,s=e.getActivePointersListByType(i[0].type),a=i.length;for(n=0;n<a;n++)o=i[n],(r=s.getById(o.id))?(r.insideElement=!0,r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=o.currentPos,r.currentTime=o.currentTime,o=r):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,re(s,o)),e.enterHandler&&!1===e.enterHandler({eventSource:e,pointerType:o.type,position:f(o.currentPos,e.element),buttons:s.buttons,pointers:e.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==s.buttons,isTouchEvent:"touch"===o.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t)}function le(e,t,i){var n,o,r,s=e.getActivePointersListByType(i[0].type),a=i.length;for(n=0;n<a;n++)o=i[n],(r=s.getById(o.id))&&(r.captured?(r.insideElement=!1,r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=o.currentPos,r.currentTime=o.currentTime):se(s,r),o=r),e.exitHandler&&!1===e.exitHandler({eventSource:e,pointerType:o.type,position:f(o.currentPos,e.element),buttons:s.buttons,pointers:e.getActivePointerCount(),insideElementPressed:!!r&&r.insideElementPressed,buttonDownAny:0!==s.buttons,isTouchEvent:"touch"===o.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t)}function ce(e,t,i,n){var o,r,s,a=Se[e.hash],l=e.getActivePointersListByType(i[0].type),c=i.length;"undefined"!=typeof t.buttons?l.buttons=t.buttons:m.Browser.vendor===m.BROWSERS.IE&&m.Browser.version<9?0===n?l.buttons+=1:1===n?l.buttons+=4:2===n?l.buttons+=2:3===n?l.buttons+=8:4===n?l.buttons+=16:5===n&&(l.buttons+=32):0===n?l.buttons|=1:1===n?l.buttons|=4:2===n?l.buttons|=2:3===n?l.buttons|=8:4===n?l.buttons|=16:5===n&&(l.buttons|=32);var h=e.getActivePointersListsExceptType(i[0].type);for(o=0;o<h.length;o++)F(e,t,h[o]);if(0!==n)return e.nonPrimaryPressHandler&&!1===e.nonPrimaryPressHandler({eventSource:e,pointerType:i[0].type,position:f(i[0].currentPos,e.element),button:n,buttons:l.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t),!1;for(o=0;o<c;o++)r=i[o],(s=l.getById(r.id))?(s.captured=!0,s.insideElementPressed=!0,s.insideElement=!0,s.contactPos=r.currentPos,s.contactTime=r.currentTime,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime,r=s):(r.captured=!0,r.insideElementPressed=!0,r.insideElement=!0,re(l,r)),l.addContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&m.MouseTracker.gesturePointVelocityTracker.addPoint(e,r),1===l.contacts?e.pressHandler&&!1===e.pressHandler({eventSource:e,pointerType:r.type,position:f(r.contactPos,e.element),buttons:l.buttons,isTouchEvent:"touch"===r.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t):2===l.contacts&&e.pinchHandler&&"touch"===r.type&&(a.pinchGPoints=l.asArray(),a.lastPinchDist=a.currentPinchDist=a.pinchGPoints[0].currentPos.distanceTo(a.pinchGPoints[1].currentPos),a.lastPinchCenter=a.currentPinchCenter=v(a.pinchGPoints[0].currentPos,a.pinchGPoints[1].currentPos));return!0}function he(e,t,i,n){var o,r,s,a,l,c,h=Se[e.hash],u=e.getActivePointersListByType(i[0].type),d=i.length,p=!1,g=!1;if("undefined"!=typeof t.buttons?u.buttons=t.buttons:m.Browser.vendor===m.BROWSERS.IE&&m.Browser.version<9?0===n?u.buttons-=1:1===n?u.buttons-=4:2===n?u.buttons-=2:3===n?u.buttons-=8:4===n?u.buttons-=16:5===n&&(u.buttons-=32):0===n?u.buttons^=-2:1===n?u.buttons^=-5:2===n?u.buttons^=-3:3===n?u.buttons^=-9:4===n?u.buttons^=-17:5===n&&(u.buttons^=-33),0!==n)return e.nonPrimaryReleaseHandler&&!1===e.nonPrimaryReleaseHandler({eventSource:e,pointerType:i[0].type,position:f(i[0].currentPos,e.element),button:n,buttons:u.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t),F(e,t,e.getActivePointersListByType("mouse")),!1;for(s=0;s<d;s++)a=i[s],(l=u.getById(a.id))&&(l.captured&&(l.captured=!1,g=p=!0),l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=a.currentPos,l.currentTime=a.currentTime,l.insideElement||se(u,l),o=l.currentPos,r=l.currentTime,g?(u.removeContact(),(e.dragHandler||e.dragEndHandler||e.pinchHandler)&&m.MouseTracker.gesturePointVelocityTracker.removePoint(e,l),0===u.contacts?(e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:l.type,position:f(o,e.element),buttons:u.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t),e.dragEndHandler&&!l.currentPos.equals(l.contactPos)&&!1===e.dragEndHandler({eventSource:e,pointerType:l.type,position:f(l.currentPos,e.element),speed:l.speed,direction:l.direction,shift:t.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t),(e.clickHandler||e.dblClickHandler)&&l.insideElement&&(c=r-l.contactTime<=e.clickTimeThreshold&&l.contactPos.distanceTo(o)<=e.clickDistThreshold,e.clickHandler&&!1===e.clickHandler({eventSource:e,pointerType:l.type,position:f(l.currentPos,e.element),quick:c,shift:t.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t),e.dblClickHandler&&c&&(u.clicks++,1===u.clicks?(h.lastClickPos=o,h.dblClickTimeOut=setTimeout(function(){u.clicks=0},e.dblClickTimeThreshold)):2===u.clicks&&(clearTimeout(h.dblClickTimeOut),u.clicks=0,h.lastClickPos.distanceTo(o)<=e.dblClickDistThreshold&&!1===e.dblClickHandler({eventSource:e,pointerType:l.type,position:f(l.currentPos,e.element),shift:t.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t),h.lastClickPos=null)))):2===u.contacts&&e.pinchHandler&&"touch"===l.type&&(h.pinchGPoints=u.asArray(),h.lastPinchDist=h.currentPinchDist=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos),h.lastPinchCenter=h.currentPinchCenter=v(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos))):e.releaseHandler&&!1===e.releaseHandler({eventSource:e,pointerType:l.type,position:f(o,e.element),buttons:u.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t));return p}function ue(e,t,i){var n,o,r,s,a,l=Se[e.hash],c=e.getActivePointersListByType(i[0].type),h=i.length;for("undefined"!=typeof t.buttons&&(c.buttons=t.buttons),n=0;n<h;n++)o=i[n],(r=c.getById(o.id))?(o.hasOwnProperty("isPrimary")&&(r.isPrimary=o.isPrimary),r.lastPos=r.currentPos,r.lastTime=r.currentTime,r.currentPos=o.currentPos,r.currentTime=o.currentTime):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,re(c,o));e.stopHandler&&"mouse"===i[0].type&&(clearTimeout(e.stopTimeOut),e.stopTimeOut=setTimeout(function(){pe(e,t,i[0].type)},e.stopDelay)),0===c.contacts?e.moveHandler&&!1===e.moveHandler({eventSource:e,pointerType:i[0].type,position:f(i[0].currentPos,e.element),buttons:c.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t):1===c.contacts?(e.moveHandler&&(r=c.asArray()[0],!1===e.moveHandler({eventSource:e,pointerType:r.type,position:f(r.currentPos,e.element),buttons:c.buttons,isTouchEvent:"touch"===r.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t)),e.dragHandler&&(a=(r=c.asArray()[0]).currentPos.minus(r.lastPos),!1===e.dragHandler({eventSource:e,pointerType:r.type,position:f(r.currentPos,e.element),buttons:c.buttons,delta:a,speed:r.speed,direction:r.direction,shift:t.shiftKey,isTouchEvent:"touch"===r.type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t))):2===c.contacts&&(e.moveHandler&&(s=c.asArray(),!1===e.moveHandler({eventSource:e,pointerType:s[0].type,position:f(v(s[0].currentPos,s[1].currentPos),e.element),buttons:c.buttons,isTouchEvent:"touch"===s[0].type,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t)),e.pinchHandler&&"touch"===i[0].type&&(a=l.pinchGPoints[0].currentPos.distanceTo(l.pinchGPoints[1].currentPos))!=l.currentPinchDist&&(l.lastPinchDist=l.currentPinchDist,l.currentPinchDist=a,l.lastPinchCenter=l.currentPinchCenter,l.currentPinchCenter=v(l.pinchGPoints[0].currentPos,l.pinchGPoints[1].currentPos),!1===e.pinchHandler({eventSource:e,pointerType:"touch",gesturePoints:l.pinchGPoints,lastCenter:f(l.lastPinchCenter,e.element),center:f(l.currentPinchCenter,e.element),lastDistance:l.lastPinchDist,distance:l.currentPinchDist,shift:t.shiftKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData})&&m.cancelEvent(t)))}function de(e,t,i){he(e,t,i,0),le(e,t,i)}function pe(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:s(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}function ge(e){try{return e.addEventListener&&e.removeEventListener}catch(t){return!1}}var me,fe,ve,ye,we,e,Te=[],Se={};m.MouseTracker=function(e){Te.push(this);var t=arguments;m.isPlainObject(e)||(e={element:t[0],clickTimeThreshold:t[1],clickDistThreshold:t[2]}),this.hash=Math.random(),this.element=m.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||m.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||m.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||m.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||m.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.enterHandler=e.enterHandler||null,this.exitHandler=e.exitHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null;var i=this;Se[this.hash]={click:function(e){a(i,e)},dblclick:function(e){u(i,e)},keydown:function(e){d(i,e)},keyup:function(e){p(i,e)},keypress:function(e){g(i,e)},focus:function(e){y(i,e)},blur:function(e){w(i,e)},wheel:function(e){T(i,e)},mousewheel:function(e){S(i,e)},DOMMouseScroll:function(e){S(i,e)},MozMousePixelScroll:function(e){S(i,e)},mouseenter:function(e){E(i,e)},mouseleave:function(e){C(i,e)},mouseover:function(e){P(i,e)},mouseout:function(e){_(i,e)},mousedown:function(e){O(i,e)},mouseup:function(e){L(i,e)},mouseupcaptured:function(e){D(i,e)},mousemove:function(e){M(i,e)},mousemovecaptured:function(e){H(i,e)},touchstart:function(e){z(i,e)},touchend:function(e){N(i,e)},touchendcaptured:function(e){W(i,e)},touchmove:function(e){q(i,e)},touchmovecaptured:function(e){V(i,e)},touchcancel:function(e){G(i,e)},gesturestart:function(e){$(i,e)},gesturechange:function(e){Z(i,e)},pointerover:function(e){X(i,e)},MSPointerOver:function(e){X(i,e)},pointerout:function(e){K(i,e)},MSPointerOut:function(e){K(i,e)},pointerdown:function(e){Y(i,e)},MSPointerDown:function(e){Y(i,e)},pointerup:function(e){Q(i,e)},MSPointerUp:function(e){Q(i,e)},pointermove:function(e){te(i,e)},MSPointerMove:function(e){te(i,e)},pointercancel:function(e){oe(i,e)},MSPointerCancel:function(e){oe(i,e)},pointerupcaptured:function(e){J(i,e)},pointermovecaptured:function(e){ie(i,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},e.startDisabled||this.setTracking(!0)},m.MouseTracker.prototype={destroy:function(){var e;for(i(this),this.element=null,e=0;e<Te.length;e++)if(Te[e]===this){Te.splice(e,1);break}Se[this.hash]=null,delete Se[this.hash]},isTracking:function(){return Se[this.hash].tracking},setTracking:function(e){return e?t(this):i(this),this},getActivePointersListsExceptType:function(e){for(var t=Se[this.hash],i=[],n=0;n<t.activePointersLists.length;++n)t.activePointersLists[n].type!==e&&i.push(t.activePointersLists[n]);return i},getActivePointersListByType:function(e){
var t,i,n=Se[this.hash],o=n.activePointersLists.length;for(t=0;t<o;t++)if(n.activePointersLists[t].type===e)return n.activePointersLists[t];return i=new m.MouseTracker.GesturePointList(e),n.activePointersLists.push(i),i},getActivePointerCount:function(){var e,t=Se[this.hash],i=t.activePointersLists.length,n=0;for(e=0;e<i;e++)n+=t.activePointersLists[e].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},m.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<Te.length;e++)Te[e].isTracking()&&(Te[e].setTracking(!1),Te[e].setTracking(!0))},m.MouseTracker.gesturePointVelocityTracker=(me=[],ve=fe=0,ye=function(e,t){return e.hash.toString()+t.type+t.id.toString()},we=function(){var e,t,i,n,o,r,s=me.length,a=m.now();for(n=a-ve,ve=a,e=0;e<s;e++)(i=(t=me[e]).gPoint).direction=Math.atan2(i.currentPos.y-t.lastPos.y,i.currentPos.x-t.lastPos.x),o=t.lastPos.distanceTo(i.currentPos),t.lastPos=i.currentPos,r=1e3*o/(n+1),i.speed=.75*r+.25*i.speed},{addPoint:function(e,t){var i=ye(e,t);me.push({guid:i,gPoint:t,lastPos:t.currentPos}),1===me.length&&(ve=m.now(),fe=window.setInterval(we,50))},removePoint:function(e,t){var i,n=ye(e,t),o=me.length;for(i=0;i<o;i++)if(me[i].guid===n){me.splice(i,1),0==--o&&window.clearInterval(fe);break}}}),m.MouseTracker.captureElement=document,m.MouseTracker.wheelEventName=m.Browser.vendor==m.BROWSERS.IE&&8<m.Browser.version||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll",m.MouseTracker.supportsMouseCapture=(e=document.createElement("div"),m.isFunction(e.setCapture)&&m.isFunction(e.releaseCapture)),m.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",m.MouseTracker.wheelEventName],"DOMMouseScroll"==m.MouseTracker.wheelEventName&&m.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||m.Browser.vendor!==m.BROWSERS.IE)?(m.MouseTracker.havePointerEvents=!0,m.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),m.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?m.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:m.MouseTracker.maxTouchPoints=0,m.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(m.MouseTracker.havePointerEvents=!0,m.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),m.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?m.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:m.MouseTracker.maxTouchPoints=0,m.MouseTracker.haveMouseEnter=!1):(m.MouseTracker.havePointerEvents=!1,m.Browser.vendor===m.BROWSERS.IE&&m.Browser.version<9?(m.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),m.MouseTracker.haveMouseEnter=!0):(m.MouseTracker.subscribeEvents.push("mouseover","mouseout"),m.MouseTracker.haveMouseEnter=!1),m.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&m.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&m.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),m.MouseTracker.mousePointerId="legacy-mouse",m.MouseTracker.maxTouchPoints=10),m.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},m.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(){var e,t=this._gPoints.length;for(e=0;e<t;e++)if(this._gPoints[e].isPrimary)return this._gPoints[e];return null},addContact:function(){++this.contacts,1<this.contacts&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var be=function(){try{return window.self!==window.top}catch(e){return!0}}()}(OpenSeadragon),function(o){o.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},o.Control=function(e,t,i){var n=e.parentNode;"number"==typeof t&&(o.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),t={anchor:t}),t.attachToViewer="undefined"==typeof t.attachToViewer||t.attachToViewer,this.autoFade="undefined"==typeof t.autoFade||t.autoFade,this.element=e,this.anchor=t.anchor,this.container=i,this.anchor==o.ControlAnchor.ABSOLUTE?(this.wrapper=o.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof t.top?t.top+"px":t.top,this.wrapper.style.left="number"==typeof t.left?t.left+"px":t.left,this.wrapper.style.height="number"==typeof t.height?t.height+"px":t.height,this.wrapper.style.width="number"==typeof t.width?t.width+"px":t.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=o.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==o.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),t.attachToViewer?this.anchor==o.ControlAnchor.TOP_RIGHT||this.anchor==o.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):n.appendChild(this.wrapper)},o.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor==o.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[o.SIGNAL]&&o.Browser.vendor==o.BROWSERS.IE?o.setElementOpacity(this.element,e,!0):o.setElementOpacity(this.wrapper,e,!0)}}}(OpenSeadragon),function(o){function n(e,t){var i,n=e.controls;for(i=n.length-1;0<=i;i--)if(n[i].element==t)return i;return-1}o.ControlDock=function(e){var t,i,n=["topleft","topright","bottomright","bottomleft"];for(o.extend(!0,this,{id:"controldock-"+o.now()+"-"+Math.floor(1e6*Math.random()),container:o.makeNeutralElement("div"),controls:[]},e),this.container.onsubmit=function(){return!1},this.element&&(this.element=o.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<n.length;i++)t=n[i],this.controls[t]=o.makeNeutralElement("div"),this.controls[t].style.position="absolute",t.match("left")&&(this.controls[t].style.left="0px"),t.match("right")&&(this.controls[t].style.right="0px"),t.match("top")&&(this.controls[t].style.top="0px"),t.match("bottom")&&(this.controls[t].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},o.ControlDock.prototype={addControl:function(e,t){var i=null;if(!(0<=n(this,e=o.getElement(e)))){switch(t.anchor){case o.ControlAnchor.TOP_RIGHT:i=this.controls.topright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingTop="0px";break;case o.ControlAnchor.BOTTOM_RIGHT:i=this.controls.bottomright,e.style.position="relative",e.style.paddingRight="0px",e.style.paddingBottom="0px";break;case o.ControlAnchor.BOTTOM_LEFT:i=this.controls.bottomleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingBottom="0px";break;case o.ControlAnchor.TOP_LEFT:i=this.controls.topleft,e.style.position="relative",e.style.paddingLeft="0px",e.style.paddingTop="0px";break;case o.ControlAnchor.ABSOLUTE:i=this.container,e.style.margin="0px",e.style.padding="0px";break;default:case o.ControlAnchor.NONE:i=this.container,e.style.margin="0px",e.style.padding="0px"}this.controls.push(new o.Control(e,t,i)),e.style.display="inline-block"}},removeControl:function(e){var t=n(this,e=o.getElement(e));return 0<=t&&(this.controls[t].destroy(),this.controls.splice(t,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;0<=e;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;0<=t;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(g){function h(e){return e=g.getElement(e),new g.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function e(i,n,o,r,s){function a(e,t){e.ready?r(e):(e.addHandler("ready",function(){r(e)}),e.addHandler("open-failed",function(e){s({message:e.message,source:t})}))}var l=i;if("string"==g.type(n))if(n.match(/^\s*<.*>\s*$/))n=g.parseXml(n);else if(n.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var e=g.parseJSON(n);n=e}catch(t){}setTimeout(function(){if("string"==g.type(n))(n=new g.TileSource({url:n,crossOriginPolicy:o.crossOriginPolicy!==undefined?o.crossOriginPolicy:i.crossOriginPolicy,ajaxWithCredentials:i.ajaxWithCredentials,ajaxHeaders:i.ajaxHeaders,useCanvas:i.useCanvas,success:function(e){r(e.tileSource)}})).addHandler("open-failed",function(e){s(e)});else if(g.isPlainObject(n)||n.nodeType)if(n.crossOriginPolicy!==undefined||o.crossOriginPolicy===undefined&&i.crossOriginPolicy===undefined||(n.crossOriginPolicy=o.crossOriginPolicy!==undefined?o.crossOriginPolicy:i.crossOriginPolicy),n.ajaxWithCredentials===undefined&&(n.ajaxWithCredentials=i.ajaxWithCredentials),n.useCanvas===undefined&&(n.useCanvas=i.useCanvas),g.isFunction(n.getTileUrl)){var e=new g.TileSource(n);e.getTileUrl=n.getTileUrl,r(e)}else{var t=g.TileSource.determineType(l,n);if(!t)return void s({message:"Unable to load TileSource",source:n});a(new t(t.prototype.configure.apply(l,[n])),n)}else a(n,n)})}function u(e,t){if(t instanceof g.Overlay)return t;var i=null;if(t.element)i=g.getElement(t.element);else{var n=t.id?t.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(i=g.getElement(t.id))||((i=document.createElement("a")).href="#/overlay/"+n),i.id=n,g.addClass(i,t.className?t.className:"openseadragon-overlay")}var o=t.location,r=t.width,s=t.height;if(!o){var a=t.x,l=t.y;if(t.px!==undefined){var c=e.viewport.imageToViewportRectangle(new g.Rect(t.px,t.py,r||0,s||0));a=c.x,l=c.y,r=r!==undefined?c.width:undefined,s=s!==undefined?c.height:undefined}o=new g.Point(a,l)}var h=t.placement;return h&&"string"===g.type(h)&&(h=g.Placement[t.placement.toUpperCase()]),new g.Overlay({element:i,location:o,placement:h,onDraw:t.onDraw,checkResize:t.checkResize,width:r,height:s,rotationMode:t.rotationMode})}function s(e,t){var i;for(i=e.length-1;0<=i;i--)if(e[i].element===t)return i;return-1}function a(e,t){return g.requestAnimationFrame(function(){t(e)})}function n(e){g.requestAnimationFrame(function(){t(e)})}function d(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=g.now()+e.controlsFadeDelay,window.setTimeout(function(){n(e)},e.controlsFadeDelay))}function t(e){var t,i;if(e.controlsShouldFade){for(t=1-(g.now()-e.controlsFadeBeginTime)/e.controlsFadeLength,t=Math.min(1,t),t=Math.max(0,t),i=e.controls.length-1;0<=i;i--)e.controls[i].autoFade&&e.controls[i].setOpacity(t);0<t&&n(e)}}function p(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;0<=t;t--)e.controls[t].setOpacity(1)}function m(){p(this)}function f(){d(this)}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,-40))),this.viewport.applyConstraints(),!1;case 40:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,40))),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(-40,0))),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function c(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,-40))),this.viewport.applyConstraints(),!1;case 115:case 83:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(0,40))),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(-40,0))),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new g.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function v(e){document.activeElement==this.canvas||this.canvas.focus();var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",t),!t.preventDefaultAction&&this.viewport&&e.quick&&this.gestureSettingsByDeviceType(e.pointerType).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())}function y(e){!e.preventDefaultAction&&this.viewport&&this.gestureSettingsByDeviceType(e.pointerType).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-double-click",{tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent})}function w(e){var t,i={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!i.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var o=this.viewport.getBounds(),r=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,o.x!=r.x&&(e.delta.x=0),o.y!=r.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function T(e){if(!e.preventDefaultAction&&this.viewport){var t=this.gestureSettingsByDeviceType(e.pointerType);if(t.flickEnabled&&e.speed>=t.flickMinSpeed){var i=0;this.panHorizontal&&(i=t.flickMomentum*e.speed*Math.cos(e.direction));var n=0;this.panVertical&&(n=t.flickMomentum*e.speed*Math.sin(e.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),r=this.viewport.pointFromPixel(new g.Point(o.x-i,o.y-n));this.viewport.panTo(r,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:e.eventSource,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function S(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function b(e){window.location!=window.parent.location&&g.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function x(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function E(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function P(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function R(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function C(e){var t,i,n;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(i=this.viewport.pointFromPixel(e.center,!0),n=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),this.viewport.panBy(n,!0),this.viewport.applyConstraints()),t.pinchRotate)){var o=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),r=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(o-r)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function _(e){var t,i,n;if((n=g.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=n,!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).scrollToZoom&&(i=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(i,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),t&&t.scrollToZoom)return!1}else if((t=this.gestureSettingsByDeviceType(e.pointerType))&&t.scrollToZoom)return!1}function k(e){G[this.hash].mouseInside=!0,p(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function I(e){e.pointers<1&&(G[this.hash].mouseInside=!1,G[this.hash].animating||d(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function O(e){i(e),e.isOpen()?e._updateRequestId=a(e,O):e._updateRequestId=!1}function i(e){if(!e._opening){if(e.autoResize){var t=h(e.container),i=G[e.hash].prevContainerSize;if(!t.equals(i)){var n=e.viewport;if(e.preserveImageSizeOnResize){var o=i.x/t.x,r=n.getZoom()*o,s=n.getCenter();n.resize(t,!1),n.zoomTo(r,null,!0),n.panTo(s,!0)}else{var a=n.getBounds();n.resize(t,!0),n.fitBoundsWithConstraints(a,!0)}G[e.hash].prevContainerSize=t,G[e.hash].forceRedraw=!0}}var l=e.viewport.update(),c=e.world.update()||l;l&&e.raiseEvent("viewport-change"),e.referenceStrip&&(c=e.referenceStrip.update(e.viewport)||c),!G[e.hash].animating&&c&&(e.raiseEvent("animation-start"),p(e)),(c||G[e.hash].forceRedraw||e.world.needsDraw())&&(L(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),G[e.hash].forceRedraw=!1,c&&e.raiseEvent("animation")),G[e.hash].animating&&!c&&(e.raiseEvent("animation-finish"),G[e.hash].mouseInside||d(e)),G[e.hash].animating=c}}function L(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}function D(e,t){return e?e+t:t}function B(){G[this.hash].lastZoomTime=g.now(),G[this.hash].zoomFactor=this.zoomPerSecond,G[this.hash].zooming=!0,o(this)}function M(){G[this.hash].lastZoomTime=g.now(),G[this.hash].zoomFactor=1/this.zoomPerSecond,G[this.hash].zooming=!0,o(this)}function H(){G[this.hash].zooming=!1}function o(e){g.requestAnimationFrame(g.delegate(e,r))}function r(){var e,t,i;G[this.hash].zooming&&this.viewport&&(t=(e=g.now())-G[this.hash].lastZoomTime,i=Math.pow(G[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(i),this.viewport.applyConstraints(),G[this.hash].lastZoomTime=e,o(this))}function A(){this.viewport&&(G[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function F(){this.viewport&&(G[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function z(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function N(){this.viewport&&this.viewport.goHome()}function W(){this.isFullPage()&&!g.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function j(){if(this.viewport){var e=this.viewport.getRotation();0===e?e=270:e-=90,this.viewport.setRotation(e)}}function q(){if(this.viewport){var e=this.viewport.getRotation();270===e?e=0:e+=90,this.viewport.setRotation(e)}}function V(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function U(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}var G={},$=1;g.Viewer=function(e){var t,i,n,o=arguments,r=this;if(g.isPlainObject(e)||(e={id:o[0],xmlPath:1<o.length?o[1]:undefined,prefixUrl:2<o.length?o[2]:undefined,controls:3<o.length?o[3]:undefined,overlays:4<o.length?o[4]:undefined}),e.config&&(g.extend(!0,e,e.config),delete e.config),g.extend(!0,this,{id:e.id,hash:e.hash||$++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},g.DEFAULT_SETTINGS,e),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for("undefined"!=typeof G[this.hash]&&g.console.warn("Hash "+this.hash+" has already been used."),G[this.hash]={fsBoundsDelta:new g.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=g.now(),g.EventSource.call(this),this.addHandler("open-failed",function(e){var t=g.getString("Errors.OpenFailed",e.eventSource,e.message);r._showMessage(t)}),g.ControlDock.call(this,e),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=g.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(i=this.canvas.style).width="100%",i.height="100%",i.overflow="hidden",i.position="absolute",i.top="0px",i.left="0px",g.setElementTouchActionNone(this.canvas),""!==e.tabIndex&&(this.canvas.tabIndex=e.tabIndex===undefined?0:e.tabIndex),this.container.className="openseadragon-container",(n=this.container.style).width="100%",n.height="100%",n.position="relative",n.overflow="hidden",n.left="0px",n.top="0px",n.textAlign="left",this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new g.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:g.delegate(this,l),keyHandler:g.delegate(this,c),clickHandler:g.delegate(this,v),dblClickHandler:g.delegate(this,y),dragHandler:g.delegate(this,w),dragEndHandler:g.delegate(this,T),enterHandler:g.delegate(this,S),exitHandler:g.delegate(this,b),pressHandler:g.delegate(this,x),releaseHandler:g.delegate(this,E),nonPrimaryPressHandler:g.delegate(this,P),nonPrimaryReleaseHandler:g.delegate(this,R),scrollHandler:g.delegate(this,_),pinchHandler:g.delegate(this,C)}),this.outerTracker=new g.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:g.delegate(this,k),exitHandler:g.delegate(this,I)}),this.toolbar&&(this.toolbar=new g.ControlDock({element:this.toolbar})),this.bindStandardControls(),G[this.hash].prevContainerSize=h(this.container),this.world=new g.World({viewer:this}),this.world.addHandler("add-item",function(){r.source=r.world.getItemAt(0).source,G[r.hash].forceRedraw=!0,r._updateRequestId||(r._updateRequestId=a(r,O))}),this.world.addHandler("remove-item",function(){r.world.getItemCount()?r.source=r.world.getItemAt(0).source:r.source=null,G[r.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(){r.viewport&&r.viewport._setContentBounds(r.world.getHomeBounds(),r.world.getContentFactor())}),this.world.addHandler("item-index-change",function(){r.source=r.world.getItemAt(0).source}),this.viewport=new g.Viewport({containerSize:G[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new g.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:e.timeout}),this.tileCache=new g.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new g.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=g.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(t=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(t,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(t=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(t,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new g.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),t=0;t<this.customControls.length;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});g.requestAnimationFrame(function(){d(r)})},g.extend(g.Viewer.prototype,g.EventSource.prototype,g.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return g.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return g.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},open:function(i,e){var o=this;if(this.close(),i){if(this.sequenceMode&&g.isArray(i))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===e||isNaN(e)||(this.initialPage=e),this.tileSources=i,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(g.isArray(i)||(i=[i]),i.length){this._opening=!0;for(var r,n=i.length,s=0,a=0,l=function(){if(s+a===n)if(s){!o._firstOpen&&o.preserveViewport||(o.viewport.goHome(!0),o.viewport.update()),o._firstOpen=!1;var e=i[0];if(e.tileSource&&(e=e.tileSource),o.overlays&&!o.preserveOverlays)for(var t=0;t<o.overlays.length;t++)o.currentOverlays[t]=u(o,o.overlays[t]);o._drawOverlays(),o._opening=!1,o.raiseEvent("open",{source:e})}else o._opening=!1,o.raiseEvent("open-failed",r)},t=function(i){g.isPlainObject(i)&&i.tileSource||(i={tileSource:i}),i.index!==undefined&&(g.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete i.index),i.collectionImmediately===undefined&&(i.collectionImmediately=!0);var n=i.success;i.success=function(e){if(s++,i.tileSource.overlays)for(var t=0;t<i.tileSource.overlays.length;t++)o.addOverlay(i.tileSource.overlays[t]);n&&n(e),l()};var t=i.error;i.error=function(e){a++,r||(r=e),t&&t(e),l()},o.addTiledImage(i)},c=0;c<i.length;c++)t(i[c]);return this}}},close:function(){return G[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),G[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(G[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),
null!==this._updateRequestId&&(g.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),G[this.hash]=null,delete G[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?p(this):d(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return G[this.hash].fullPage},setFullPage:function(e){var t,i,n=document.body,o=n.style,r=document.documentElement.style,s=this;if(e==this.isFullPage())return this;var a={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",a),a.preventDefaultAction)return this;if(e){for(this.elementSize=g.getElementSize(this.element),this.pageScroll=g.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=r.margin,o.margin="0",r.margin="0",this.bodyPadding=o.padding,this.docPadding=r.padding,o.padding="0",r.padding="0",this.bodyWidth=o.width,this.docWidth=r.width,o.width="100%",r.width="100%",this.bodyHeight=o.height,this.docHeight=r.height,o.height="100%",r.height="100%",this.previousBody=[],G[this.hash].prevElementParent=this.element.parentNode,G[this.hash].prevNextSibling=this.element.nextSibling,G[this.hash].prevElementWidth=this.element.style.width,G[this.hash].prevElementHeight=this.element.style.height,t=n.childNodes.length,i=0;i<t;i++)this.previousBody.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,n.appendChild(this.toolbar.element),g.addClass(this.toolbar.element,"fullpage")),g.addClass(this.element,"fullpage"),n.appendChild(this.element),this.element.style.height=g.getWindowSize().y+"px",this.element.style.width=g.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=g.getElementSize(this.element).y-g.getElementSize(this.toolbar.element).y+"px"),G[this.hash].fullPage=!0,g.delegate(this,k)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,r.margin=this.docMargin,o.padding=this.bodyPadding,r.padding=this.docPadding,o.width=this.bodyWidth,r.width=this.docWidth,o.height=this.bodyHeight,r.height=this.docHeight,n.removeChild(this.element),t=this.previousBody.length,i=0;i<t;i++)n.appendChild(this.previousBody.shift());g.removeClass(this.element,"fullpage"),G[this.hash].prevElementParent.insertBefore(this.element,G[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(n.removeChild(this.toolbar.element),g.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=G[this.hash].prevElementWidth,this.element.style.height=G[this.hash].prevElementHeight;var l=0,c=function(){g.setPageScroll(s.pageScroll);var e=g.getPageScroll();++l<10&&(e.x!==s.pageScroll.x||e.y!==s.pageScroll.y)&&g.requestAnimationFrame(c)};g.requestAnimationFrame(c),G[this.hash].fullPage=!1,g.delegate(this,I)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(e){var t=this;if(!g.supportsFullScreen)return this.setFullPage(e);if(g.isFullScreen()===e)return this;var i={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),i.preventDefaultAction)return this;if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var e=g.isFullScreen();e||(g.removeEvent(document,g.fullScreenEventName,n),g.removeEvent(document,g.fullScreenErrorEventName,n),t.setFullPage(!1),t.isFullPage()&&(t.element.style.width=t.fullPageStyleWidth,t.element.style.height=t.fullPageStyleHeight)),t.navigator&&t.viewport&&t.navigator.update(t.viewport),t.raiseEvent("full-screen",{fullScreen:e})};g.addEvent(document,g.fullScreenEventName,n),g.addEvent(document,g.fullScreenErrorEventName,n),g.requestFullScreen(document.body)}else g.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(i){function t(e){for(var t=0;t<r._loadQueue.length;t++)if(r._loadQueue[t]===s){r._loadQueue.splice(t,1);break}0===r._loadQueue.length&&o(s),r.raiseEvent("add-item-failed",e),i.error&&i.error(e)}function o(e){r.collectionMode&&(r.world.arrange({immediately:e.options.collectionImmediately,rows:r.collectionRows,columns:r.collectionColumns,layout:r.collectionLayout,tileSize:r.collectionTileSize,tileMargin:r.collectionTileMargin}),r.world.setAutoRefigureSizes(!0))}function n(){for(var e,t,i;r._loadQueue.length&&(e=r._loadQueue[0]).tileSource;){if(r._loadQueue.splice(0,1),e.options.replace){var n=r.world.getIndexOfItem(e.options.replaceItem);-1!=n&&(e.options.index=n),r.world.removeItem(e.options.replaceItem)}t=new g.TiledImage({viewer:r,source:e.tileSource,viewport:r.viewport,drawer:r.drawer,tileCache:r.tileCache,imageLoader:r.imageLoader,x:e.options.x,y:e.options.y,width:e.options.width,height:e.options.height,fitBounds:e.options.fitBounds,fitBoundsPlacement:e.options.fitBoundsPlacement,clip:e.options.clip,placeholderFillStyle:e.options.placeholderFillStyle,opacity:e.options.opacity,preload:e.options.preload,degrees:e.options.degrees,compositeOperation:e.options.compositeOperation,springStiffness:r.springStiffness,animationTime:r.animationTime,minZoomImageRatio:r.minZoomImageRatio,wrapHorizontal:r.wrapHorizontal,wrapVertical:r.wrapVertical,immediateRender:r.immediateRender,blendTime:r.blendTime,alwaysBlend:r.alwaysBlend,minPixelRatio:r.minPixelRatio,smoothTileEdgesMinZoom:r.smoothTileEdgesMinZoom,iOSDevice:r.iOSDevice,crossOriginPolicy:e.options.crossOriginPolicy,ajaxWithCredentials:e.options.ajaxWithCredentials,loadTilesWithAjax:e.options.loadTilesWithAjax,ajaxHeaders:e.options.ajaxHeaders,debugMode:r.debugMode}),r.collectionMode&&r.world.setAutoRefigureSizes(!1),r.world.addItem(t,{index:e.options.index}),0===r._loadQueue.length&&o(e),1!==r.world.getItemCount()||r.preserveViewport||r.viewport.goHome(!0),r.navigator&&(i=g.extend({},e.options,{replace:!1,originalTiledImage:t,tileSource:e.tileSource}),r.navigator.addTiledImage(i)),e.options.success&&e.options.success({item:t})}}g.console.assert(i,"[Viewer.addTiledImage] options is required"),g.console.assert(i.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),g.console.assert(!i.replace||-1<i.index&&i.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var r=this;i.replace&&(i.replaceItem=r.world.getItemAt(i.index)),this._hideMessage(),i.placeholderFillStyle===undefined&&(i.placeholderFillStyle=this.placeholderFillStyle),i.opacity===undefined&&(i.opacity=this.opacity),i.preload===undefined&&(i.preload=this.preload),i.compositeOperation===undefined&&(i.compositeOperation=this.compositeOperation),i.crossOriginPolicy===undefined&&(i.crossOriginPolicy=i.tileSource.crossOriginPolicy!==undefined?i.tileSource.crossOriginPolicy:this.crossOriginPolicy),i.ajaxWithCredentials===undefined&&(i.ajaxWithCredentials=this.ajaxWithCredentials),i.loadTilesWithAjax===undefined&&(i.loadTilesWithAjax=this.loadTilesWithAjax),i.ajaxHeaders===undefined||null===i.ajaxHeaders?i.ajaxHeaders=this.ajaxHeaders:g.isPlainObject(i.ajaxHeaders)&&g.isPlainObject(this.ajaxHeaders)&&(i.ajaxHeaders=g.extend({},this.ajaxHeaders,i.ajaxHeaders));var s={options:i};g.isArray(i.tileSource)?setTimeout(function(){t({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:i.tileSource,options:i})}):(this._loadQueue.push(s),e(this,i.tileSource,i,function(e){s.tileSource=e,n()},function(e){e.options=i,t(e),n()}))},addSimpleImage:function(e){g.console.assert(e,"[Viewer.addSimpleImage] options is required"),g.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required");var t=g.extend({},e,{tileSource:{type:"image",url:e.url}});delete t.url,this.addTiledImage(t)},addLayer:function(t){var i=this;g.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var e=g.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(e),this},getLayerAtLevel:function(e){return g.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return g.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return g.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,t){return g.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,t)},removeLayer:function(e){return g.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return G[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=g.delegate(this,m),t=g.delegate(this,f),i=g.delegate(this,U),n=g.delegate(this,V),o=this.navImages,r=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new g.Button({element:this.previousButton?g.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.PreviousPage"),srcRest:D(this.prefixUrl,o.previous.REST),srcGroup:D(this.prefixUrl,o.previous.GROUP),srcHover:D(this.prefixUrl,o.previous.HOVER),srcDown:D(this.prefixUrl,o.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new g.Button({element:this.nextButton?g.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.NextPage"),srcRest:D(this.prefixUrl,o.next.REST),srcGroup:D(this.prefixUrl,o.next.GROUP),srcHover:D(this.prefixUrl,o.next.HOVER),srcDown:D(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),r&&(this.paging=new g.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:g.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||g.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=g.delegate(this,B),t=g.delegate(this,H),i=g.delegate(this,A),n=g.delegate(this,M),o=g.delegate(this,F),r=g.delegate(this,N),s=g.delegate(this,W),a=g.delegate(this,j),l=g.delegate(this,q),c=g.delegate(this,m),h=g.delegate(this,f),u=this.navImages,d=[],p=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(p=!1),this.showZoomControl&&(d.push(this.zoomInButton=new g.Button({element:this.zoomInButton?g.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.ZoomIn"),srcRest:D(this.prefixUrl,u.zoomIn.REST),srcGroup:D(this.prefixUrl,u.zoomIn.GROUP),srcHover:D(this.prefixUrl,u.zoomIn.HOVER),srcDown:D(this.prefixUrl,u.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:c,onBlur:h})),d.push(this.zoomOutButton=new g.Button({element:this.zoomOutButton?g.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.ZoomOut"),srcRest:D(this.prefixUrl,u.zoomOut.REST),srcGroup:D(this.prefixUrl,u.zoomOut.GROUP),srcHover:D(this.prefixUrl,u.zoomOut.HOVER),srcDown:D(this.prefixUrl,u.zoomOut.DOWN),onPress:n,onRelease:t,onClick:o,onEnter:n,onExit:t,onFocus:c,onBlur:h}))),this.showHomeControl&&d.push(this.homeButton=new g.Button({element:this.homeButton?g.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.Home"),srcRest:D(this.prefixUrl,u.home.REST),srcGroup:D(this.prefixUrl,u.home.GROUP),srcHover:D(this.prefixUrl,u.home.HOVER),srcDown:D(this.prefixUrl,u.home.DOWN),onRelease:r,onFocus:c,onBlur:h})),this.showFullPageControl&&d.push(this.fullPageButton=new g.Button({element:this.fullPageButton?g.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.FullPage"),srcRest:D(this.prefixUrl,u.fullpage.REST),srcGroup:D(this.prefixUrl,u.fullpage.GROUP),srcHover:D(this.prefixUrl,u.fullpage.HOVER),srcDown:D(this.prefixUrl,u.fullpage.DOWN),onRelease:s,onFocus:c,onBlur:h})),this.showRotationControl&&(d.push(this.rotateLeftButton=new g.Button({element:this.rotateLeftButton?g.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.RotateLeft"),srcRest:D(this.prefixUrl,u.rotateleft.REST),srcGroup:D(this.prefixUrl,u.rotateleft.GROUP),srcHover:D(this.prefixUrl,u.rotateleft.HOVER),srcDown:D(this.prefixUrl,u.rotateleft.DOWN),onRelease:a,onFocus:c,onBlur:h})),d.push(this.rotateRightButton=new g.Button({element:this.rotateRightButton?g.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:g.getString("Tooltips.RotateRight"),srcRest:D(this.prefixUrl,u.rotateright.REST),srcGroup:D(this.prefixUrl,u.rotateright.GROUP),srcHover:D(this.prefixUrl,u.rotateright.HOVER),srcDown:D(this.prefixUrl,u.rotateright.DOWN),onRelease:l,onFocus:c,onBlur:h}))),p&&(this.buttons=new g.ButtonGroup({buttons:d,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",g.delegate(this,z)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||g.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||g.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&0<=e&&e<this.tileSources.length&&(this.raiseEvent("page",{page:e}),this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e)),this},addOverlay:function(e,t,i,n){var o;if(o=g.isPlainObject(e)?e:{element:e,location:t,placement:i,onDraw:n},e=g.getElement(o.element),0<=s(this.currentOverlays,e))return this;var r=u(this,o);return this.currentOverlays.push(r),r.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:o.location,placement:o.placement}),this},updateOverlay:function(e,t,i){var n;return e=g.getElement(e),0<=(n=s(this.currentOverlays,e))&&(this.currentOverlays[n].update(t,i),G[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:t,placement:i})),this},removeOverlay:function(e){var t;return e=g.getElement(e),0<=(t=s(this.currentOverlays,e))&&(this.currentOverlays[t].destroy(),this.currentOverlays.splice(t,1),G[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return G[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){var t;return e=g.getElement(e),0<=(t=s(this.currentOverlays,e))?this.currentOverlays[t]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<e?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=g.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=g.makeCenteredNode(t),g.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new g.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else g.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(h){function u(e){e.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(e.position)),this.viewer.viewport.applyConstraints())}function d(e){this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function p(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function g(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function m(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}h.Navigator=function(e){function t(e){m(c.displayRegionContainer,e),m(c.displayRegion,-e),c.viewport.setRotation(e)}var i,n,o,r,s,a,l=e.viewer,c=this;(e.id?(this.element=document.getElementById(e.id),e.controlOptions={anchor:h.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(e.id="navigator-"+h.now(),this.element=h.makeNeutralElement("div"),e.controlOptions={anchor:h.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:e.autoFade},e.position&&("BOTTOM_RIGHT"==e.position?e.controlOptions.anchor=h.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==e.position?e.controlOptions.anchor=h.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==e.position?e.controlOptions.anchor=h.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==e.position?e.controlOptions.anchor=h.ControlAnchor.TOP_LEFT:"ABSOLUTE"==e.position&&(e.controlOptions.anchor=h.ControlAnchor.ABSOLUTE,e.controlOptions.top=e.top,e.controlOptions.left=e.left,e.controlOptions.height=e.height,e.controlOptions.width=e.width))),this.element.id=e.id,this.element.className+=" navigator",(e=h.extend(!0,{sizeRatio:h.DEFAULT_SETTINGS.navigatorSizeRatio},e,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:e.autoResize,minZoomImageRatio:1})).minPixelRatio=this.minPixelRatio=l.minPixelRatio,h.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new h.Point(1,1),this.totalBorderWidths=new h.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),e.controlOptions.anchor!=h.ControlAnchor.NONE&&(o=this.element.style,r=this.borderWidth,o.margin="0px",o.border=r+"px solid #555",o.padding="0px",o.background="#000",o.opacity=.8,o.overflow="hidden"),this.displayRegion=h.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",s=this.displayRegion.style,a=this.borderWidth,s.position="relative",s.top="0px",s.left="0px",s.fontSize="0px",s.overflow="hidden",s.border=a+"px solid #900",s.margin="0px",s.padding="0px",s.background="transparent",s["float"]="left",s.cssFloat="left",s.styleFloat="left",s.zIndex=999999999,s.cursor="default",this.displayRegionContainer=h.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",l.addControl(this.element,e.controlOptions),this._resizeWithViewer=e.controlOptions.anchor!=h.ControlAnchor.ABSOLUTE&&e.controlOptions.anchor!=h.ControlAnchor.NONE,this._resizeWithViewer&&(e.width&&e.height?(this.element.style.height="number"==typeof e.height?e.height+"px":e.height,this.element.style.width="number"==typeof e.width?e.width+"px":e.width):(i=h.getElementSize(l.element),this.element.style.height=Math.round(i.y*e.sizeRatio)+"px",this.element.style.width=Math.round(i.x*e.sizeRatio)+"px",this.oldViewerSize=i),n=h.getElementSize(this.element),this.elementArea=n.x*n.y),this.oldContainerSize=new h.Point(0,0),h.Viewer.apply(this,[e]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),e.navigatorRotate)&&(t(e.viewer.viewport?e.viewer.viewport.getRotation():e.viewer.degrees||0),e.viewer.addHandler("rotate",function(e){t(e.degrees)}));this.innerTracker.destroy(),this.innerTracker=new h.MouseTracker({element:this.element,dragHandler:h.delegate(this,d),clickHandler:h.delegate(this,u),releaseHandler:h.delegate(this,p),scrollHandler:h.delegate(this,g)}),this.addHandler("reset-size",function(){c.viewport&&c.viewport.goHome(!0)}),l.world.addHandler("item-index-change",function(t){window.setTimeout(function(){var e=c.world.getItemAt(t.previousIndex);c.world.setItemIndex(e,t.newIndex)},1)}),l.world.addHandler("remove-item",function(e){var t=e.item,i=c._getMatchingItem(t);i&&c.world.removeItem(i)}),this.update(l.viewport)},h.extend(h.Navigator.prototype,h.EventSource.prototype,h.Viewer.prototype,{updateSize:function(){if(this.viewport){var e=new h.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);e.equals(this.oldContainerSize)||(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw())}},update:function(e){var t,i,n,o,r,s;if(t=h.getElementSize(this.viewer.element),this._resizeWithViewer&&t.x&&t.y&&!t.equals(this.oldViewerSize)&&(this.oldViewerSize=t,this.maintainSizeRatio||!this.elementArea?(i=t.x*this.sizeRatio,n=t.y*this.sizeRatio):(i=Math.sqrt(this.elementArea*(t.x/t.y)),n=this.elementArea/i),this.element.style.width=Math.round(i)+"px",this.element.style.height=Math.round(n)+"px",this.elementArea||(this.elementArea=i*n),this.updateSize()),e&&this.viewport){o=e.getBoundsNoRotate(!0),r=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!1),s=this.viewport.pixelFromPointNoRotate(o.getBottomRight(),!1).minus(this.totalBorderWidths);var a=this.displayRegion.style;a.display=this.world.getItemCount()?"block":"none",a.top=Math.round(r.y)+"px",a.left=Math.round(r.x)+"px";var l=Math.abs(r.x-s.x),c=Math.abs(r.y-s.y);a.width=Math.round(Math.max(l,0))+"px",a.height=Math.round(Math.max(c,0))+"px"}},addTiledImage:function(e){var r=this,s=e.originalTiledImage;delete e.original;var t=h.extend({},e,{success:function(e){function t(){r._matchBounds(o,s)}function i(){r._matchOpacity(o,s)}function n(){r._matchCompositeOperation(o,s)}var o=e.item;o._originalForNavigator=s,r._matchBounds(o,s,!0),s.addHandler("bounds-change",t),s.addHandler("clip-change",t),s.addHandler("opacity-change",i),s.addHandler("composite-operation-change",n)}});return h.Viewer.prototype.addTiledImage.apply(this,[t])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(s){var a={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};s.extend(s,{getString:function(e){var t,i=e.split("."),n=null,o=arguments,r=a;for(t=0;t<i.length-1;t++)r=r[i[t]]||{};return"string"!=typeof(n=r[i[t]])&&(s.console.log("Untranslated source string:",e),n=""),n.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<o.length?o[t]:""})},setString:function(e,t){var i,n=e.split("."),o=a;for(i=0;i<n.length-1;i++)o[n[i]]||(o[n[i]]={}),o=o[n[i]];o[n[i]]=t}})}(OpenSeadragon),function(a){a.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},plus:function(e){return new a.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new a.Point(this.x-e.x,this.y-e.y)},times:function(e){return new a.Point(this.x*e,this.y*e)},divide:function(e){return new a.Point(this.x/e,this.y/e)},negate:function(){return new a.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(e){return new a.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof a.Point&&this.x===e.x&&this.y===e.y},rotate:function(e,t){var i,n;if(t=t||new a.Point(0,0),e%90==0){switch(a.positiveModulo(e,360)){case 0:i=1,n=0;break;case 90:i=0,n=1;break;case 180:i=-1,n=0;break;case 270:i=0,n=-1}}else{var o=e*Math.PI/180;i=Math.cos(o),n=Math.sin(o)}var r=i*(this.x-t.x)-n*(this.y-t.y)+t.x,s=n*(this.x-t.x)+i*(this.y-t.y)+t.y;return new a.Point(r,s)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(u){function c(e){var t,i,n=e.responseText,o=e.status;if(!e)throw new Error(u.getString("Errors.Security"));if(200!==e.status&&0!==e.status)throw t=404==(o=e.status)?"Not Found":e.statusText,new Error(u.getString("Errors.Status",o,t));if(n.match(/\s*<.*/))try{i=e.responseXML&&e.responseXML.documentElement?e.responseXML:u.parseXml(n)}catch(r){i=e.responseText}else if(n.match(/\s*[\{\[].*/))try{i=u.parseJSON(n)}catch(r){i=n}else i=n;return i}u.TileSource=function(e){var t,i,n=this,o=arguments;if(t=u.isPlainObject(e)?e:{width:o[0],height:o[1],tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},u.EventSource.call(this),u.extend(!0,this,t),!this.success)for(i=0;i<arguments.length;i++)if(u.isFunction(arguments[i])){this.success=arguments[i];break}this.success&&this.addHandler("ready",function(e){n.success(e)}),"string"==u.type(e)&&(this.url=e),this.url?(this.aspectRatio=1,this.dimensions=new u.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=t.width&&t.height?t.width/t.height:1,this.dimensions=new u.Point(t.width,t.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=t.tileOverlap?t.tileOverlap:0,this.minLevel=t.minLevel?t.minLevel:0,this.maxLevel=undefined!==t.maxLevel&&null!==t.maxLevel?t.maxLevel:t.width&&t.height?Math.ceil(Math.log(Math.max(t.width,t.height))/Math.log(2)):0,this.success&&u.isFunction(this.success)&&this.success(this))},u.TileSource.prototype={getTileSize:function(){return u.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.getTileWidth(e)),n=Math.ceil(t*this.dimensions.y/this.getTileHeight(e));return new u.Point(i,n)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),i=1/t.x,n=1/t.y;return new u.Point(i,n)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!(1<(t=this.getNumTiles(e)).x||1<t.y);e++);return e-1},getTileAtPoint:function(e,t){var i=0<=t.x&&t.x<=1&&0<=t.y&&t.y<=1/this.aspectRatio;u.console.assert(i,"[TileSource.getTileAtPoint] must be called with a valid point.");var n=this.dimensions.x*this.getLevelScale(e),o=t.x*n,r=t.y*n,s=Math.floor(o/this.getTileWidth(e)),a=Math.floor(r/this.getTileHeight(e));1<=t.x&&(s=this.getNumTiles(e).x-1);var l=1e-16;return t.y>=1/this.aspectRatio-l&&(a=this.getNumTiles(e).y-1),new u.Point(s,a)},getTileBounds:function(e,t,i){var n=this.dimensions.times(this.getLevelScale(e)),o=this.getTileWidth(e),r=this.getTileHeight(e),s=0===t?0:o*t-this.tileOverlap,a=0===i?0:r*i-this.tileOverlap,l=o+(0===t?1:2)*this.tileOverlap,c=r+(0===i?1:2)*this.tileOverlap,h=1/n.x;return l=Math.min(l,n.x-s),c=Math.min(c,n.y-a),new u.Rect(s*h,a*h,l*h,c*h)},getImageInfo:function(o){var e,i,n,r,t,s,a,l=this;o&&-1<(a=(s=(t=o.split("/"))[t.length-1]).lastIndexOf("."))&&(t[t.length-1]=s.slice(0,a)),i=function(e){"string"==typeof e&&(e=u.parseXml(e));var t=u.TileSource.determineType(l,e,o);t?((r=t.prototype.configure.apply(l,[e,o])).ajaxWithCredentials===undefined&&(r.ajaxWithCredentials=l.ajaxWithCredentials),n=new t(r),l.ready=!0,l.raiseEvent("ready",{tileSource:n})):l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:o})},o.match(/\.js$/)?(e=o.split("/").pop().replace(".js",""),u.jsonp({url:o,async:!1,callbackName:e,callback:i})):u.makeAjaxRequest({url:o,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(e){var t=c(e);i(t)},
error:function(e,t){var i;try{i="HTTP "+e.status+" attempting to load TileSource"}catch(n){i=(void 0!==t&&t.toString?t.toString():"Unknown error")+" attempting to load TileSource"}l.raiseEvent("open-failed",{message:i,source:o})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(){return{}},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&0<=t&&0<=i&&t<n.x&&i<n.y}},u.extend(!0,u.TileSource.prototype,u.EventSource.prototype),u.TileSource.determineType=function(e,t,i){var n;for(n in OpenSeadragon)if(n.match(/.+TileSource$/)&&u.isFunction(OpenSeadragon[n])&&u.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(e,t,i))return OpenSeadragon[n];u.console.error("No TileSource was able to open %s %s",i,t)}}(OpenSeadragon),function(g){function n(e,t){if(!t||!t.documentElement)throw new Error(g.getString("Errors.Xml"));var i,n,o,r,s,a=t.documentElement,l=a.localName||a.tagName,c=t.documentElement.namespaceURI,h=null,u=[];if("Image"==l)try{if((r=a.getElementsByTagName("Size")[0])===undefined&&(r=a.getElementsByTagNameNS(c,"Size")[0]),h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(r.getAttribute("Height"),10),Width:parseInt(r.getAttribute("Width"),10)}}},!g.imageFormatSupported(h.Image.Format))throw new Error(g.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()));for((i=a.getElementsByTagName("DisplayRect"))===undefined&&(i=a.getElementsByTagNameNS(c,"DisplayRect")[0]),s=0;s<i.length;s++)(o=(n=i[s]).getElementsByTagName("Rect")[0])===undefined&&(o=n.getElementsByTagNameNS(c,"Rect")[0]),u.push({Rect:{X:parseInt(o.getAttribute("X"),10),Y:parseInt(o.getAttribute("Y"),10),Width:parseInt(o.getAttribute("Width"),10),Height:parseInt(o.getAttribute("Height"),10),MinLevel:parseInt(n.getAttribute("MinLevel"),10),MaxLevel:parseInt(n.getAttribute("MaxLevel"),10)}});return u.length&&(h.Image.DisplayRect=u),m(e,h)}catch(p){throw p instanceof Error?p:new Error(g.getString("Errors.Dzi"))}else{if("Collection"==l)throw new Error(g.getString("Errors.Dzc"));if("Error"==l){var d=a.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(d)}}throw new Error(g.getString("Errors.Dzi"))}function m(e,t){var i,n,o=t.Image,r=o.Url,s=o.Format,a=o.Size,l=o.DisplayRect||[],c=parseInt(a.Width,10),h=parseInt(a.Height,10),u=parseInt(o.TileSize,10),d=parseInt(o.Overlap,10),p=[];for(n=0;n<l.length;n++)i=l[n].Rect,p.push(new g.DisplayRect(parseInt(i.X,10),parseInt(i.Y,10),parseInt(i.Width,10),parseInt(i.Height,10),parseInt(i.MinLevel,10),parseInt(i.MaxLevel,10)));return g.extend(!0,{width:c,height:h,tileSize:u,tileOverlap:d,minLevel:null,maxLevel:null,tilesUrl:r,fileFormat:s,displayRects:p},t)}g.DziTileSource=function(e,t,i,n,o,r,s,a,l){var c,h,u,d;if(d=g.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o,fileFormat:r,displayRects:s,minLevel:a,maxLevel:l},this._levelRects={},this.tilesUrl=d.tilesUrl,this.fileFormat=d.fileFormat,this.displayRects=d.displayRects,this.displayRects)for(c=this.displayRects.length-1;0<=c;c--)for(u=(h=this.displayRects[c]).minLevel;u<=h.maxLevel;u++)this._levelRects[u]||(this._levelRects[u]=[]),this._levelRects[u].push(h);g.TileSource.apply(this,[d])},g.extend(g.DziTileSource.prototype,g.TileSource.prototype,{supports:function(e){var t;return e.Image?t=e.Image.xmlns:e.documentElement&&("Image"!=e.documentElement.localName&&"Image"!=e.documentElement.tagName||(t=e.documentElement.namespaceURI)),-1!==(t=(t||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==t.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(e,t){var i;return i=g.isPlainObject(e)?m(this,e):n(this,e),t&&!i.tilesUrl&&(i.tilesUrl=t.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=t.search(/\.(dzi|xml|js)\?/)?i.queryParams=t.match(/\?.*/):i.queryParams=""),i},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,o,r,s,a,l,c,h=this._levelRects[e];if(!h||!h.length)return!0;for(c=h.length-1;0<=c;c--)if(!(e<(n=h[c]).minLevel||e>n.maxLevel)&&(o=this.getLevelScale(e),r=n.x*o,s=n.y*o,a=r+n.width*o,l=s+n.height*o,r=Math.floor(r/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),r<=t&&t<a&&s<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(l){function c(e){return!(-1!=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(e[0]))||-1!=e.indexOf("sizeByW")}function h(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+",/0/default.jpg",width:e.sizes[i].width,height:e.sizes[i].height});return t.sort(function(e,t){return e.width-t.width})}function n(e){if(!e||!e.documentElement)throw new Error(l.getString("Errors.Xml"));var t=e.documentElement,i=null;if("info"==t.tagName)try{return r(t,i={}),i}catch(n){throw n instanceof Error?n:new Error(l.getString("Errors.IIIF"))}throw new Error(l.getString("Errors.IIIF"))}function r(e,t,i){var n,o;if(3==e.nodeType&&i)(o=e.nodeValue.trim()).match(/^\d*$/)&&(o=Number(o)),t[i]?(l.isArray(t[i])||(t[i]=[t[i]]),t[i].push(o)):t[i]=o;else if(1==e.nodeType)for(n=0;n<e.childNodes.length;n++)r(e.childNodes[n],t,e.nodeName)}l.IIIFTileSource=function(e){if(l.extend(!0,this,e),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(e.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)e.tileWidth=this.tile_width,e.tileHeight=this.tile_height;else if(this.tile_width)e.tileSize=this.tile_width;else if(this.tile_height)e.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)e.tileWidth=this.tiles[0].width,e.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var i=0;i<this.tiles[t].scaleFactors.length;i++){var n=this.tiles[t].scaleFactors[i];this.scale_factors.push(n),e.tileSizePerScaleFactor[n]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(c(e.profile)){for(var o=Math.min(this.height,this.width),r=[256,512,1024],s=[],a=0;a<r.length;a++)r[a]<=o&&s.push(r[a]);0<s.length?e.tileSize=Math.max.apply(null,s):e.tileSize=o}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,e.levels=h(this),l.extend(!0,e,{width:e.levels[e.levels.length-1].width,height:e.levels[e.levels.length-1].height,tileSize:Math.max(e.height,e.width),tileOverlap:0,minLevel:0,maxLevel:e.levels.length-1}),this.levels=e.levels):l.console.error("Nothing in the info.json to construct image pyramids from");e.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?e.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5)):e.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),l.TileSource.apply(this,[e])},l.extend(l.IIIFTileSource.prototype,l.TileSource.prototype,{supports:function(e){return!(!e.protocol||"http://iiif.io/api/image"!=e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=e["@context"]&&"http://iiif.io/api/image/1/context.json"!=e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!=e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=e.documentElement.namespaceURI))))},configure:function(e,t){if(l.isPlainObject(e))return e["@context"]||(e["@context"]="http://iiif.io/api/image/1.0/context.json",e["@id"]=t.replace("/info.json","")),e;var i=n(e);return i["@context"]="http://iiif.io/api/image/1.0/context.json",i["@id"]=t.replace("/info.xml",""),i},getTileWidth:function(e){if(this.emulateLegacyImagePyramid)return l.TileSource.prototype.getTileWidth.call(this,e);var t=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[t]?this.tileSizePerScaleFactor[t].width:this._tileWidth},getTileHeight:function(e){if(this.emulateLegacyImagePyramid)return l.TileSource.prototype.getTileHeight.call(this,e);var t=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[t]?this.tileSizePerScaleFactor[t].height:this._tileHeight},getLevelScale:function(e){if(this.emulateLegacyImagePyramid){var t=NaN;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t}return l.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){return this.emulateLegacyImagePyramid?this.getLevelScale(e)?new l.Point(1,1):new l.Point(0,0):l.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,t){return this.emulateLegacyImagePyramid?new l.Point(0,0):l.TileSource.prototype.getTileAtPoint.call(this,e,t)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var n=null;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}var o,r,s,a,l,c,h,u,d,p,g,m="0",f=Math.pow(.5,this.maxLevel-e),v=Math.ceil(this.width*f),y=Math.ceil(this.height*f);return o=this.getTileWidth(e),r=this.getTileHeight(e),s=Math.ceil(o/f),a=Math.ceil(r/f),g=-1<this["@context"].indexOf("/1.0/context.json")||-1<this["@context"].indexOf("/1.1/context.json")||-1<this["@context"].indexOf("/1/context.json")?"native.jpg":"default.jpg",v<o&&y<r?(p=v+",",l="full"):(c=t*s,h=i*a,u=Math.min(s,this.width-c),d=Math.min(a,this.height-h),p=Math.ceil(u*f)+",",l=[c,h,u,d].join(",")),[this["@id"],l,p,m,g].join("/")}})}(OpenSeadragon),function(s){s.OsmTileSource=function(e,t,i,n,o){var r;(r=s.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o}).width&&r.height||(r.width=65572864,r.height=65572864),r.tileSize||(r.tileSize=256,r.tileOverlap=0),r.tilesUrl||(r.tilesUrl="http://tile.openstreetmap.org/"),r.minLevel=8,s.TileSource.apply(this,[r])},s.extend(s.OsmTileSource.prototype,s.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(c){c.TmsTileSource=function(e,t,i,n,o){var r;r=c.isPlainObject(e)?e:{width:e,height:t,tileSize:i,tileOverlap:n,tilesUrl:o};var s,a=256*Math.ceil(r.width/256),l=256*Math.ceil(r.height/256);s=l<a?a/256:l/256,r.maxLevel=Math.ceil(Math.log(s)/Math.log(2))-1,r.tileSize=256,r.width=a,r.height=l,c.TileSource.apply(this,[r])},c.extend(c.TmsTileSource.prototype,c.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,o={},r=0;r<e;r++)n+=(o=this.gridSize[r]).x*o.y;return n+=(o=this.gridSize[e]).x*i+t},supports:function(e){return e.type&&"zoomifytileservice"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){var n=0,o=this._calculateAbsoluteTileNumber(e,t,i);return n=Math.floor(o/256),this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+".jpg"}})}(OpenSeadragon),function(c){function o(e){var t,i,n=[];for(i=0;i<e.length;i++)(t=e[i]).height&&t.width&&t.url?n.push({url:t.url,width:Number(t.width),height:Number(t.height)}):c.console.error("Unsupported image format: %s",t.url?t.url:"<no URL>");return n.sort(function(e,t){return e.height-t.height})}function t(e,t){if(!t||!t.documentElement)throw new Error(c.getString("Errors.Xml"));var i,n,o=t.documentElement,r=o.tagName,s=null,a=[];if("image"==r)try{for(s={type:o.getAttribute("type"),levels:[]},a=o.getElementsByTagName("level"),n=0;n<a.length;n++)i=a[n],s.levels.push({url:i.getAttribute("url"),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10)});return h(e,s)}catch(l){throw l instanceof Error?l:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==r)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==r)throw new Error("Error: "+t)}throw new Error("Unknown element "+r)}function h(e,t){return t.levels}c.LegacyTileSource=function(e){var t,i,n;c.isArray(e)&&(t={type:"legacy-image-pyramid",levels:e}),t.levels=o(t.levels),0<t.levels.length?(i=t.levels[t.levels.length-1].width,n=t.levels[t.levels.length-1].height):(n=i=0,c.console.error("No supported image formats found")),c.extend(!0,t,{width:i,height:n,tileSize:Math.max(n,i),tileOverlap:0,minLevel:0,maxLevel:0<t.levels.length?t.levels.length-1:0}),c.TileSource.apply(this,[t]),this.levels=t.levels},c.extend(c.LegacyTileSource.prototype,c.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(e){return c.isPlainObject(e)?h(this,e):t(this,e)},getLevelScale:function(e){var t=NaN;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(e){return this.getLevelScale(e)?new c.Point(1,1):new c.Point(0,0)},getTileUrl:function(e){var t=null;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].url),t}})}(OpenSeadragon),function(a){a.ImageTileSource=function(e){e=a.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),a.TileSource.apply(this,[e])},a.extend(a.ImageTileSource.prototype,a.TileSource.prototype,{supports:function(e){return e.type&&"image"===e.type},configure:function(e){return e},getImageInfo:function(e){var t=this._image=new Image,i=this;this.crossOriginPolicy&&(t.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(t.useCredentials=this.ajaxWithCredentials),a.addEvent(t,"load",function(){i.width=Object.prototype.hasOwnProperty.call(t,"naturalWidth")?t.naturalWidth:t.width,i.height=Object.prototype.hasOwnProperty.call(t,"naturalHeight")?t.naturalHeight:t.height,i.aspectRatio=i.width/i.height,i.dimensions=new a.Point(i.width,i.height),i._tileWidth=i.width,i._tileHeight=i.height,i.tileOverlap=0,i.minLevel=0,i.levels=i._buildLevels(),i.maxLevel=i.levels.length-1,i.ready=!0,i.raiseEvent("ready",{tileSource:i})}),a.addEvent(t,"error",function(){i.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),t.src=e},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(e){return this.getLevelScale(e)?new a.Point(1,1):new a.Point(0,0)},getTileUrl:function(e){var t=null;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].url),t},getContext2D:function(e){var t=null;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].context2D),t},_buildLevels:function(){var e=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!a.supportsCanvas||!this.useCanvas)return delete this._image,e;var t=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,i=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,n=document.createElement("canvas"),o=n.getContext("2d");if(n.width=t,n.height=i,o.drawImage(this._image,0,0,t,i),e[0].context2D=o,delete this._image,a.isCanvasTainted(n))return e;for(;2<=t&&2<=i;){t=Math.floor(t/2),i=Math.floor(i/2);var r=document.createElement("canvas"),s=r.getContext("2d");r.width=t,r.height=i,s.drawImage(n,0,0,t,i),e.splice(0,0,{context2D:s,width:t,height:i}),n=r,o=s}return e}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(i){function n(e){i.requestAnimationFrame(function(){t(e)})}function t(e){var t;e.shouldFade&&(t=1-(i.now()-e.fadeBeginTime)/e.fadeLength,t=Math.min(1,t),t=Math.max(0,t),e.imgGroup&&i.setElementOpacity(e.imgGroup,t,!0),0<t&&n(e))}function o(e){e.shouldFade=!0,e.fadeBeginTime=i.now()+e.fadeDelay,window.setTimeout(function(){n(e)},e.fadeDelay)}function r(e){e.shouldFade=!1,e.imgGroup&&i.setElementOpacity(e.imgGroup,1,!0)}function s(e,t){e.element.disabled||(t>=i.ButtonState.GROUP&&e.currentState==i.ButtonState.REST&&(r(e),e.currentState=i.ButtonState.GROUP),t>=i.ButtonState.HOVER&&e.currentState==i.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=i.ButtonState.HOVER),t>=i.ButtonState.DOWN&&e.currentState==i.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=i.ButtonState.DOWN))}function a(e,t){e.element.disabled||(t<=i.ButtonState.HOVER&&e.currentState==i.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=i.ButtonState.HOVER),t<=i.ButtonState.GROUP&&e.currentState==i.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=i.ButtonState.GROUP),t<=i.ButtonState.REST&&e.currentState==i.ButtonState.GROUP&&(o(e),e.currentState=i.ButtonState.REST))}i.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},i.Button=function(e){var t=this;i.EventSource.call(this),i.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:i.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:i.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},e),this.element=e.element||i.makeNeutralElement("div"),e.element||(this.imgRest=i.makeTransparentImage(this.srcRest),this.imgGroup=i.makeTransparentImage(this.srcGroup),this.imgHover=i.makeTransparentImage(this.srcHover),this.imgDown=i.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",i.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",i.Browser.vendor==i.BROWSERS.FIREFOX&&i.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=i.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new i.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){e.insideElementPressed?(s(t,i.ButtonState.DOWN),t.raiseEvent("enter",{originalEvent:e.originalEvent})):e.buttonDownAny||s(t,i.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),t.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(e){a(t,i.ButtonState.GROUP),e.insideElementPressed&&t.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(e){this.exitHandler(e),t.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(e){s(t,i.ButtonState.DOWN),t.raiseEvent("press",{originalEvent:e.originalEvent})},releaseHandler:function(e){e.insideElementPressed&&e.insideElementReleased?(a(t,i.ButtonState.HOVER),t.raiseEvent("release",{originalEvent:e.originalEvent})):e.insideElementPressed?a(t,i.ButtonState.GROUP):s(t,i.ButtonState.HOVER)},clickHandler:function(e){e.quick&&t.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(t.raiseEvent("click",{originalEvent:e.originalEvent}),t.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),a(this,i.ButtonState.REST)},i.extend(i.Button.prototype,i.EventSource.prototype,{notifyGroupEnter:function(){s(this,i.ButtonState.GROUP)},notifyGroupExit:function(){a(this,i.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,i.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,i.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(o){o.ButtonGroup=function(e){o.extend(!0,this,{buttons:[],clickTimeThreshold:o.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:o.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},e);var t,i=this.buttons.concat([]),n=this;if(this.element=e.element||o.makeNeutralElement("div"),!e.group)for(this.label=o.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),t=0;t<i.length;t++)this.element.appendChild(i[t].element);o.setElementTouchActionNone(this.element),this.tracker=new o.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;e<n.buttons.length;e++)n.buttons[e].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<n.buttons.length;t++)n.buttons[t].notifyGroupExit()}})},o.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(P){P.Rect=function(e,t,i,n,o){var r,s;this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0,this.degrees="number"==typeof o?o:0,this.degrees=P.positiveModulo(this.degrees,360),270<=this.degrees?(r=this.getTopRight(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=270):180<=this.degrees?(r=this.getBottomRight(),this.x=r.x,this.y=r.y,this.degrees-=180):90<=this.degrees&&(r=this.getBottomLeft(),this.x=r.x,this.y=r.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=90)},P.Rect.fromSummits=function(e,t,i){var n=e.distanceTo(t),o=e.distanceTo(i),r=t.minus(e),s=Math.atan(r.y/r.x);return r.x<0?s+=Math.PI:r.y<0&&(s+=2*Math.PI),new P.Rect(e.x,e.y,n,o,s/Math.PI*180)},P.Rect.prototype={clone:function(){return new P.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new P.Point(this.x,this.y)},getBottomRight:function(){return new P.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new P.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new P.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new P.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new P.Point(this.width,this.height)},equals:function(e){return e instanceof P.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new P.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new P.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(e){var t=this.getBoundingBox(),i=e.getBoundingBox(),n=Math.min(t.x,i.x),o=Math.min(t.y,i.y),r=Math.max(t.x+t.width,i.x+i.width),s=Math.max(t.y+t.height,i.y+i.height);return new P.Rect(n,o,r-n,s-o)},intersection:function(e){function t(e,t,i,n){var o=t.minus(e),r=n.minus(i),s=-r.x*o.y+o.x*r.y;if(0===s)return null;var a=(o.x*(e.y-i.y)-o.y*(e.x-i.x))/s,l=(r.x*(e.y-i.y)-r.y*(e.x-i.x))/s;return-c<=a&&a<=1-c&&-c<=l&&l<=1-c?new P.Point(e.x+l*o.x,e.y+l*o.y):null}var c=1e-10,i=[],n=this.getTopLeft();e.containsPoint(n,c)&&i.push(n);var o=this.getTopRight();e.containsPoint(o,c)&&i.push(o);var r=this.getBottomLeft();e.containsPoint(r,c)&&i.push(r);var s=this.getBottomRight();e.containsPoint(s,c)&&i.push(s);var a=e.getTopLeft();this.containsPoint(a,c)&&i.push(a);var l=e.getTopRight();this.containsPoint(l,c)&&i.push(l);var h=e.getBottomLeft();this.containsPoint(h,c)&&i.push(h);var u=e.getBottomRight();this.containsPoint(u,c)&&i.push(u);for(var d=this._getSegments(),p=e._getSegments(),g=0;g<d.length;g++)for(var m=d[g],f=0;f<p.length;f++){var v=p[f],y=t(m[0],m[1],v[0],v[1]);y&&i.push(y)}if(0===i.length)return null;for(var w=i[0].x,T=i[0].x,S=i[0].y,b=i[0].y,x=1;x<i.length;x++){var E=i[x];E.x<w&&(w=E.x),E.x>T&&(T=E.x),E.y<S&&(S=E.y),E.y>b&&(b=E.y)}return new P.Rect(w,S,T-w,b-S)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(e,t){if(0===(e=P.positiveModulo(e,360)))return this.clone();t=t||this.getCenter();var i=this.getTopLeft().rotate(e,t),n=this.getTopRight().rotate(e,t).minus(i);n=n.apply(function(e){var t=1e-15;return Math.abs(e)<t?0:e});var o=Math.atan(n.y/n.x);return n.x<0?o+=Math.PI:n.y<0&&(o+=2*Math.PI),new P.Rect(i.x,i.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight(),o=Math.min(e.x,t.x,i.x,n.x),r=Math.max(e.x,t.x,i.x,n.x),s=Math.min(e.y,t.y,i.y,n.y),a=Math.max(e.y,t.y,i.y,n.y);return new P.Rect(o,s,r-o,a-s)},getIntegerBoundingBox:function(){var e=this.getBoundingBox(),t=Math.floor(e.x),i=Math.floor(e.y),n=Math.ceil(e.width+e.x-t),o=Math.ceil(e.height+e.y-i);return new P.Rect(t,i,n,o)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),o=this.getBottomLeft(),r=n.minus(i),s=o.minus(i);return(e.x-i.x)*r.x+(e.y-i.y)*r.y>=-t&&(e.x-n.x)*r.x+(e.y-n.y)*r.y<=t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-o.x)*s.x+(e.y-o.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(d){function a(e){var t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),r=d.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-e.delta.x?t>-(n-r.x)&&(this.element.style.marginLeft=t+2*e.delta.x+"px",c(this,r.x,t+2*e.delta.x)):-e.delta.x<0&&t<0&&(this.element.style.marginLeft=t+2*e.delta.x+"px",c(this,r.x,t+2*e.delta.x)):0<-e.delta.y?i>-(o-r.y)&&(this.element.style.marginTop=i+2*e.delta.y+"px",c(this,r.y,i+2*e.delta.y)):-e.delta.y<0&&i<0&&(this.element.style.marginTop=i+2*e.delta.y+"px",c(this,r.y,i+2*e.delta.y))),!1}function l(e){var t=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),n=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),r=d.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<e.scroll?t>-(n-r.x)&&(this.element.style.marginLeft=t-60*e.scroll+"px",c(this,r.x,t-60*e.scroll)):e.scroll<0&&t<0&&(this.element.style.marginLeft=t-60*e.scroll+"px",c(this,r.x,t-60*e.scroll)):e.scroll<0?i>r.y-o&&(this.element.style.marginTop=i+60*e.scroll+"px",c(this,r.y,i+60*e.scroll)):0<e.scroll&&i<0&&(this.element.style.marginTop=i+60*e.scroll+"px",c(this,r.y,i+60*e.scroll))),!1}function c(e,t,i){var n,o,r,s,a,l,c;for(n="horizontal"==e.scroll?e.panelWidth:e.panelHeight,o=Math.ceil(t/n)+5,l=o=(o=(r=Math.ceil((Math.abs(i)+t)/n)+1)-o)<0?0:o;l<r&&l<e.panels.length;l++)if(!(c=e.panels[l]).activePanel){var h,u=e.viewer.tileSources[l];h=u.referenceStripThumbnailUrl?{type:"image",url:u.referenceStripThumbnailUrl}:u,(s=new d.Viewer({id:c.id,tileSources:[h],element:c,navigatorSizeRatio:e.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0})).displayRegion=d.makeNeutralElement("div"),s.displayRegion.id=c.id+"-displayregion",s.displayRegion.className="displayregion",(a=s.displayRegion.style).position="relative",a.top="0px",a.left="0px",a.fontSize="0px",a.overflow="hidden",a["float"]="left",a.cssFloat="left",a.styleFloat="left",a.zIndex=999999999,a.cursor="default",a.width=e.panelWidth-4+"px",a.height=e.panelHeight-4+"px",s.displayRegion.innerTracker=new d.MouseTracker({element:s.displayRegion,startDisabled:!0}),c.getElementsByTagName("div")[0].appendChild(s.displayRegion),e.miniViewers[c.id]=s,c.activePanel=!0}}function h(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function u(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="-"+d.getElementSize(t).y/2+"px":t.style.marginLeft="-"+d.getElementSize(t).x/2+"px",!1}function p(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function g(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return l.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return l.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var m={};d.ReferenceStrip=function(e){var t,i,n,o=this,r=e.viewer,s=d.getElementSize(r.element);for(e.id||(e.id="referencestrip-"+d.now(),this.element=d.makeNeutralElement("div"),this.element.id=e.id,this.element.className="referencestrip"),e=d.extend(!0,{sizeRatio:d.DEFAULT_SETTINGS.referenceStripSizeRatio,position:d.DEFAULT_SETTINGS.referenceStripPosition,scroll:d.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:d.DEFAULT_SETTINGS.clickTimeThreshold},e,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),d.extend(this,e),m[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(i=this.element.style).marginTop="0px",i.marginRight="0px",i.marginBottom="0px",i.marginLeft="0px",i.left="0px",i.bottom="0px",i.border="0px",i.background="#000",i.position="relative",d.setElementTouchActionNone(this.element),d.setElementOpacity(this.element,.8),this.viewer=r,this.innerTracker=new d.MouseTracker({element:this.element,dragHandler:d.delegate(this,a),scrollHandler:d.delegate(this,l),enterHandler:d.delegate(this,h),
exitHandler:d.delegate(this,u),keyDownHandler:d.delegate(this,p),keyHandler:d.delegate(this,g)}),e.width&&e.height?(this.element.style.width=e.width+"px",this.element.style.height=e.height+"px",r.addControl(this.element,{anchor:d.ControlAnchor.BOTTOM_LEFT})):"horizontal"==e.scroll?(this.element.style.width=s.x*e.sizeRatio*r.tileSources.length+12*r.tileSources.length+"px",this.element.style.height=s.y*e.sizeRatio+"px",r.addControl(this.element,{anchor:d.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=s.y*e.sizeRatio*r.tileSources.length+12*r.tileSources.length+"px",this.element.style.width=s.x*e.sizeRatio+"px",r.addControl(this.element,{anchor:d.ControlAnchor.TOP_LEFT})),this.panelWidth=s.x*this.sizeRatio+8,this.panelHeight=s.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},n=0;n<r.tileSources.length;n++)(t=d.makeNeutralElement("div")).id=this.element.id+"-"+n,t.style.width=o.panelWidth+"px",t.style.height=o.panelHeight+"px",t.style.display="inline",t.style["float"]="left",t.style.cssFloat="left",t.style.styleFloat="left",t.style.padding="2px",d.setElementTouchActionNone(t),t.innerTracker=new d.MouseTracker({element:t,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(e){e.eventSource.dragging=d.now()},releaseHandler:function(e){var t=e.eventSource,i=t.element.id,n=Number(i.split("-")[2]),o=d.now();e.insideElementPressed&&e.insideElementReleased&&t.dragging&&o-t.dragging<t.clickTimeThreshold&&(t.dragging=null,r.goToPage(n))}}),this.element.appendChild(t),t.activePanel=!1,this.panels.push(t);c(this,"vertical"==this.scroll?s.y:s.x,0),this.setFocus(0)},d.extend(d.ReferenceStrip.prototype,d.EventSource.prototype,d.Viewer.prototype,{setFocus:function(e){var t,i=d.getElement(this.element.id+"-"+e),n=d.getElementSize(this.viewer.canvas),o=Number(this.element.style.width.replace("px","")),r=Number(this.element.style.height.replace("px","")),s=-Number(this.element.style.marginLeft.replace("px","")),a=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==i&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=i,this.currentSelected.style.background="#999","horizontal"==this.scroll?(t=Number(e)*(this.panelWidth+3))>s+n.x-this.panelWidth?(t=Math.min(t,o-n.x),this.element.style.marginLeft=-t+"px",c(this,n.x,-t)):t<s&&(t=Math.max(0,t-n.x/2),this.element.style.marginLeft=-t+"px",c(this,n.x,-t)):(t=Number(e)*(this.panelHeight+3))>a+n.y-this.panelHeight?(t=Math.min(t,r-n.y),this.element.style.marginTop=-t+"px",c(this,n.y,-t)):t<a&&(t=Math.max(0,t-n.y/2),this.element.style.marginTop=-t+"px",c(this,n.y,-t)),this.currentPage=e,h.call(this,{eventSource:this.innerTracker}))},update:function(){return!!m[this.id].animating&&(d.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(s){s.DisplayRect=function(e,t,i,n,o,r){s.Rect.apply(this,[e,t,i,n]),this.minLevel=o,this.maxLevel=r},s.extend(s.DisplayRect.prototype,s.Rect.prototype)}(OpenSeadragon),function(o){function r(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}o.Spring=function(e){var t=arguments;"object"!=typeof e&&(e={initial:t.length&&"number"==typeof t[0]?t[0]:undefined,springStiffness:1<t.length?t[1].springStiffness:5,animationTime:1<t.length?t[1].animationTime:1.5}),o.console.assert("number"==typeof e.springStiffness&&0!==e.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),o.console.assert("number"==typeof e.animationTime&&0<=e.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),e.exponential&&(this._exponential=!0,delete e.exponential),o.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:o.now()},o.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},o.Spring.prototype={resetTo:function(e){o.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=o.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(e){o.console.assert(!this._exponential||0!==e,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(e){this.start.value+=e,this.target.value+=e,this._exponential&&(o.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(e){this._exponential=e,this._exponential&&(o.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var e,t;this.current.time=o.now(),this._exponential?(e=this.start._logValue,t=this.target._logValue):(e=this.start.value,t=this.target.value);var i=this.current.time>=this.target.time?t:e+(t-e)*r(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),n=this.current.value;return this._exponential?this.current.value=Math.exp(i):this.current.value=i,n!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(t){function o(e){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null},e),this.image=null}function r(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&0<e.jobQueue.length&&(e.jobQueue.shift().start(),e.jobsInProgress++),i(t.image,t.errorMsg,t.request)}o.prototype={errorMsg:null,start:function(){var s=this,e=this.abort;this.image=new Image,this.image.onload=function(){s.finish(!0)},this.image.onabort=this.image.onerror=function(){s.errorMsg="Image load aborted",s.finish(!1)},this.jobId=window.setTimeout(function(){s.errorMsg="Image load exceeded timeout",s.finish(!1)},this.timeout),this.loadWithAjax?(this.request=t.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var t;try{t=new window.Blob([e.response])}catch(r){var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===r.name&&i){var n=new i;n.append(e.response),t=n.getBlob()}}0===t.size&&(s.errorMsg="Empty image response.",s.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(t);s.image.src=o},error:function(){s.errorMsg="Image load aborted - XHR error",s.finish(!1)}}),this.abort=function(){s.request.abort(),"function"==typeof e&&e()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(e){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},e)},t.ImageLoader.prototype={addJob:function(t){var i=this,e=function(e){r(i,e,t.callback)},n=new o({src:t.src,loadWithAjax:t.loadWithAjax,ajaxHeaders:t.loadWithAjax?t.ajaxHeaders:null,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:e,abort:t.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(a){a.Tile=function(e,t,i,n,o,r,s,a,l){this.level=e,this.x=t,this.y=i,this.bounds=n,this.exists=o,this.url=r,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},a.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){this.cacheImageRecord?this.loaded?(this.element||(this.element=a.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",a.setElementOpacity(this.element,this.opacity)):a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):a.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(e,t,i,n){var o,r=this.position.times(a.pixelDensityRatio),s=this.size.times(a.pixelDensityRatio);this.context2D||this.cacheImageRecord?(o=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&o?(e.save(),e.globalAlpha=this.opacity,"number"==typeof i&&1!==i&&(r=r.times(i),s=s.times(i)),n instanceof a.Point&&(r=r.plus(n)),1===e.globalAlpha&&this._hasTransparencyChannel()&&e.clearRect(r.x+1,r.y+1,s.x-2,s.y-2),t({context:e,tile:this,rendered:o}),e.drawImage(o.canvas,0,0,o.canvas.width,o.canvas.height,r.x,r.y,s.x,s.y),e.restore()):a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):a.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return a.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*a.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(e,t,i){var n=Math.max(1,Math.ceil((i.x-t.x)/2)),o=Math.max(1,Math.ceil((i.y-t.y)/2));return new a.Point(n,o).minus(this.position.times(a.pixelDensityRatio).times(e||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(h){h.OverlayPlacement=h.Placement,h.OverlayRotationMode=h.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),h.Overlay=function(e,t,i){var n;n=h.isPlainObject(e)?e:{element:e,location:t,placement:i},this.element=n.element,this.style=n.element.style,this._init(n)},h.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=e.placement===undefined?h.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=e.checkResize===undefined||e.checkResize,this.width=e.width===undefined?null:e.width,this.height=e.height===undefined?null:e.height,this.rotationMode=e.rotationMode||h.OverlayRotationMode.EXACT,this.location instanceof h.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=h.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new h.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,t){var i=h.Placement.properties[this.placement];i&&(i.isHorizontallyCentered?e.x-=t.x/2:i.isRight&&(e.x-=t.x),i.isVerticallyCentered?e.y-=t.y/2:i.isBottom&&(e.y-=t.y))},destroy:function(){var e=this.element,t=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),this.onDraw=null,t.top="",t.left="",t.position="",null!==this.width&&(t.width=""),null!==this.height&&(t.height="");var i=h.getCssPropertyWithVendorPrefix("transformOrigin"),n=h.getCssPropertyWithVendorPrefix("transform");i&&n&&(t[i]="",t[n]="")},drawHTML:function(e,t){var i=this.element;i.parentNode!==e&&(i.prevElementParent=i.parentNode,i.prevNextSibling=i.nextSibling,e.appendChild(i),this.style.position="absolute",this.size=h.getElementSize(i));var n=this._getOverlayPositionAndSize(t),o=n.position,r=this.size=n.size,s=n.rotate;if(this.onDraw)this.onDraw(o,r,this.element);else{var a=this.style;a.left=o.x+"px",a.top=o.y+"px",null!==this.width&&(a.width=r.x+"px"),null!==this.height&&(a.height=r.y+"px");var l=h.getCssPropertyWithVendorPrefix("transformOrigin"),c=h.getCssPropertyWithVendorPrefix("transform");l&&c&&(s?(a[l]=this._getTransformOrigin(),a[c]="rotate("+s+"deg)"):(a[l]="",a[c]="")),"none"!==a.display&&(a.display="block")}},_getOverlayPositionAndSize:function(e){var t=e.pixelFromPoint(this.location,!0),i=this._getSizeInPixels(e);this.adjust(t,i);var n=0;if(e.degrees&&this.rotationMode!==h.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===h.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new h.Rect(t.x,t.y,i.x,i.y),r=this._getBoundingBox(o,e.degrees);t=r.getTopLeft(),i=r.getSize()}else n=e.degrees;return{position:t,size:i,rotate:n}},_getSizeInPixels:function(e){var t=this.size.x,i=this.size.y;if(null!==this.width||null!==this.height){var n=e.deltaPixelsFromPointsNoRotate(new h.Point(this.width||0,this.height||0),!0);null!==this.width&&(t=n.x),null!==this.height&&(i=n.y)}if(this.checkResize&&(null===this.width||null===this.height)){var o=this.size=h.getElementSize(this.element);null===this.width&&(t=o.x),null===this.height&&(i=o.y)}return new h.Point(t,i)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(e){var t=new h.Point(e.x,e.y),i=h.Placement.properties[this.placement];return i&&(i.isHorizontallyCentered?t.x+=e.width/2:i.isRight&&(t.x+=e.width),i.isVerticallyCentered?t.y+=e.height/2:i.isBottom&&(t.y+=e.height)),t},_getTransformOrigin:function(){var e="",t=h.Placement.properties[this.placement];return t&&(t.isLeft?e="left":t.isRight&&(e="right"),t.isTop?e+=" top":t.isBottom&&(e+=" bottom")),e},update:function(e,t){var i=h.isPlainObject(e)?e:{location:e,placement:t};this._init({location:i.location||this.location,placement:i.placement!==undefined?i.placement:this.placement,onDraw:i.onDraw||this.onDraw,checkResize:i.checkResize||this.checkResize,width:i.width!==undefined?i.width:this.width,height:i.height!==undefined?i.height:this.height,rotationMode:i.rotationMode||this.rotationMode})},getBounds:function(e){h.console.assert(e,"A viewport must now be passed to Overlay.getBounds.");var t=this.width,i=this.height;if(null===t||null===i){var n=e.deltaPointsFromPixelsNoRotate(this.size,!0);null===t&&(t=n.x),null===i&&(i=n.y)}var o=this.location.clone();return this.adjust(o,new h.Point(t,i)),this._adjustBoundsForRotation(e,new h.Rect(o.x,o.y,t,i))},_adjustBoundsForRotation:function(e,t){if(!e||0===e.degrees||this.rotationMode===h.OverlayRotationMode.EXACT)return t;if(this.rotationMode===h.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return t;var i=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new h.Rect(i.position.x,i.position.y,i.size.x,i.size.y))}return t.rotate(-e.degrees,this._getPlacementPoint(t))}}}(OpenSeadragon),function(u){u.Drawer=function(e){u.console.assert(e.viewer,"[Drawer] options.viewer is required");var t=arguments;if(u.isPlainObject(e)||(e={source:t[0],viewport:t[1],element:t[2]}),u.console.assert(e.viewport,"[Drawer] options.viewport is required"),u.console.assert(e.element,"[Drawer] options.element is required"),e.source&&u.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor="string"==typeof e.debugGridColor?[e.debugGridColor]:e.debugGridColor||u.DEFAULT_SETTINGS.debugGridColor,e.opacity&&u.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=u.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=u.getElement(e.element),this.canvas=u.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var i=this._calculateCanvasSize();this.canvas.width=i.x,this.canvas.height=i.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",u.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},u.Drawer.prototype={addOverlay:function(e,t,i,n){return u.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(e,t,i,n),this},updateOverlay:function(e,t,i){return u.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,t,i),this},removeOverlay:function(e){return u.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return u.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(e){u.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var t=this.viewer.world,i=0;i<t.getItemCount();i++)t.getItemAt(i).setOpacity(e);return this},getOpacity:function(){u.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var e=this.viewer.world,t=0,i=0;i<e.getItemCount();i++){var n=e.getItemAt(i).getOpacity();t<n&&(t=n)}return t},needsUpdate:function(){return u.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return u.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return u.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return u.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(e){var t=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),i=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new u.Rect(t.x*u.pixelDensityRatio,t.y*u.pixelDensityRatio,i.x*u.pixelDensityRatio,i.y*u.pixelDensityRatio)},drawTile:function(e,t,i,n,o){if(u.console.assert(e,"[Drawer.drawTile] tile is required"),u.console.assert(t,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var r=this._getContext(i);n=n||1,e.drawCanvas(r,t,n,o)}else e.drawHTML(this.canvas)},_getContext:function(t){var i=this.context;if(t){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var o=this;this.viewer.addHandler("rotate",function e(){if(0!==o.viewport.getRotation()){o.viewer.removeHandler("rotate",e);var t=o._calculateSketchCanvasSize();o.sketchCanvas.width=t.x,o.sketchCanvas.height=t.y}})}}i=this.sketchContext}return i},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},blendSketch:function(e,t,i,n){var o=e;if(u.isPlainObject(o)||(o={opacity:e,scale:t,translate:i,compositeOperation:n}),this.useCanvas&&this.sketchCanvas){e=o.opacity,n=o.compositeOperation;var r=o.bounds;if(this.context.save(),this.context.globalAlpha=e,n&&(this.context.globalCompositeOperation=n),r)r.x<0&&(r.width+=r.x,r.x=0),r.x+r.width>this.canvas.width&&(r.width=this.canvas.width-r.x),r.y<0&&(r.height+=r.y,r.y=0),r.y+r.height>this.canvas.height&&(r.height=this.canvas.height-r.y),this.context.drawImage(this.sketchCanvas,r.x,r.y,r.width,r.height,r.x,r.y,r.width,r.height);else{t=o.scale||1;var s=(i=o.translate)instanceof u.Point?i:new u.Point(0,0),a=0,l=0;if(i){var c=this.sketchCanvas.width-this.canvas.width,h=this.sketchCanvas.height-this.canvas.height;a=Math.round(c/2),l=Math.round(h/2)}this.context.drawImage(this.sketchCanvas,s.x-a*t,s.y-l*t,(this.canvas.width+2*a)*t,(this.canvas.height+2*l)*t,-a,-l,this.canvas.width+2*a,this.canvas.height+2*l)}this.context.restore()}},drawDebugInfo:function(e,t,i,n){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(n)%this.debugGridColor.length,r=this.context;r.save(),r.lineWidth=2*u.pixelDensityRatio,r.font="small-caps bold "+13*u.pixelDensityRatio+"px arial",r.strokeStyle=this.debugGridColor[o],r.fillStyle=this.debugGridColor[o],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),n.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:n.getRotation(!0),point:n.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0)}),r.strokeRect(e.position.x*u.pixelDensityRatio,e.position.y*u.pixelDensityRatio,e.size.x*u.pixelDensityRatio,e.size.y*u.pixelDensityRatio);var s=(e.position.x+e.size.x/2)*u.pixelDensityRatio,a=(e.position.y+e.size.y/2)*u.pixelDensityRatio;r.translate(s,a),r.rotate(Math.PI/180*-this.viewport.degrees),r.translate(-s,-a),0===e.x&&0===e.y&&(r.fillText("Zoom: "+this.viewport.getZoom(),e.position.x*u.pixelDensityRatio,(e.position.y-30)*u.pixelDensityRatio),r.fillText("Pan: "+this.viewport.getBounds().toString(),e.position.x*u.pixelDensityRatio,(e.position.y-20)*u.pixelDensityRatio)),r.fillText("Level: "+e.level,(e.position.x+10)*u.pixelDensityRatio,(e.position.y+20)*u.pixelDensityRatio),r.fillText("Column: "+e.x,(e.position.x+10)*u.pixelDensityRatio,(e.position.y+30)*u.pixelDensityRatio),r.fillText("Row: "+e.y,(e.position.x+10)*u.pixelDensityRatio,(e.position.y+40)*u.pixelDensityRatio),r.fillText("Order: "+i+" of "+t,(e.position.x+10)*u.pixelDensityRatio,(e.position.y+50)*u.pixelDensityRatio),r.fillText("Size: "+e.size.toString(),(e.position.x+10)*u.pixelDensityRatio,(e.position.y+60)*u.pixelDensityRatio),r.fillText("Position: "+e.position.toString(),(e.position.x+10)*u.pixelDensityRatio,(e.position.y+70)*u.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),n.getRotation(!0)%360!=0&&this._restoreRotationChanges(),r.restore()}},debugRect:function(e){if(this.useCanvas){var t=this.context;t.save(),t.lineWidth=2*u.pixelDensityRatio,t.strokeStyle=this.debugGridColor[0],t.fillStyle=this.debugGridColor[0],t.strokeRect(e.x*u.pixelDensityRatio,e.y*u.pixelDensityRatio,e.width*u.pixelDensityRatio,e.height*u.pixelDensityRatio),t.restore()}},getCanvasSize:function(e){var t=this._getContext(e).canvas;return new u.Point(t.width,t.height)},getCanvasCenter:function(){return new u.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(e){var t=e.point?e.point.times(u.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(e.useSketch);i.save(),i.translate(t.x,t.y),i.rotate(Math.PI/180*e.degrees),i.translate(-t.x,-t.y)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var e=u.pixelDensityRatio,t=this.viewport.getContainerSize();return{x:t.x*e,y:t.y*e}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(p){p.Viewport=function(e){var t=arguments;t.length&&t[0]instanceof p.Point&&(e={containerSize:t[0],contentSize:t[1],config:t[2]}),e.config&&(p.extend(!0,e,e.config),delete e.config),this._margins=p.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,p.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:p.DEFAULT_SETTINGS.springStiffness,animationTime:p.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:p.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:p.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:p.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:p.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:p.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:p.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:p.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:p.DEFAULT_SETTINGS.maxZoomLevel,degrees:p.DEFAULT_SETTINGS.degrees,homeFillsViewer:p.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new p.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new p.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new p.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new p.Rect(0,0,1,1),1),this.goHome(!0),this.update()},p.Viewport.prototype={resetContentSize:function(e){return p.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),p.console.assert(e instanceof p.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),p.console.assert(0<e.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),p.console.assert(0<e.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new p.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,t){p.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,t)},_setContentBounds:function(e,t){p.console.assert(e,"[Viewport._setContentBounds] bounds is required"),p.console.assert(e instanceof p.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),p.console.assert(0<e.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),p.console.assert(0<e.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(t),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(t),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:t,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=e?e:1:1<=e?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),t=1/this.getHomeZoom(),i=t/this.getAspectRatio();return new p.Rect(e.x-t/2,e.y-i/2,t,i)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new p.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return p.extend({},this._margins)},setMargins:function(e){p.console.assert("object"===p.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=p.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(e){var t=this.getCenter(e),i=1/this.getZoom(e),n=i/this.getAspectRatio();return new p.Rect(t.x-i/2,t.y-n/2,i,n)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(e){var t,i,n,o,r,s,a=new p.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),l=new p.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return e?a:this.zoomPoint?(t=this.pixelFromPoint(this.zoomPoint,!0),o=(n=1/(i=this.getZoom()))/this.getAspectRatio(),r=new p.Rect(a.x-n/2,a.y-o/2,n,o),s=this._pixelFromPoint(this.zoomPoint,r).minus(t).divide(this._containerInnerSize.x*i),l.plus(s)):l},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(e){var t=new p.Rect(e.x,e.y,e.width,e.height);if(this.wrapHorizontal);else{var i=this.visibilityRatio*t.width,n=t.x+t.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,r=this._contentBoundsNoRotate.x-n+i,s=o-t.x-i;i>this._contentBoundsNoRotate.width?t.x+=(r+s)/2:s<0?t.x+=s:0<r&&(t.x+=r)}if(this.wrapVertical);else{var a=this.visibilityRatio*t.height,l=t.y+t.height,c=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,h=this._contentBoundsNoRotate.y-l+a,u=c-t.y-a;a>this._contentBoundsNoRotate.height?t.y+=(h+u)/2:u<0?t.y+=u:0<h&&(t.y+=h)}return t},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){
var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var n=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(e),(n.x!==o.x||n.y!==o.y||e)&&this.fitBounds(o.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(e,t){var i=(t=t||{}).immediately||!1,n=t.constraints||!1,o=this.getAspectRatio(),r=e.getCenter(),s=new p.Rect(e.x,e.y,e.width,e.height,e.degrees+this.getRotation()).getBoundingBox();s.getAspectRatio()>=o?s.height=s.width/o:s.width=s.height*o,s.x=r.x-s.width/2,s.y=r.y-s.height/2;var a=1/s.width;if(n){var l=s.getAspectRatio(),c=this._applyZoomConstraints(a);a!==c&&(a=c,s.width=1/a,s.x=r.x-s.width/2,s.height=s.width/l,s.y=r.y-s.height/2),r=(s=this._applyBoundaryConstraints(s)).getCenter(),this._raiseConstraintsEvent(i)}if(i)return this.panTo(r,!0),this.zoomTo(a,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var h=this.getBounds(),u=this.getZoom();if(0===u||Math.abs(a/u-1)<1e-8)return this.zoomTo(a,!0),this.panTo(r,i);var d=(s=s.rotate(-this.getRotation())).getTopLeft().times(a).minus(h.getTopLeft().times(u)).divide(a-u);return this.zoomTo(a,d,i)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(e){var t=new p.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(t,e)},fitHorizontally:function(e){var t=new p.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(t,e)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(e,t){var i=new p.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(i.plus(e),t)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(e,t,i){var n=this;return this.zoomPoint=t instanceof p.Point&&!isNaN(t.x)&&!isNaN(t.y)?t:null,i?this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.resetTo(e)}):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:t,immediately:i}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=p.positiveModulo(e,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e})),this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),o=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,o.width=n.width*i,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(o,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new p.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),n=this.deltaPointsFromPixels(i,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(e,t){return e.minus(t.getTopLeft()).times(this._containerInnerSize.x/t.width).plus(new p.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(e,t){var i=this.getBoundsNoRotate(t);return e.minus(new p.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/i.width).plus(i.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new p.Point(e*this._contentSizeNoRotate.x/i,t*this._contentSizeNoRotate.x/i)},viewportToImageCoordinates:function(e,t){if(e instanceof p.Point)return this.viewportToImageCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)p.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(e,t,!0)}}return this._viewportToImageDelta(e-this._contentBoundsNoRotate.x,t-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,t){var i=this._contentBoundsNoRotate.width;return new p.Point(e/this._contentSizeNoRotate.x*i,t/this._contentSizeNoRotate.x*i)},imageToViewportCoordinates:function(e,t){if(e instanceof p.Point)return this.imageToViewportCoordinates(e.x,e.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(1<i)p.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(e,t,!0)}}var n=this._imageToViewportDelta(e,t);return n.x+=this._contentBoundsNoRotate.x,n.y+=this._contentBoundsNoRotate.y,n},imageToViewportRectangle:function(e,t,i,n){var o=e;if(o instanceof p.Rect||(o=new p.Rect(e,t,i,n)),this.viewer){var r=this.viewer.world.getItemCount();if(1<r)p.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===r){return this.viewer.world.getItemAt(0).imageToViewportRectangle(e,t,i,n,!0)}}var s=this.imageToViewportCoordinates(o.x,o.y),a=this._imageToViewportDelta(o.width,o.height);return new p.Rect(s.x,s.y,a.x,a.y,o.degrees)},viewportToImageRectangle:function(e,t,i,n){var o=e;if(o instanceof p.Rect||(o=new p.Rect(e,t,i,n)),this.viewer){var r=this.viewer.world.getItemCount();if(1<r)p.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===r){return this.viewer.world.getItemAt(0).viewportToImageRectangle(e,t,i,n,!0)}}var s=this.viewportToImageCoordinates(o.x,o.y),a=this._viewportToImageDelta(o.width,o.height);return new p.Rect(s.x,s.y,a.x,a.y,o.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){p.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var t=e.minus(p.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return p.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(e).plus(p.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return p.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return p.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){p.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var t=e.minus(p.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(t)},viewportToWindowCoordinates:function(e){return p.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(e).plus(p.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)p.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===t){return this.viewer.world.getItemAt(0).viewportToImageZoom(e)}}var i=this._contentSizeNoRotate.x;return e*(this._containerInnerSize.x/i*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(e){if(this.viewer){var t=this.viewer.world.getItemCount();if(1<t)p.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===t){return this.viewer.world.getItemAt(0).imageToViewportZoom(e)}}return e*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)}}}(OpenSeadragon),function(y){function m(e,t,i,n,o,r,s,a,l){var c=s.getBoundingBox().getTopLeft(),h=s.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:n,opacity:o,visibility:r,drawArea:s,topleft:c,bottomright:h,currenttime:a,best:l}),R(e.coverage,n),R(e.loadingCoverage,n);for(var u=e._getCornerTiles(n,c,h),d=u.topLeft,p=u.bottomRight,g=e.source.getNumTiles(n),m=e.viewport.pixelFromPoint(e.viewport.getCenter()),f=d.x;f<=p.x;f++)for(var v=d.y;v<=p.y;v++){if(!e.wrapHorizontal&&!e.wrapVertical){var y=e.source.getTileBounds(n,f,v);if(null===s.intersection(y))continue}l=w(e,i,t,f,v,n,o,r,m,g,a,l)}return l}function w(e,t,i,n,o,r,s,a,l,c,h,u){var d=f(n,o,r,e,e.source,e.tilesMatrix,h,c,e._worldWidthCurrent,e._worldHeightCurrent),p=i;e.viewer&&e.viewer.raiseEvent("update-tile",{tiledImage:e,tile:d}),P(e.coverage,r,n,o,!1);var g=d.loaded||d.loading||E(e.loadingCoverage,r,n,o);if(P(e.loadingCoverage,r,n,o,g),!d.exists)return u;if(t&&!p&&(E(e.coverage,r,n,o)?P(e.coverage,r,n,o,!0):p=!0),!p)return u;if(S(d,e.source.tileOverlap,e.viewport,l,a,e),!d.loaded)if(d.context2D)T(e,d);else{var m=e._tileCache.getImageRecord(d.cacheKey);if(m)T(e,d,m.getImage())}d.loaded?b(e,d,n,o,r,s,h)&&(e._needsDraw=!0):d.loading?e._tilesLoading++:g||(u=C(u,d));return u}function f(e,t,i,n,o,r,s,a,l,c){var h,u,d,p,g,m,f,v;return r[i]||(r[i]={}),r[i][e]||(r[i][e]={}),r[i][e][t]||(h=(a.x+e%a.x)%a.x,u=(a.y+t%a.y)%a.y,d=o.getTileBounds(i,h,u),p=o.tileExists(i,h,u),g=o.getTileUrl(i,h,u),n.loadTilesWithAjax?(m=o.getTileAjaxHeaders(i,h,u),y.isPlainObject(n.ajaxHeaders)&&(m=y.extend({},n.ajaxHeaders,m))):m=null,f=o.getContext2D?o.getContext2D(i,h,u):undefined,d.x+=(e-h)/a.x,d.y+=c/l*((t-u)/a.y),v=new y.Tile(i,e,t,d,p,g,f,n.loadTilesWithAjax,m),h===a.x-1&&(v.isRightMost=!0),u===a.y-1&&(v.isBottomMost=!0),r[i][e][t]=v),(v=r[i][e][t]).lastTouchTime=s,v}function v(n,o,r){o.loading=!0,n._imageLoader.addJob({src:o.url,loadWithAjax:o.loadWithAjax,ajaxHeaders:o.ajaxHeaders,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:function(e,t,i){s(n,o,r,e,t,i)},abort:function(){o.loading=!1}})}function s(t,i,e,n,o,r){if(!n)return y.console.log("Tile %s failed to load: %s - error: %s",i,i.url,o),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:e,message:o,tileRequest:r}),i.loading=!1,void(i.exists=!1);if(e<t.lastResetTime)return y.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var s=function(){var e=t.source.getClosestLevel();T(t,i,n,e,r)};t._midDraw?window.setTimeout(s,1):s()}function T(e,t,i,n,o){function r(){return a++,s}function s(){0===--a&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}var a=0;e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:o,image:i,getCompletionCallback:r}),r()()}function S(e,t,i,n,o,r){var s=e.bounds.getTopLeft();s.x*=r._scaleSpring.current.value,s.y*=r._scaleSpring.current.value,s.x+=r._xSpring.current.value,s.y+=r._ySpring.current.value;var a=e.bounds.getSize();a.x*=r._scaleSpring.current.value,a.y*=r._scaleSpring.current.value;var l=i.pixelFromPointNoRotate(s,!0),c=i.pixelFromPointNoRotate(s,!1),h=i.deltaPixelsFromPointsNoRotate(a,!0),u=i.deltaPixelsFromPointsNoRotate(a,!1),d=c.plus(u.divide(2)),p=n.squaredDistanceTo(d);t||(h=h.plus(new y.Point(1,1))),e.isRightMost&&r.wrapHorizontal&&(h.x+=.75),e.isBottomMost&&r.wrapVertical&&(h.y+=.75),e.position=l,e.size=h,e.squaredDistance=p,e.visibility=o}function b(e,t,i,n,o,r,s){var a,l,c=1e3*e.blendTime;if(t.blendStart||(t.blendStart=s),a=s-t.blendStart,l=c?Math.min(1,a/c):1,e.alwaysBlend&&(l*=r),t.opacity=l,e.lastDrawn.push(t),1==l)P(e.coverage,o,i,n,!0),e._hasOpaqueTile=!0;else if(a<c)return!0;return!1}function x(e,t,i,n){var o,r,s,a;if(!e[t])return!1;if(i===undefined||n===undefined){for(s in o=e[t])if(o.hasOwnProperty(s))for(a in r=o[s])if(r.hasOwnProperty(a)&&!r[a])return!1;return!0}return e[t][i]===undefined||e[t][i][n]===undefined||!0===e[t][i][n]}function E(e,t,i,n){return i===undefined||n===undefined?x(e,t+1):x(e,t+1,2*i,2*n)&&x(e,t+1,2*i,2*n+1)&&x(e,t+1,2*i+1,2*n)&&x(e,t+1,2*i+1,2*n+1)}function P(e,t,i,n,o){e[t]?(e[t][i]||(e[t][i]={}),e[t][i][n]=o):y.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",t)}function R(e,t){e[t]={}}function C(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance?t:e:t}function _(e,t){if(0!==e.opacity&&(0!==t.length||e.placeholderFillStyle)){var i,n,o,r=t[0];r&&(i=e.opacity<1||e.compositeOperation&&"source-over"!==e.compositeOperation||!e._isBottomItem()&&r._hasTransparencyChannel());var s,a=e.viewport.getZoom(!0),l=e.viewportToImageZoom(a);1<t.length&&l>e.smoothTileEdgesMinZoom&&!e.iOSDevice&&e.getRotation(!0)%360==0&&y.supportsCanvas&&(i=!0,n=r.getScaleForEdgeSmoothing(),o=r.getTranslationForEdgeSmoothing(n,e._drawer.getCanvasSize(!1),e._drawer.getCanvasSize(!0))),i&&(n||(s=e.viewport.viewportToViewerElementRectangle(e.getClippedBounds(!0)).getIntegerBoundingBox().times(y.pixelDensityRatio)),e._drawer._clear(!0,s)),n||(0!==e.viewport.degrees&&e._drawer._offsetForRotation({degrees:e.viewport.degrees,useSketch:i}),e.getRotation(!0)%360!=0&&e._drawer._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:i}));var c=!1;if(e._clip){e._drawer.saveContext(i);var h=e.imageToViewportRectangle(e._clip,!0);h=h.rotate(-e.getRotation(!0),e._getRotationPoint(!0));var u=e._drawer.viewportToDrawerRectangle(h);n&&(u=u.times(n)),o&&(u=u.translate(o)),e._drawer.setClip(u,i),c=!0}if(e.placeholderFillStyle&&!1===e._hasOpaqueTile){var d=e._drawer.viewportToDrawerRectangle(e.getBounds(!0));n&&(d=d.times(n)),o&&(d=d.translate(o));var p=null;p="function"==typeof e.placeholderFillStyle?e.placeholderFillStyle(e,e._drawer.context):e.placeholderFillStyle,e._drawer.drawRectangle(d,p,i)}for(var g=t.length-1;0<=g;g--)r=t[g],e._drawer.drawTile(r,e._drawingHandler,i,n,o),r.beingDrawn=!0,e.viewer&&e.viewer.raiseEvent("tile-drawn",{tiledImage:e,tile:r});c&&e._drawer.restoreContext(i),n||(e.getRotation(!0)%360!=0&&e._drawer._restoreRotationChanges(i),0!==e.viewport.degrees&&e._drawer._restoreRotationChanges(i)),i&&(n&&(0!==e.viewport.degrees&&e._drawer._offsetForRotation({degrees:e.viewport.degrees,useSketch:!1}),e.getRotation(!0)%360!=0&&e._drawer._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0),useSketch:!1})),e._drawer.blendSketch({opacity:e.opacity,scale:n,translate:o,compositeOperation:e.compositeOperation,bounds:s}),n&&(e.getRotation(!0)%360!=0&&e._drawer._restoreRotationChanges(!1),0!==e.viewport.degrees&&e._drawer._restoreRotationChanges(!1))),k(e,t)}}function k(e,t){if(e.debugMode)for(var i=t.length-1;0<=i;i--){var n=t[i];try{e._drawer.drawDebugInfo(n,t.length,i,e)}catch(o){y.console.error(o)}}}y.TiledImage=function(e){var t=this;y.console.assert(e.tileCache,"[TiledImage] options.tileCache is required"),y.console.assert(e.drawer,"[TiledImage] options.drawer is required"),y.console.assert(e.viewer,"[TiledImage] options.viewer is required"),y.console.assert(e.imageLoader,"[TiledImage] options.imageLoader is required"),y.console.assert(e.source,"[TiledImage] options.source is required"),y.console.assert(!e.clip||e.clip instanceof y.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),y.EventSource.call(this),this._tileCache=e.tileCache,delete e.tileCache,this._drawer=e.drawer,delete e.drawer,this._imageLoader=e.imageLoader,delete e.imageLoader,e.clip instanceof y.Rect&&(this._clip=e.clip.clone()),delete e.clip;var i=e.x||0;delete e.x;var n=e.y||0;delete e.y,this.normHeight=e.source.dimensions.y/e.source.dimensions.x,this.contentAspectX=e.source.dimensions.x/e.source.dimensions.y;var o=1;e.width?(o=e.width,delete e.width,e.height&&(y.console.error("specifying both width and height to a tiledImage is not supported"),delete e.height)):e.height&&(o=e.height/this.normHeight,delete e.height);var r=e.fitBounds;delete e.fitBounds;var s=e.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete e.fitBoundsPlacement;var a=e.degrees||0;delete e.degrees,y.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:y.DEFAULT_SETTINGS.springStiffness,animationTime:y.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:y.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:y.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:y.DEFAULT_SETTINGS.wrapVertical,immediateRender:y.DEFAULT_SETTINGS.immediateRender,blendTime:y.DEFAULT_SETTINGS.blendTime,alwaysBlend:y.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:y.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:y.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:y.DEFAULT_SETTINGS.iOSDevice,debugMode:y.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:y.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:y.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:y.DEFAULT_SETTINGS.placeholderFillStyle,opacity:y.DEFAULT_SETTINGS.opacity,preload:y.DEFAULT_SETTINGS.preload,compositeOperation:y.DEFAULT_SETTINGS.compositeOperation},e),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new y.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new y.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new y.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new y.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),r&&this.fitBounds(r,s,!0),this._drawingHandler=function(e){t.viewer.raiseEvent("tile-drawing",y.extend({tiledImage:t},e))}},y.extend(y.TiledImage.prototype,y.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=y.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){(0!==this.opacity||this._preload)&&(this._midDraw=!0,this._updateViewport(),this._midDraw=!1)},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(e){return e?new y.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new y.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return y.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(e){var t=this.getBoundsNoRotate(e);if(this._clip){var i=(e?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,n=this._clip.times(i);t=new y.Rect(t.x+n.x,t.y+n.y,n.width,n.height)}return t.rotate(this.getRotation(e),this._getRotationPoint(e))},getContentSize:function(){return new y.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(e,t,i){var n=i?this._scaleSpring.current.value:this._scaleSpring.target.value;return new y.Point(e*(this.source.dimensions.x/n),t*(this.source.dimensions.y*this.contentAspectX/n))},viewportToImageCoordinates:function(e,t,i){var n;return e instanceof y.Point?(i=t,n=e):n=new y.Point(e,t),n=n.rotate(-this.getRotation(i),this._getRotationPoint(i)),i?this._viewportToImageDelta(n.x-this._xSpring.current.value,n.y-this._ySpring.current.value):this._viewportToImageDelta(n.x-this._xSpring.target.value,n.y-this._ySpring.target.value)},_imageToViewportDelta:function(e,t,i){var n=i?this._scaleSpring.current.value:this._scaleSpring.target.value;return new y.Point(e/this.source.dimensions.x*n,t/this.source.dimensions.y/this.contentAspectX*n)},imageToViewportCoordinates:function(e,t,i){e instanceof y.Point&&(i=t,t=e.y,e=e.x);var n=this._imageToViewportDelta(e,t);return i?(n.x+=this._xSpring.current.value,n.y+=this._ySpring.current.value):(n.x+=this._xSpring.target.value,n.y+=this._ySpring.target.value),n.rotate(this.getRotation(i),this._getRotationPoint(i))},imageToViewportRectangle:function(e,t,i,n,o){var r=e;r instanceof y.Rect?o=t:r=new y.Rect(e,t,i,n);var s=this.imageToViewportCoordinates(r.getTopLeft(),o),a=this._imageToViewportDelta(r.width,r.height,o);return new y.Rect(s.x,s.y,a.x,a.y,r.degrees+this.getRotation(o))},viewportToImageRectangle:function(e,t,i,n,o){var r=e;e instanceof y.Rect?o=t:r=new y.Rect(e,t,i,n);var s=this.viewportToImageCoordinates(r.getTopLeft(),o),a=this._viewportToImageDelta(r.width,r.height,o);return new y.Rect(s.x,s.y,a.x,a.y,r.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(e){var t=this._scaleSpring.current.value;return e=e.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new y.Rect((e.x-this._xSpring.current.value)/t,(e.y-this._ySpring.current.value)/t,e.width/t,e.height/t,e.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},fitBounds:function(e,t,i){t=t||y.Placement.CENTER;var n=y.Placement.properties[t],o=this.contentAspectX,r=0,s=0,a=1,l=1;if(this._clip&&(o=this._clip.getAspectRatio(),a=this._clip.width/this.source.dimensions.x,l=this._clip.height/this.source.dimensions.y,e.getAspectRatio()>o?(r=this._clip.x/this._clip.height*e.height,s=this._clip.y/this._clip.height*e.height):(r=this._clip.x/this._clip.width*e.width,s=this._clip.y/this._clip.width*e.width)),e.getAspectRatio()>o){var c=e.height/l,h=0;n.isHorizontallyCentered?h=(e.width-e.height*o)/2:n.isRight&&(h=e.width-e.height*o),this.setPosition(new y.Point(e.x-r+h,e.y-s),i),this.setHeight(c,i)}else{var u=e.width/a,d=0;n.isVerticallyCentered?d=(e.height-e.width/o)/2:n.isBottom&&(d=e.height-e.width/o),this.setPosition(new y.Point(e.x-r,e.y-s+d),i),this.setWidth(u,i)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){y.console.assert(!e||e instanceof y.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),e instanceof y.Rect?this._clip=e.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;){this.lastDrawn.pop().beingDrawn=!1}var e=this.viewport,t=this._viewportToTiledImageRectangle(e.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var i=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(t=t.intersection(i)))return}for(var n=this._getLevelsInterval(),o=n.lowestLevel,r=n.highestLevel,s=null,a=!1,l=y.now(),c=r;o<=c;c--){var h=!1,u=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(c),!0).x*this._scaleSpring.current.value;if(c===o||!a&&u>=this.minPixelRatio)a=h=!0;else if(!a)continue;var d=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(c),!1).x*this._scaleSpring.current.value,p=e.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,g=this.immediateRender?1:p;if(s=m(this,a,h,c,Math.min(1,(u-.5)/.5),g/Math.abs(g-d),t,l,s),x(this.coverage,c))break}_(this,this.lastDrawn),s&&!s.context2D?(v(this,s,l),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(e,t,i){var n,o,r,s;this.wrapHorizontal?(n=y.positiveModulo(t.x,1),o=y.positiveModulo(i.x,1)):(n=Math.max(0,t.x),o=Math.min(1,i.x));var a=1/this.source.aspectRatio;this.wrapVertical?(r=y.positiveModulo(t.y,a),s=y.positiveModulo(i.y,a)):(r=Math.max(0,t.y),s=Math.min(a,i.y));var l=this.source.getTileAtPoint(e,new y.Point(n,r)),c=this.source.getTileAtPoint(e,new y.Point(o,s)),h=this.source.getNumTiles(e);return this.wrapHorizontal&&(l.x+=h.x*Math.floor(t.x),c.x+=h.x*Math.floor(i.x)),this.wrapVertical&&(l.y+=h.y*Math.floor(t.y/a),c.y+=h.y*Math.floor(i.y/a)),{topLeft:l,bottomRight:c}}})}(OpenSeadragon),function(g){var m=function(e){g.console.assert(e,"[TileCache.cacheTile] options is required"),g.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),g.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage},f=function(e){g.console.assert(e,"[ImageRecord] options is required"),g.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]};f.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(e){g.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){g.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var t=0;t<this._tiles.length;t++)if(this._tiles[t]===e)return void this._tiles.splice(t,1);g.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},g.TileCache=function(e){e=e||{},this._maxImageCacheCount=e.maxImageCacheCount||g.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},g.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(e){g.console.assert(e,"[TileCache.cacheTile] options is required"),g.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),g.console.assert(e.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),g.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var t=e.cutoff||0,i=this._tilesLoaded.length,n=this._imagesLoaded[e.tile.cacheKey];if(n||(g.console.assert(e.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),n=this._imagesLoaded[e.tile.cacheKey]=new f({image:e.image}),this._imagesLoadedCount++),n.addTile(e.tile),e.tile.cacheImageRecord=n,this._imagesLoadedCount>this._maxImageCacheCount){
for(var o,r,s,a,l,c,h=null,u=-1,d=null,p=this._tilesLoaded.length-1;0<=p;p--)(o=(c=this._tilesLoaded[p]).tile).level<=t||o.beingDrawn||(h?(a=o.lastTouchTime,r=h.lastTouchTime,l=o.level,s=h.level,(a<r||a==r&&s<l)&&(h=o,u=p,d=c)):(h=o,u=p,d=c));h&&0<=u&&(this._unloadTile(d),i=u)}this._tilesLoaded[i]=new m({tile:e.tile,tiledImage:e.tiledImage})},clearTilesFor:function(e){var t;g.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(t=this._tilesLoaded[i]).tiledImage===e&&(this._unloadTile(t),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(e){return g.console.assert(e,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[e]},_unloadTile:function(e){g.console.assert(e,"[TileCache._unloadTile] tileRecord is required");var t=e.tile,i=e.tiledImage;t.unload(),t.cacheImageRecord=null;var n=this._imagesLoaded[t.cacheKey];n.removeTile(t),n.getTileCount()||(n.destroy(),delete this._imagesLoaded[t.cacheKey],this._imagesLoadedCount--),i.viewer.raiseEvent("tile-unloaded",{tile:t,tiledImage:i})}}}(OpenSeadragon),function(f){f.World=function(e){var t=this;f.console.assert(e.viewer,"[World] options.viewer is required"),f.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){t._autoRefigureSizes?t._figureSizes():t._needsSizesFigured=!0},this._figureSizes()},f.extend(f.World.prototype,f.EventSource.prototype,{addItem:function(e,t){if(f.console.assert(e,"[World.addItem] item is required"),f.console.assert(e instanceof f.TiledImage,"[World.addItem] only TiledImages supported at this time"),(t=t||{}).index!==undefined){var i=Math.max(0,Math.min(this._items.length,t.index));this._items.splice(i,0,e)}else this._items.push(e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),e.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return f.console.assert(e!==undefined,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return f.console.assert(e,"[World.getIndexOfItem] item is required"),f.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,t){f.console.assert(e,"[World.setItemIndex] item is required"),f.console.assert(t!==undefined,"[World.setItemIndex] index is required");var i=this.getIndexOfItem(e);if(t>=this._items.length)throw new Error("Index bigger than number of layers.");t!==i&&-1!==i&&(this._items.splice(i,1),this._items.splice(t,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:i,newIndex:t}))},removeItem:function(e){f.console.assert(e,"[World.removeItem] item is required");var t=f.indexOf(this._items,e);-1!==t&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(t,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){(this._autoRefigureSizes=e)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(e){var t,i=(e=e||{}).immediately||!1,n=e.layout||f.DEFAULT_SETTINGS.collectionLayout,o=e.rows||f.DEFAULT_SETTINGS.collectionRows,r=e.columns||f.DEFAULT_SETTINGS.collectionColumns,s=e.tileSize||f.DEFAULT_SETTINGS.collectionTileSize,a=s+(e.tileMargin||f.DEFAULT_SETTINGS.collectionTileMargin);t=!e.rows&&r?r:Math.ceil(this._items.length/o);var l,c,h,u,d,p=0,g=0;this.setAutoRefigureSizes(!1);for(var m=0;m<this._items.length;m++)m&&m%t==0&&("horizontal"===n?(g+=a,p=0):(p+=a,g=0)),u=(h=(c=(l=this._items[m]).getBounds()).width>c.height?s:s*(c.width/c.height))*(c.height/c.width),d=new f.Point(p+(s-h)/2,g+(s-u)/2),l.setPosition(d,i),l.setWidth(h,i),"horizontal"===n?p+=a:g+=a;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var e=this._homeBounds?this._homeBounds.clone():null,t=this._contentSize?this._contentSize.clone():null,i=this._contentFactor||0;if(this._items.length){var n=this._items[0],o=n.getBounds();this._contentFactor=n.getContentSize().x/o.width;for(var r=n.getClippedBounds().getBoundingBox(),s=r.x,a=r.y,l=r.x+r.width,c=r.y+r.height,h=1;h<this._items.length;h++)o=(n=this._items[h]).getBounds(),this._contentFactor=Math.max(this._contentFactor,n.getContentSize().x/o.width),r=n.getClippedBounds().getBoundingBox(),s=Math.min(s,r.x),a=Math.min(a,r.y),l=Math.max(l,r.x+r.width),c=Math.max(c,r.y+r.height);this._homeBounds=new f.Rect(s,a,l-s,c-a),this._contentSize=new f.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new f.Rect(0,0,1,1),this._contentSize=new f.Point(1,1),this._contentFactor=1;this._contentFactor===i&&this._homeBounds.equals(e)&&this._contentSize.equals(t)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon),function(){var e=this;(function(){(function(){var i=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},WebSocket:window.WebSocket,logger:window.console,createConsumer:function(e){var t;return null==e&&(e=null!=(t=this.getConfig("url"))?t:this.INTERNAL.default_mount_path),new l.Consumer(this.createWebSocketURL(e))},getConfig:function(e){var t;return null!=(t=document.head.querySelector("meta[name='action-cable-"+e+"']"))?t.getAttribute("content"):void 0},createWebSocketURL:function(e){var t;return e&&!/^wss?:/i.test(e)?((t=document.createElement("a")).href=e,t.href=t.href,t.protocol=t.protocol.replace("http","ws"),t.href):e},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var e,t;if(e=1<=arguments.length?i.call(arguments,0):[],this.debugging)return e.push(Date.now()),(t=this.logger).log.apply(t,["[ActionCable]"].concat(i.call(e)))}}}).call(this)}).call(e);var l=e.ActionCable;(function(){(function(){var n=function(e,t){return function(){return e.apply(t,arguments)}};l.ConnectionMonitor=function(){function e(e){this.connection=e,this.visibilityDidChange=n(this.visibilityDidChange,this),this.reconnectAttempts=0}var o,t,i;return e.pollInterval={min:3,max:30},e.staleThreshold=6,e.prototype.start=function(){if(!this.isRunning())return this.startedAt=t(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),l.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},e.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=t(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),l.log("ConnectionMonitor stopped")},e.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},e.prototype.recordPing=function(){return this.pingedAt=t()},e.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,l.log("ConnectionMonitor recorded connect")},e.prototype.recordDisconnect=function(){return this.disconnectedAt=t(),l.log("ConnectionMonitor recorded disconnect")},e.prototype.startPolling=function(){return this.stopPolling(),this.poll()},e.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},e.prototype.poll=function(){return this.pollTimeout=setTimeout((e=this,function(){return e.reconnectIfStale(),e.poll()}),this.getPollInterval());var e},e.prototype.getPollInterval=function(){var e,t,i,n;return i=(n=this.constructor.pollInterval).min,t=n.max,e=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*o(e,i,t))},e.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return l.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+i(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?l.log("ConnectionMonitor skipping reopening recent disconnect"):(l.log("ConnectionMonitor reopening"),this.connection.reopen())},e.prototype.connectionIsStale=function(){var e;return i(null!=(e=this.pingedAt)?e:this.startedAt)>this.constructor.staleThreshold},e.prototype.disconnectedRecently=function(){return this.disconnectedAt&&i(this.disconnectedAt)<this.constructor.staleThreshold},e.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout((e=this,function(){if(e.connectionIsStale()||!e.connection.isOpen())return l.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),e.connection.reopen()}),200);var e},t=function(){return(new Date).getTime()},i=function(e){return(t()-e)/1e3},o=function(e,t,i){return Math.max(t,Math.min(i,e))},e}()}).call(this),function(){var e,o,t,i,n,r=[].slice,s=function(e,t){return function(){return e.apply(t,arguments)}},a=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};i=l.INTERNAL,o=i.message_types,t=i.protocols,n=2<=t.length?r.call(t,0,e=t.length-1):(e=0,[]),t[e++],l.Connection=function(){function e(e){this.consumer=e,this.open=s(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new l.ConnectionMonitor(this),this.disconnected=!0}return e.reopenDelay=500,e.prototype.send=function(e){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(e)),!0)},e.prototype.open=function(){return this.isActive()?(l.log("Attempted to open WebSocket, but existing socket is "+this.getState()),!1):(l.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+t),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new l.WebSocket(this.consumer.url,t),this.installEventHandlers(),this.monitor.start(),!0)},e.prototype.close=function(e){var t;if((null!=e?e:{allowReconnect:!0}).allowReconnect||this.monitor.stop(),this.isActive())return null!=(t=this.webSocket)?t.close():void 0},e.prototype.reopen=function(){var e;if(l.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(t){return e=t,l.log("Failed to reopen WebSocket",e)}finally{l.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},e.prototype.getProtocol=function(){var e;return null!=(e=this.webSocket)?e.protocol:void 0},e.prototype.isOpen=function(){return this.isState("open")},e.prototype.isActive=function(){return this.isState("open","connecting")},e.prototype.isProtocolSupported=function(){var e;return e=this.getProtocol(),0<=a.call(n,e)},e.prototype.isState=function(){var e,t;return t=1<=arguments.length?r.call(arguments,0):[],e=this.getState(),0<=a.call(t,e)},e.prototype.getState=function(){var e,t;for(t in WebSocket)if(WebSocket[t]===(null!=(e=this.webSocket)?e.readyState:void 0))return t.toLowerCase();return null},e.prototype.installEventHandlers=function(){var e,t;for(e in this.events)t=this.events[e].bind(this),this.webSocket["on"+e]=t},e.prototype.uninstallEventHandlers=function(){var e;for(e in this.events)this.webSocket["on"+e]=function(){}},e.prototype.events={message:function(e){var t,i,n;if(this.isProtocolSupported())switch(t=(n=JSON.parse(e.data)).identifier,i=n.message,n.type){case o.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case o.ping:return this.monitor.recordPing();case o.confirmation:return this.subscriptions.notify(t,"connected");case o.rejection:return this.subscriptions.reject(t);default:return this.subscriptions.notify(t,"received",i)}},open:function(){if(l.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return l.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(){if(l.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return l.log("WebSocket onerror event")}},e}()}.call(this),function(){var c=[].slice;l.Subscriptions=function(){function e(e){this.consumer=e,this.subscriptions=[]}return e.prototype.create=function(e,t){var i,n,o;return n="object"==typeof(i=e)?i:{channel:i},o=new l.Subscription(this.consumer,n,t),this.add(o)},e.prototype.add=function(e){return this.subscriptions.push(e),this.consumer.ensureActiveConnection(),this.notify(e,"initialized"),this.sendCommand(e,"subscribe"),e},e.prototype.remove=function(e){return this.forget(e),this.findAll(e.identifier).length||this.sendCommand(e,"unsubscribe"),e},e.prototype.reject=function(e){var t,i,n,o,r;for(o=[],t=0,i=(n=this.findAll(e)).length;t<i;t++)r=n[t],this.forget(r),this.notify(r,"rejected"),o.push(r);return o},e.prototype.forget=function(o){var r;return this.subscriptions=function(){var e,t,i,n;for(n=[],e=0,t=(i=this.subscriptions).length;e<t;e++)(r=i[e])!==o&&n.push(r);return n}.call(this),o},e.prototype.findAll=function(e){var t,i,n,o,r;for(o=[],t=0,i=(n=this.subscriptions).length;t<i;t++)(r=n[t]).identifier===e&&o.push(r);return o},e.prototype.reload=function(){var e,t,i,n,o;for(n=[],e=0,t=(i=this.subscriptions).length;e<t;e++)o=i[e],n.push(this.sendCommand(o,"subscribe"));return n},e.prototype.notifyAll=function(e){var t,i,n,o,r,s,a;for(i=e,t=2<=arguments.length?c.call(arguments,1):[],s=[],n=0,o=(r=this.subscriptions).length;n<o;n++)a=r[n],s.push(this.notify.apply(this,[a,i].concat(c.call(t))));return s},e.prototype.notify=function(e,t){var i,n,o,r,s,a,l;for(a=e,n=t,i=3<=arguments.length?c.call(arguments,2):[],s=[],o=0,r=(l="string"==typeof a?this.findAll(a):[a]).length;o<r;o++)a=l[o],s.push("function"==typeof a[n]?a[n].apply(a,i):void 0);return s},e.prototype.sendCommand=function(e,t){var i;return i=e.identifier,this.consumer.send({command:t,identifier:i})},e}()}.call(this),function(){l.Subscription=function(){function e(e,t,i){this.consumer=e,null==t&&(t={}),this.identifier=JSON.stringify(t),n(this,i)}var n;return e.prototype.perform=function(e,t){return null==t&&(t={}),t.action=e,this.send(t)},e.prototype.send=function(e){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(e)})},e.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},n=function(e,t){var i,n;if(null!=t)for(i in t)n=t[i],e[i]=n;return e},e}()}.call(this),function(){l.Consumer=function(){function e(e){this.url=e,this.subscriptions=new l.Subscriptions(this),this.connection=new l.Connection(this)}return e.prototype.send=function(e){return this.connection.send(e)},e.prototype.connect=function(){return this.connection.open()},e.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},e.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},e}()}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=l:"function"==typeof define&&define.amd&&define(l)}.call(this),function(){this.App||(this.App={}),App.cable=ActionCable.createConsumer()}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this),function(){}.call(this);